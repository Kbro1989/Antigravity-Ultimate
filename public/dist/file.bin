POG_LIMB_V6.5
ID:file
SOURCE_MAP:INTERNAL
---
import { NeuralLimb, LimbConfig } from './NeuralLimb';
import { CLIBridge } from '../../cli/CLIBridge';
import { AgentCapability } from '../AgentConstitution';
import { BaseIntent } from '../AITypes';

export class FileLimb extends NeuralLimb {
    private bridge: CLIBridge;

    constructor(config: LimbConfig) {
        super(config);
        this.bridge = CLIBridge.getInstance();
    }

    async read(params: any) {
        this.enforceCapability(AgentCapability.READ_FILES);
        await this.logActivity('file_read', 'pending', { path: params.path });
        const result = await this.bridge.readFile(params.path);
        await this.logActivity('file_read', 'success', { path: params.path });
        return result;
    }

    async write(params: any) {
        this.enforceCapability(AgentCapability.WRITE_FILES);
        await this.logActivity('file_write', 'pending', { path: params.path });
        const result = await this.bridge.writeFile(params.path, params.content);
        await this.logActivity('file_write', 'success', { path: params.path });
        return result;
    }

    async list(params: any) {
        this.enforceCapability(AgentCapability.READ_FILES);
        await this.logActivity('file_list', 'pending', { path: params.path });
        const result = await this.bridge.listDirectory(params.path);
        await this.logActivity('file_list', 'success', { path: params.path });
        return result;
    }

    async delete(params: any) {
        this.enforceCapability(AgentCapability.DELETE_FILES);
        await this.logActivity('file_delete', 'pending', { path: params.path });
        const result = await this.bridge.execute(`del /f /q "${params.path}"`);
        await this.logActivity('file_delete', 'success', { path: params.path });
        return result;
    }

    async sync(params: any) {
        this.enforceCapability(AgentCapability.WRITE_FILES);
        await this.logActivity('file_sync', 'pending', params);
        return { status: 'synced' };
    }
}

import{a as B,r as d,j as e,b as q,R as v}from"./main-Cu5wNbky.js";import{u as K}from"./useNotification-BnnzYWaB.js";import{C as Q,P as X,S as ee,O as te}from"./Stage-Bg7cP_81.js";import"./three.module-aN59MUBe.js";import"./constants-DucYOER3.js";import"./with-selector-GgVLmVSD.js";function se({id:n,category:s,era:m="classic",autoRotate:R=!0,className:P="",shifts:N,onSnapshotReady:z}){const k=B(),[C,M]=d.useState(null),[_,E]=d.useState(null),[x,I]=d.useState(!1);return d.useEffect(()=>{let f=!1;return(async()=>{I(!0),E(null);try{const h=m==="modern"?k.rsmv.modern:k.rsmv.classic;if(!h)throw new Error(`${m.toUpperCase()} Service not available`);const g=await h.loadModel(n,s);f||M(g.scene)}catch(h){f||E(h.message)}I(!1)})(),()=>{f=!0}},[n,s,m,k]),d.useEffect(()=>{!C||!N||N.length===0||(console.log("[RSCModelViewer] Applying high-fidelity shifts...",N),C.traverse(f=>{if(f.isMesh){const b=f;(Array.isArray(b.material)?b.material:[b.material]).forEach(g=>{if(g.color){const u=N[0];if(u.h!==0||u.s!==0||u.l!==0){const w={h:0,s:0,l:0};g.color.getHSL(w),g.color.setHSL((w.h+u.h/255)%1,Math.min(1,Math.max(0,w.s+(u.s/255-.5))),Math.min(1,Math.max(0,w.l+(u.l/255-.5))))}}})}}))},[C,N]),_?e.jsxs("div",{className:"flex items-center justify-center w-full h-full text-neon-magenta font-mono text-[10px] uppercase p-8 text-center bg-neon-magenta/5 rounded-[40px] border border-neon-magenta/20",children:["Rendering Fault:",e.jsx("br",{}),_]}):x?e.jsx("div",{className:"flex items-center justify-center w-full h-full",children:e.jsx("div",{className:"w-12 h-12 border-2 border-neon-cyan/20 border-t-neon-cyan rounded-full animate-spin"})}):e.jsxs("div",{className:`w-full h-full relative group ${P}`,children:[e.jsxs(Q,{shadows:!0,className:"w-full h-full",gl:{antialias:!0,preserveDrawingBuffer:!0},children:[e.jsx(X,{makeDefault:!0,position:[0,0,10],fov:35}),e.jsx(d.Suspense,{fallback:null,children:e.jsx(ee,{adjustCamera:1.5,intensity:.4,environment:"city",preset:"soft",shadows:{type:"contact",opacity:.2,blur:2},children:C&&e.jsx("primitive",{object:C,castShadow:!0,receiveShadow:!0,rotation:[0,s==="npc"&&m==="classic"?0:Math.PI/4,0]})})}),e.jsx(te,{makeDefault:!0,autoRotate:R,autoRotateSpeed:.5,enableDamping:!0,minDistance:2,maxDistance:20})]}),e.jsxs("div",{className:"absolute top-8 left-8 flex flex-col gap-2 pointer-events-none",children:[e.jsxs("div",{className:"text-[10px] font-black uppercase text-neon-cyan tracking-[0.4em] mb-2 flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-neon-cyan shadow-[0_0_8px_cyan] animate-pulse"}),m.toUpperCase(),"_RENDER_PIPELINE"]}),e.jsxs("div",{className:"flex flex-wrap gap-2 max-w-[300px]",children:[e.jsxs("span",{className:"glass px-3 py-1 rounded-full text-[8px] font-mono text-white/60 uppercase",children:["ID: ",n]}),e.jsxs("span",{className:"glass px-3 py-1 rounded-full text-[8px] font-mono text-white/60 uppercase",children:["LAYER: ",s||"model"]}),s==="npc"&&m==="classic"&&e.jsx("span",{className:"glass px-3 py-1 rounded-full text-[8px] font-mono text-neon-magenta shadow-[0_0_5px_magenta] uppercase",children:"BILLBOARD_SPRITE"}),s==="object"&&e.jsx("span",{className:"glass px-3 py-1 rounded-full text-[8px] font-mono text-neon-cyan shadow-[0_0_5px_cyan] uppercase",children:"SCENERY_MESH"})]})]}),e.jsx("div",{className:"absolute bottom-8 right-8 pointer-events-none opacity-20 hover:opacity-100 transition-opacity",children:e.jsxs("div",{className:"flex flex-col items-end gap-1",children:[e.jsxs("div",{className:"w-24 h-[1px] bg-white/40 relative",children:[e.jsx("div",{className:"absolute -left-1 -top-1 w-2 h-2 border-l border-t border-white/40"}),e.jsx("div",{className:"absolute -right-1 -top-1 w-2 h-2 border-r border-t border-white/40"})]}),e.jsx("span",{className:"text-[8px] font-mono text-white",children:"RELICTUAL_SCALE_1:512"})]})})]})}function oe(){const n=B(),{addNotification:s}=K(),{sourceRelic:m,setSourceRelic:R}=q(),[P,N]=v.useState(!1),[z,k]=v.useState(0),[C,M]=v.useState("Models_Legacy"),[_,E]=v.useState([]),[x,I]=d.useState("archives"),[f,b]=d.useState([]),[h,g]=d.useState(""),[u,w]=d.useState(null),[A,O]=d.useState(null),[V,F]=d.useState(!1),H=async()=>{if(a){O(null);try{(await n.limbs.call("code","decompile_clientscript",{scriptId:a.id,era:r})).status==="success"&&(w(`// AUTHENTIC CLIENTSCRIPT (JAG) RECOVERED
// ID: ${a.id}
// RECOGNIZED BY ARCHEO-ENGINE

function script_${a.id}() {
  // Logic flow recognized.
  // Archeological Reconstruction in progress...
}`),s("success","Authentic Logic Binary Decompiled"))}catch(t){s("error",`Decompile Failed: ${t.message}`)}}},G=async()=>{if(a)try{const t=await n.limbs.call("code","reconstruct_forensic_handling",{id:a.id,type:a.type});t.status==="success"?(O(t.sourceFile),w(t.logic),s("success","Forensic Gameplay Handling Reconstructed")):s("warning",t.message)}catch(t){s("error",`Forensic Scan Failed: ${t.message}`)}},W=async()=>{if(a)try{(await n.limbs.call("relic","get_landscape_blueprint",{regionId:a.id})).status==="success"&&(F(!0),s("success","Authentic Landscape Blueprint Generated"))}catch(t){s("error",`Blueprint Failed: ${t.message}`)}},$=v.useCallback(async()=>{try{const t=await n.stats.getAssets();E(t.sort((c,i)=>i.timestamp-c.timestamp)),k(t.length)}catch(t){console.error("[RelicWorkspace] Asset refresh failed",t)}},[n]);v.useEffect(()=>{$();const t=setInterval($,5e3);return()=>clearInterval(t)},[$]);const Y=async t=>{try{s("info",`Excavating Relic Content: ${t.name}...`);const c=await n.limbs.call("relic","fetch_relic_content",{path:t.name,category:x});if(c.status!=="success")throw new Error(c.message||"Content excavation failed");const i=await n.limbs.call("relic","fork_relic",{id:t.name,type:"ref_"+x,content:c.content});if(i.status==="success")s("success",i.message);else throw new Error(i.message)}catch(c){s("error",`Forking Failed: ${c.message}`)}},T=v.useCallback(async()=>{try{let t;if(t=await n.limbs.call("relic","explore_museum",{category:x}),t.status==="success"){const i=(t.artifacts||[]).filter(l=>x==="archives"?l.type==="archive":x==="models"?l.type==="3d_models":x==="config"?l.type==="configuration":!0);b(i)}else b([])}catch{b([])}},[n,x]);d.useEffect(()=>{(async()=>n.rsmv.classic||await n.initClassicPipeline())(),T()},[T,n]);const[r,L]=d.useState("classic"),[y,p]=d.useState([]),[a,S]=d.useState(null),[J,D]=d.useState(!1),U=async t=>{try{if(!(r==="modern"?n.rsmv.modern:n.rsmv.classic))if(r==="classic")s("info","Initializing Classic Pipeline..."),await n.initClassicPipeline();else{s("warning","Modern RS3 Cache not linked. Please drop .jcache files into the viewport.");return}const i=r==="modern"?n.rsmv.modern:n.rsmv.classic;if(t.name==="items.json"||t.type==="item_index"){s("info",`Indexing ${r.toUpperCase()} Items...`);const l=await i.getItems();p(l.map(o=>({...o,type:"item"})))}else if(t.name==="npcs.json"||t.type==="npc_index"){s("info",`Indexing ${r.toUpperCase()} NPCs...`);const l=await i.getNPCs();p(l.map(o=>({...o,type:"npc"})))}else if(t.name==="objects.json"||t.type==="object_index"){s("info",`Indexing ${r.toUpperCase()} Objects...`);const l=await i.getObjects();p(l.map(o=>({...o,type:"object"})))}else if(x==="spells"){s("info","Indexing Spells from RSC Config...");const l=await i.getSpells();p(l.map((o,j)=>({...o,id:j,type:"spell"})))}else if(x==="prayers"){s("info","Indexing Prayers from RSC Config...");const l=await i.getPrayers();p(l.map((o,j)=>({...o,id:j,type:"prayer"})))}else if(x==="wall_objects"){s("info","Indexing Wall Objects from RSC Config...");const l=await i.getWallObjects();p(l.map((o,j)=>({...o,id:j,type:"wall_object"})))}else if(x==="tiles"){s("info","Indexing Tiles from RSC Config...");const l=await i.getTiles();p(l.map((o,j)=>({...o,id:j,type:"tile"})))}else p([])}catch(c){console.error("Drill down failed",c),s("error","Archaeological failure during indexing")}},Z=async()=>{if(!a||!a.name)return;const t=r==="classic"?"modern":"classic",c=t==="modern"?n.rsmv.modern:n.rsmv.classic;if(!c){s("warning",`${t.toUpperCase()} pipeline not initialized.`);return}s("info",`Crossing Eras: Matching "${a.name}" in ${t.toUpperCase()}...`);let i=[];a.type==="item"?i=await c.getItems():a.type==="npc"?i=await c.getNPCs():a.type==="object"&&(i=await c.getObjects());const l=i.find(o=>o.name?.toLowerCase()===a.name.toLowerCase());l?(L(t),p(i.map(o=>({...o,type:a.type}))),S({...l,type:a.type}),s("success",`Geometric Match Synchronized: ${l.name} found in ${t.toUpperCase()}`)):s("error",`No literal match for "${a.name}" in ${t.toUpperCase()}`)};return e.jsxs("div",{className:"flex-1 flex gap-6 h-full p-6 bg-black/40 animate-fade-in relative overflow-hidden",children:[e.jsx("div",{className:"w-64 flex flex-col gap-6",children:e.jsxs("div",{className:"glass-ultra rounded-[40px] p-6 border border-white/5 shadow-2xl flex flex-col gap-4 h-full bg-white/5",children:[e.jsx("div",{className:"text-[10px] font-black tracking-[0.4em] text-white/30 uppercase mb-4",children:"Sectors"}),e.jsxs("div",{className:"flex bg-black/20 rounded-2xl p-1 mb-4 border border-white/5",children:[e.jsx("button",{onClick:()=>{L("classic"),p([]),S(null)},className:`flex-1 py-2 rounded-xl text-[9px] font-black uppercase tracking-widest transition-all ${r==="classic"?"bg-neon-cyan/20 text-neon-cyan":"text-white/40 hover:text-white"}`,children:"Classic"}),e.jsx("button",{onClick:()=>{L("modern"),p([]),S(null)},className:`flex-1 py-2 rounded-xl text-[9px] font-black uppercase tracking-widest transition-all ${r==="modern"?"bg-neon-cyan/20 text-neon-cyan":"text-white/40 hover:text-white"}`,children:"Modern"})]}),e.jsx("div",{className:"flex flex-col gap-2 overflow-y-auto pr-2",children:r==="classic"?["archives","ids","config","locations","landscape","skills","spells","prayers","wall_objects","tiles"].map(t=>e.jsx("div",{onClick:()=>{I(t),p([]),S(null)},className:`p-4 glass rounded-2xl border flex items-center justify-between cursor-pointer transition-all
                                    ${x===t?"border-cyan-500/40 bg-cyan-500/5":"border-white/5 hover:bg-white/5"}
                                `,children:e.jsx("span",{className:`text-[10px] font-bold uppercase tracking-widest ${x===t?"text-cyan-400":"text-white/60"}`,children:t})},t)):["items","npcs","objects"].map(t=>e.jsx("div",{onClick:()=>U({type:`${t.slice(0,-1)}_index`}),className:"p-4 glass rounded-2xl border flex items-center justify-between cursor-pointer transition-all border-white/5 hover:bg-white/5",children:e.jsx("span",{className:"text-[10px] font-bold uppercase tracking-widest text-white/60",children:t})},t))})]})}),e.jsxs("div",{className:"flex-1 glass-ultra rounded-[40px] border border-white/5 shadow-2xl relative overflow-hidden flex flex-col p-8 bg-white/5",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[10px] font-black uppercase tracking-[0.6em] text-white/40",children:"Reference Terminal"}),e.jsxs("span",{className:"text-[9px] font-mono text-neon-cyan/60 uppercase",children:["ERA: ",r.toUpperCase()," ",y.length>0?"(DRILL_ACTIVE)":""]})]}),e.jsx("div",{className:"flex items-center gap-4",children:y.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",placeholder:"Search relics...",value:h,onChange:t=>g(t.target.value),className:"bg-white/5 border border-white/10 rounded-full px-4 py-1.5 text-[10px] text-white focus:outline-none focus:border-neon-cyan/40 w-48 font-mono"}),e.jsx("button",{onClick:()=>{p([]),g("")},className:"text-[10px] font-bold uppercase text-neon-magenta hover:underline",children:"Reset"})]})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto pr-2 space-y-2",children:(y.length>0?y.filter(t=>(t.name||"").toLowerCase().includes(h.toLowerCase())||String(t.id).includes(h)):f).map((t,c)=>e.jsxs("div",{onClick:()=>{y.length>0?S(t):x==="ids"&&r==="classic"&&U(t)},className:`p-4 glass-ultra rounded-2xl border flex items-center justify-between transition-all cursor-pointer
                                ${a?.id===t.id&&y.length>0&&a?.type===t.type?"bg-cyan-500/10 border-cyan-500/40":"border-white/5 hover:bg-white/5"}
                            `,children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-8 h-8 rounded bg-white/5 flex items-center justify-center text-[10px]",children:y.length>0?t.type==="npc"?"ðŸ‘¤":t.type==="object"?"ðŸ—¿":"âš”ï¸":t.type==="identity_matrix"?"ðŸ†”":"ðŸ“„"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[10px] font-bold text-white uppercase tracking-widest",children:t.name||`Asset ${t.id}`}),m?.id===t.id&&m?.type===t.type&&e.jsx("span",{className:"text-[8px] px-1.5 py-0.5 bg-neon-cyan/20 text-neon-cyan font-black rounded uppercase",children:"Active"})]}),e.jsx("span",{className:"text-[8px] font-mono text-white/30 truncate max-w-[200px]",children:t.description||t.path||`${t.size||0} bytes`})]})]}),y.length===0&&r==="classic"&&e.jsx("button",{onClick:i=>{i.stopPropagation(),Y(t)},className:"px-3 py-1 bg-white/5 border border-white/10 text-white/40 text-[8px] font-bold uppercase rounded hover:bg-white/10",children:"Fork"})]},t.name||t.id))})]}),e.jsx("div",{className:"flex-1 glass-ultra rounded-[40px] border border-white/5 shadow-2xl relative overflow-hidden bg-white/5 flex flex-col",children:a?e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("div",{className:"flex-1 min-h-[400px]",children:e.jsx(se,{id:a.id,category:a.type,era:r})}),e.jsxs("div",{className:"p-8 border-t border-white/5 bg-black/40",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("div",{className:"text-[10px] font-black text-neon-cyan uppercase tracking-widest",children:"Asset Metadata"}),e.jsx("button",{onClick:Z,className:"text-[9px] font-bold text-white/40 hover:text-white uppercase tracking-widest flex items-center gap-2",children:e.jsxs("span",{children:["ðŸ” Match in ",r==="classic"?"Modern":"Classic"]})})]}),J?e.jsxs("div",{className:"space-y-4 animate-in fade-in slide-in-from-bottom-2",children:[e.jsx("textarea",{className:"w-full bg-white/5 border border-white/10 rounded-xl p-4 text-[10px] text-white/80 font-mono focus:outline-none focus:border-neon-cyan/40",rows:6,defaultValue:JSON.stringify(a.metadata||{},null,2)}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>D(!1),className:"flex-1 py-3 bg-white/5 border border-white/10 rounded-xl text-white/40 text-[9px] font-black uppercase tracking-widest hover:bg-white/10",children:"Cancel"}),e.jsx("button",{onClick:()=>{s("info","AI Orchestrator: Proposal generated for asset refinement"),D(!1)},className:"flex-1 py-3 bg-neon-magenta/20 border border-neon-magenta/30 rounded-xl text-neon-magenta text-[9px] font-black uppercase tracking-widest hover:bg-neon-magenta/40",children:"Push Change"})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"glass p-4 rounded-xl border border-white/5",children:[e.jsx("div",{className:"text-[8px] text-white/20 uppercase mb-1",children:"Name"}),e.jsx("div",{className:"text-[11px] text-white font-bold",children:a.name})]}),e.jsxs("div",{className:"glass p-4 rounded-xl border border-white/5",children:[e.jsx("div",{className:"text-[8px] text-white/20 uppercase mb-1",children:"Index ID"}),e.jsx("div",{className:"text-[11px] text-white font-mono",children:a.id})]})]}),e.jsxs("div",{className:"glass p-4 rounded-xl border border-white/5",children:[e.jsx("div",{className:"text-[8px] text-white/20 uppercase mb-1",children:"Description"}),e.jsx("div",{className:"text-[10px] text-white/60 italic leading-relaxed",children:a.description||"No archaeological data available for this relic."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:H,className:"flex-1 py-4 bg-neon-magenta/10 border border-neon-magenta/20 rounded-xl text-neon-magenta text-[10px] font-black uppercase tracking-widest hover:bg-neon-magenta/20 transition-all",children:"Logic"}),e.jsx("button",{onClick:G,className:"flex-1 py-4 bg-neon-cyan/10 border border-neon-cyan/20 rounded-xl text-neon-cyan text-[10px] font-black uppercase tracking-widest hover:bg-neon-cyan/20 transition-all",children:"Forensic"}),e.jsx("button",{onClick:W,className:"flex-1 py-4 bg-white/5 border border-white/10 rounded-xl text-white/40 text-[10px] font-black uppercase tracking-widest hover:bg-white/10",children:"Blueprint"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>R(a),className:"flex-[2] py-4 bg-neon-cyan/20 border border-neon-cyan/30 rounded-xl text-neon-cyan text-[10px] font-black uppercase tracking-widest hover:bg-neon-cyan/40 transition-all",children:"Pin as Active"}),e.jsx("button",{onClick:()=>D(!0),className:"flex-1 py-4 bg-white/5 border border-white/10 rounded-xl text-white/40 text-[10px] font-black uppercase tracking-widest hover:bg-white/10",children:"Edit"})]})]})]})]}):e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-12 text-center opacity-20",children:[e.jsxs("div",{className:"text-6xl mb-6 flex gap-4",children:[e.jsx("span",{className:"animate-pulse",children:"ðŸ’Ž"}),e.jsx("span",{className:"animate-pulse delay-75",children:"ðŸ“œ"}),e.jsx("span",{className:"animate-pulse delay-150",children:"ðŸº"})]}),e.jsxs("div",{className:"text-[10px] font-black uppercase tracking-[0.4em]",children:["Initialize ",r.toUpperCase()," Pipeline"]}),e.jsx("div",{className:"text-[9px] font-mono mt-2",children:"Select an artifact to begin visualization"})]})}),u&&e.jsxs("div",{className:"absolute inset-x-0 bottom-0 top-1/2 bg-black/90 border-t border-neon-magenta/40 backdrop-blur-xl p-8 z-50 animate-in slide-in-from-bottom-full duration-500",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] font-black text-neon-magenta uppercase tracking-[0.5em]",children:A?"Forensic Gameplay Handling":"Archeological Logic Stream"}),e.jsx("span",{className:"text-[8px] font-mono text-white/40 uppercase",children:A?`SOURCE: ${A}`:"AUTHENTIC_RECOGNITION_MODE_ACTIVE"})]}),e.jsx("button",{onClick:()=>w(null),className:"text-[10px] font-black text-white/40 hover:text-neon-magenta uppercase tracking-widest transition-all",children:"Collapse [ESC]"})]}),e.jsx("pre",{className:"text-[11px] font-mono text-neon-cyan/80 overflow-y-auto h-full pb-12 leading-relaxed",children:u})]}),V&&e.jsxs("div",{className:"absolute inset-0 bg-black/90 backdrop-blur-3xl z-50 flex flex-col p-12 animate-in fade-in zoom-in duration-500",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xl font-black text-white uppercase tracking-[0.2em]",children:"Landscape Blueprint"}),e.jsxs("span",{className:"text-[9px] font-mono text-neon-cyan uppercase",children:["Region Restoration: Sector ",a?.id]})]}),e.jsx("button",{onClick:()=>F(!1),className:"px-6 py-2 bg-white/5 border border-white/10 rounded-full text-white/40 text-[10px] font-black uppercase tracking-widest hover:bg-white/10 transition-all",children:"Secure Vault"})]}),e.jsxs("div",{className:"flex-1 border border-white/10 rounded-[40px] bg-white/5 relative overflow-hidden flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 opacity-20 pointer-events-none",style:{backgroundImage:"radial-gradient(circle at 2px 2px, rgba(255,255,255,0.05) 1px, transparent 0)",backgroundSize:"24px 24px"}}),e.jsx("div",{className:"text-[10px] font-black text-neon-cyan uppercase tracking-[1em] animate-pulse",children:"Blueprint_Reconstruction_In_Progress"})]})]})]})}export{oe as RelicWorkspace};

const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/enginecache-DOiY41nD.js","assets/main-Cu5wNbky.js","assets/main-BN3eHhBo.css","assets/three.module-aN59MUBe.js"])))=>i.map(i=>d[i]);
import{p as Ft,s as We,_ as _t,l as de}from"./main-Cu5wNbky.js";import{a as Ct,E as Mt,b as Et,T as St,R as ve}from"./enginecache-DOiY41nD.js";import{ah as Rt,Z as Ut,N as $e,af as kt,ai as It,j as At,h as Ot,G as Nt}from"./three.module-aN59MUBe.js";import"../src/services/rsmv/clientscript/index.ts";import"../src/services/rsmv/clientscript/interpreter.ts";class ae{data;caret;constructor(d){this.data=new Uint8Array(d),this.caret=0}get size(){return this.data.length}oobError(){return new RangeError("out of bounds")}getUByte(){if(this.caret+1>this.size)throw this.oobError();const d=this.data[this.caret]>>>0;return this.caret+=1,d}getUShort(){if(this.caret+2>this.size)throw this.oobError();let d=(this.data[this.caret]&255)<<8>>>0;return d=(d|this.data[this.caret+1]&255)>>>0,this.caret+=2,d}getUInt3(){if(this.caret+3>this.size)throw this.oobError();let d=(this.data[this.caret]&255)<<16>>>0;return d=(d|(this.data[this.caret+1]&255)<<8)>>>0,d=(d|this.data[this.caret+2]&255)>>>0,this.caret+=3,d}getInt4(){if(this.caret+4>this.size)throw this.oobError();let d=(this.data[this.caret]&255)<<24;return d=d|(this.data[this.caret+1]&255)<<16,d=d|(this.data[this.caret+2]&255)<<8,d=d|this.data[this.caret+3]&255,this.caret+=4,d}getBytes(d,h){const m=h===void 0||isNaN(h)?this.caret:h,c=this.data.slice(m,m+d);return this.caret+=d,c}writeUByte(d){this.data[this.caret]=d,this.caret+=1}writeUShort(d){this.data[this.caret]=d>>8&255,this.data[this.caret+1]=d&255,this.caret+=2}writeUInt3(d){this.data[this.caret]=d>>16>>>0,this.data[this.caret+1]=d>>8>>>0,this.data[this.caret+2]=d&255,this.caret+=3}writeInt4(d){this.data[this.caret]=d>>24,this.data[this.caret+1]=d>>16,this.data[this.caret+2]=d>>8,this.data[this.caret+3]=d&255,this.caret+=4}}var ue={exports:{}},Xe;function fe(){return Xe||(Xe=1,Object.freeze?ue.exports=Object.freeze:ue.exports=function(U){return U}),ue.exports}var me,Ze;function Q(){if(Ze)return me;Ze=1;const U=fe();var d=-1,h=function(){};return h.prototype.readByte=function(){var m=[0],c=this.read(m,0,1);return c===0?(this._eof=!0,d):m[0]},h.prototype.read=function(m,c,u){for(var n,l=0;l<u;){if(n=this.readByte(),n===d){this._eof=!0;break}m[c+l++]=n}return l},h.prototype.eof=function(){return!!this._eof},h.prototype.seek=function(m){throw new Error("Stream is not seekable.")},h.prototype.tell=function(){throw new Error("Stream is not seekable.")},h.prototype.writeByte=function(m){var c=[m];this.write(c,0,1)},h.prototype.write=function(m,c,u){var n;for(n=0;n<u;n++)this.writeByte(m[c+n]);return u},h.prototype.flush=function(){},h.EOF=d,me=U(h),me}var be,Ye;function ce(){if(Ye)return be;Ye=1;const U=Q();var d=function(h){(function(){var m=256;this.readBit=function(){if((m&255)===0){var c=h.readByte();if(c===U.EOF)return this._eof=!0,c;m=c<<1|1}var u=m&256?1:0;return m<<=1,u},this.seekBit=function(c){var u=c>>>3,n=c-u*8;this.seek(u),this._eof=!1,this.readBits(n)},this.tellBit=function(){for(var c=h.tell()*8,u=m;(u&255)!==0;)c--,u<<=1;return c},this.readByte=function(){return(m&255)===0?h.readByte():this.readBits(8)},this.seek=function(c){h.seek(c),m=256}}).call(this),(function(){var m=1;this.writeBit=function(c){m<<=1,c&&(m|=1),m&256&&(h.writeByte(m&255),m=1)},this.writeByte=function(c){m===1?h.writeByte(c):h.writeBits(8,c)},this.flush=function(){for(;m!==1;)this.writeBit(0);h.flush&&h.flush()}}).call(this)};return d.EOF=U.EOF,d.prototype=Object.create(U.prototype),d.prototype.readBits=function(h){var m,c=0;if(h>31)return c=this.readBits(h-16)*65536,c+this.readBits(16);for(m=0;m<h;m++)c<<=1,this.readBit()>0&&c++;return c},d.prototype.writeBits=function(h,m){if(h>32){var c=m&65535,u=(m-c)/65536;this.writeBits(h-16,u),this.writeBits(16,c);return}var n;for(n=h-1;n>=0;n--)this.writeBit(m>>>n&1)},be=d,be}var we,Ke;function Y(){if(Ke)return we;Ke=1;const U=fe(),d=Q();var h=Object.create(null),m=d.EOF;h.coerceInputStream=function(r,e){if("readByte"in r){if(e&&!("read"in r)){var s=r;r=new d,r.readByte=function(){var o=s.readByte();return o===m&&(this._eof=!0),o},"size"in s&&(r.size=s.size),"seek"in s&&(r.seek=function(o){s.seek(o),this._eof=!1}),"tell"in s&&(r.tell=s.tell.bind(s))}}else{var i=r;r=new d,r.size=i.length,r.pos=0,r.readByte=function(){return this.pos>=this.size?m:i[this.pos++]},r.read=function(o,f,b){for(var a=0;a<b&&this.pos<i.length;)o[f++]=i[this.pos++],a++;return a},r.seek=function(o){this.pos=o},r.tell=function(){return this.pos},r.eof=function(){return this.pos>=i.length}}return r};var c=function(r,e){this.buffer=r,this.resizeOk=e,this.pos=0};c.prototype=Object.create(d.prototype),c.prototype.writeByte=function(r){if(this.resizeOk&&this.pos>=this.buffer.length){var e=h.makeU8Buffer(this.buffer.length*2);e.set(this.buffer),this.buffer=e}this.buffer[this.pos++]=r},c.prototype.getBuffer=function(){if(this.pos!==this.buffer.length){if(!this.resizeOk)throw new TypeError("outputsize does not match decoded input");var r=h.makeU8Buffer(this.pos);r.set(this.buffer.subarray(0,this.pos)),this.buffer=r}return this.buffer},h.coerceOutputStream=function(r,e){var i={stream:r,retval:r};if(r){if(typeof r=="object"&&"writeByte"in r)return i;typeof e=="number"?(console.assert(e>=0),i.stream=new c(h.makeU8Buffer(e),!1)):i.stream=new c(r,!1)}else i.stream=new c(h.makeU8Buffer(16384),!0);return Object.defineProperty(i,"retval",{get:i.stream.getBuffer.bind(i.stream)}),i},h.compressFileHelper=function(r,e,i){return function(s,o,f){s=h.coerceInputStream(s);var b=h.coerceOutputStream(o,o);o=b.stream;var a;for(a=0;a<r.length;a++)o.writeByte(r.charCodeAt(a));var w;if("size"in s&&s.size>=0?w=s.size:w=-1,i){var v=h.coerceOutputStream([]);for(h.writeUnsignedNumber(v.stream,w+1),v=v.retval,a=0;a<v.length-1;a++)o.writeByte(v[a]);i=v[v.length-1]}else h.writeUnsignedNumber(o,w+1);return e(s,o,w,f,i),b.retval}},h.decompressFileHelper=function(r,e){return function(i,s){i=h.coerceInputStream(i);var o;for(o=0;o<r.length;o++)if(r.charCodeAt(o)!==i.readByte())throw new Error("Bad magic");var f=h.readUnsignedNumber(i)-1,b=h.coerceOutputStream(s,f);return s=b.stream,e(i,s,f),b.retval}},h.compressWithModel=function(r,e,i){for(var s=0;s!==e;){var o=r.readByte();if(o===m){i.encode(256);break}i.encode(o),s++}},h.decompressWithModel=function(r,e,i){for(var s=0;s!==e;){var o=i.decode();if(o===256)break;r.writeByte(o),s++}},h.writeUnsignedNumber=function(r,e){console.assert(e>=0);var i=[],s;do i.push(e&127),e=Math.floor(e/128);while(e!==0);for(i[0]|=128,s=i.length-1;s>=0;s--)r.writeByte(i[s]);return r},h.readUnsignedNumber=function(r){for(var e=0,i;;){if(i=r.readByte(),i&128){e+=i&127;break}e=(e+i)*128}return e};var u=function(r){for(var e=0,i=r.length;e<i;e++)r[e]=0;return r},n=function(r){return u(new Array(r))},l=function(e){return e};typeof Ft<"u"&&Array.prototype.some.call(new Uint32Array(128),function(r){return r!==0})&&(l=u),h.makeU8Buffer=typeof Uint8Array<"u"?function(r){return l(new Uint8Array(r))}:typeof We.Buffer<"u"?function(r){var e=new We.Buffer(r);return e.fill(0),e}:n,h.makeU16Buffer=typeof Uint16Array<"u"?function(r){return l(new Uint16Array(r))}:n,h.makeU32Buffer=typeof Uint32Array<"u"?function(r){return l(new Uint32Array(r))}:n,h.makeS32Buffer=typeof Int32Array<"u"?function(r){return l(new Int32Array(r))}:n,h.arraycopy=function(r,e){console.assert(r.length>=e.length);for(var i=0,s=e.length;i<s;i++)r[i]=e[i];return r};var p=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8];console.assert(p.length===256);var t=h.fls=function(r){return console.assert(r>=0),r>4294967295?32+t(Math.floor(r/4294967296)):(r&4294901760)!==0?(r&4278190080)!==0?24+p[r>>>24&255]:16+p[r>>>16]:(r&65280)!==0?8+p[r>>>8]:p[r]};return h.log2c=function(r){return r===0?-1:t(r-1)},we=U(h),we}var ye,Ve;function Le(){if(Ve)return ye;Ve=1;const U=fe(),d=Y();var h=console.assert.bind(console),m=function(e,i,s,o){var f;for(f=0;f<o;f++)i[f]=0;for(f=0;f<s;f++)i[e[f]]++},c=function(e,i,s,o){var f,b=0;if(o)for(f=0;f<s;f++)b+=e[f],i[f]=b;else for(f=0;f<s;f++)b+=e[f],i[f]=b-e[f]},u=function(e,i,s,o,f,b){var a,w,v,B,E;for(s===o&&m(e,s,f,b),c(s,o,b,!1),v=f-1,a=o[E=e[v]],v--,i[a++]=e[v]<E?~v:v,w=0;w<f;w++)(v=i[w])>0?(h(e[v]>=e[v+1]),(B=e[v])!==E&&(o[E]=a,a=o[E=B]),h(w<a),v--,i[a++]=e[v]<E?~v:v,i[w]=0):v<0&&(i[w]=~v);for(s===o&&m(e,s,f,b),c(s,o,b,1),w=f-1,a=o[E=0];w>=0;w--)(v=i[w])>0&&(h(e[v]<=e[v+1]),(B=e[v])!==E&&(o[E]=a,a=o[E=B]),h(a<=w),v--,i[--a]=e[v]>E?~(v+1):v,i[w]=0)},n=function(e,i,s,o){var f,b,a,w,v,B,E,R,S,I;for(h(s>0),f=0;(a=i[f])<0;f++)i[f]=~a,h(f+1<s);if(f<o)for(b=f,f++;h(f<s),!((a=i[f])<0&&(i[b++]=~a,i[f]=0,b===o));f++);R=e[f=b=s-1];do S=R;while(--f>=0&&(R=e[f])>=S);for(;f>=0;){do S=R;while(--f>=0&&(R=e[f])<=S);if(f>=0){i[o+(f+1>>>1)]=b-f,b=f+1;do S=R;while(--f>=0&&(R=e[f])>=S)}}for(f=0,E=0,w=s,B=0;f<o;f++){if(a=i[f],v=i[o+(a>>>1)],I=!0,v===B&&w+v<s){for(b=0;b<v&&e[a+b]===e[w+b];)b++;b===v&&(I=!1)}I&&(E++,w=a,B=v),i[o+(a>>>1)]=E}return E},l=function(e,i,s,o,f,b){var a,w,v,B,E;for(s===o&&m(e,s,f,b),c(s,o,b,!1),v=f-1,a=o[E=e[v]],i[a++]=v>0&&e[v-1]<E?~v:v,w=0;w<f;w++)v=i[w],i[w]=~v,v>0&&(v--,h(e[v]>=e[v+1]),(B=e[v])!==E&&(o[E]=a,a=o[E=B]),h(w<a),i[a++]=v>0&&e[v-1]<E?~v:v);for(s===o&&m(e,s,f,b),c(s,o,b,!0),w=f-1,a=o[E=0];w>=0;w--)(v=i[w])>0?(v--,h(e[v]<=e[v+1]),(B=e[v])!==E&&(o[E]=a,a=o[E=B]),h(a<=w),i[--a]=v===0||e[v-1]>E?~v:v):i[w]=~v},p=function(e,i,s,o,f,b){var a,w,v,B=-1,E,R;for(s===o&&m(e,s,f,b),c(s,o,b,!1),v=f-1,a=o[R=e[v]],i[a++]=v>0&&e[v-1]<R?~v:v,w=0;w<f;w++)(v=i[w])>0?(v--,h(e[v]>=e[v+1]),i[w]=~(E=e[v]),E!==R&&(o[R]=a,a=o[R=E]),h(w<a),i[a++]=v>0&&e[v-1]<R?~v:v):v!==0&&(i[w]=~v);for(s===o&&m(e,s,f,b),c(s,o,b,!0),w=f-1,a=o[R=0];w>=0;w--)(v=i[w])>0?(v--,h(e[v]<=e[v+1]),i[w]=E=e[v],E!==R&&(o[R]=a,a=o[R=E]),h(a<=w),i[--a]=v>0&&e[v-1]>R?~e[v-1]:v):v!==0?i[w]=~v:B=w;return B},t=function(e,i,s,o,f,b){var a,w,v,B,E,R,S,I,k,N,x=0,_,y,F,g=0;for(f<=256?(a=d.makeS32Buffer(f),f<=s?(w=i.subarray(o+s-f),g=1):(w=d.makeS32Buffer(f),g=3)):f<=s?(a=i.subarray(o+s-f),f<=s-f?(w=i.subarray(o+s-f*2),g=0):f<=1024?(w=d.makeS32Buffer(f),g=2):(w=a,g=8)):(a=w=d.makeS32Buffer(f),g=12),m(e,a,o,f),c(a,w,f,!0),B=0;B<o;B++)i[B]=0;R=-1,B=o-1,E=o,S=0,y=e[o-1];do F=y;while(--B>=0&&(y=e[B])>=F);for(;B>=0;){do F=y;while(--B>=0&&(y=e[B])<=F);if(B>=0){R>=0&&(i[R]=E),R=--w[F],E=B,++S;do F=y;while(--B>=0&&(y=e[B])>=F)}}if(S>1?(u(e,i,a,w,o,f),N=n(e,i,o,S)):S===1?(i[R]=E+1,N=1):N=0,N<S){for((g&4)!==0&&(a=null,w=null),(g&2)!==0&&(w=null),_=o+s-S*2,(g&13)===0&&(f+N<=_?_-=f:g|=8),h(o>>>1<=_+S),B=S+(o>>>1)-1,E=S*2+_-1;S<=B;B--)i[B]!==0&&(i[E--]=i[B]-1);v=i.subarray(S+_),t(v,i,_,S,N,!1),v=null,B=o-1,E=S*2-1,y=e[o-1];do F=y;while(--B>=0&&(y=e[B])>=F);for(;B>=0;){do F=y;while(--B>=0&&(y=e[B])<=F);if(B>=0){i[E--]=B+1;do F=y;while(--B>=0&&(y=e[B])>=F)}}for(B=0;B<S;B++)i[B]=i[S+i[B]];(g&4)!==0&&(a=w=d.makeS32Buffer(f)),(g&2)!==0&&(w=d.makeS32Buffer(f))}if((g&8)!==0&&m(e,a,o,f),S>1){c(a,w,f,!0),B=S-1,E=o,I=i[S-1],F=e[I];do{for(k=w[y=F];k<E;)i[--E]=0;do{if(i[--E]=I,--B<0)break;I=i[B]}while((F=e[I])===y)}while(B>=0);for(;E>0;)i[--E]=0}return b?x=p(e,i,a,w,o,f):l(e,i,a,w,o,f),a=null,w=null,x},r=Object.create(null);return r.suffixsort=function(e,i,s,o){if(h(e&&i&&e.length>=s&&i.length>=s),s<=1)return s===1&&(i[0]=0),0;if(!o)if(e.BYTES_PER_ELEMENT===1)o=256;else if(e.BYTES_PER_ELEMENT===2)o=65536;else throw new Error("Need to specify alphabetSize");return h(o>0),e.BYTES_PER_ELEMENT&&h(o<=1<<e.BYTES_PER_ELEMENT*8),t(e,i,0,s,o,!1)},r.bwtransform=function(e,i,s,o,f){var b,a;if(h(e&&i&&s),h(e.length>=o&&i.length>=o&&s.length>=o),o<=1)return o===1&&(i[0]=e[0]),o;if(!f)if(e.BYTES_PER_ELEMENT===1)f=256;else if(e.BYTES_PER_ELEMENT===2)f=65536;else throw new Error("Need to specify alphabetSize");for(h(f>0),e.BYTES_PER_ELEMENT&&h(f<=1<<e.BYTES_PER_ELEMENT*8),a=t(e,s,0,o,f,!0),i[0]=e[o-1],b=0;b<a;b++)i[b+1]=s[b];for(b+=1;b<o;b++)i[b]=s[b];return a+1},r.unbwtransform=function(e,i,s,o,f){var b=d.makeU32Buffer(256),a,w;for(a=0;a<256;a++)b[a]=0;for(a=0;a<o;a++)s[a]=b[e[a]]++;for(a=0,w=0;a<256;a++)w+=b[a],b[a]=w-b[a];for(a=o-1,w=0;a>=0;a--)w=s[w]+b[i[a]=e[w]],w+=w<f?1:0;b=null},r.bwtransform2=function(e,i,s,o){var f,b,a=0;if(h(e&&i),h(e.length>=s&&i.length>=s),s<=1)return s===1&&(i[0]=e[0]),0;if(!o)if(e.BYTES_PER_ELEMENT===1)o=256;else if(e.BYTES_PER_ELEMENT===2)o=65536;else throw new Error("Need to specify alphabetSize");h(o>0),e.BYTES_PER_ELEMENT&&h(o<=1<<e.BYTES_PER_ELEMENT*8);var w;if(e.length>=s*2?w=e:o<=256?w=d.makeU8Buffer(s*2):o<=65536?w=d.makeU16Buffer(s*2):w=d.makeU32Buffer(s*2),w!==e)for(f=0;f<s;f++)w[f]=e[f];for(f=0;f<s;f++)w[s+f]=w[f];var v=d.makeS32Buffer(s*2);for(t(w,v,0,s*2,o,!1),f=0,b=0;f<2*s;f++){var B=v[f];B<s&&(B===0&&(a=b),--B<0&&(B=s-1),i[b++]=e[B])}return h(b===s),a},ye=U(r),ye}var xe,Je;function qe(){if(Je)return xe;Je=1;const U=ce(),d=Y();var h=function(c,u,n,l){this.up=c,this.down=u,this.symbol=n,this.weight=l};h.prototype.clone=function(){return new h(this.up,this.down,this.symbol,this.weight)},h.prototype.set=function(c){this.up=c.up,this.down=c.down,this.symbol=c.symbol,this.weight=c.weight};var m=function(c,u,n,l){var p;for(console.assert(c&&typeof c=="number"),(!u||u>c)&&(u=c),(u<<=1)&&u--,this.table=[],p=0;p<=u;p++)this.table[p]=new h(0,0,0,0);if(this.map=[],this.size=c)for(p=0;p<c;p++)this.map[p]=0;this.esc=this.root=u,n&&(this.readBit=n.readBit.bind(n),this.writeBit=n.writeBit.bind(n)),this.max_weight=l};return m.factory=function(c,u){return function(n){return new m(n,n,c,u)}},m.prototype.split=function(c){var u,n;if(u=this.esc)this.esc--;else return console.assert(!1),0;return(n=this.esc)?(this.table[u].down=n,this.table[u].weight=1,this.table[n].up=u,this.esc--):(u=0,n=1),this.table[n].symbol=c,this.table[n].weight=0,this.table[n].down=0,this.map[c]=n,this.table[this.esc].weight=0,this.table[this.esc].down=0,this.table[this.esc].up=u,n},m.prototype.leader=function(c){for(var u=this.table[c].weight,n=c,l,p;u===this.table[n+1].weight;)n++;return n===c?c:(p=this.table[c].symbol,l=this.table[n].symbol,this.table[n].symbol=p,this.table[c].symbol=l,this.map[p]=n,this.map[l]=c,n)},m.prototype.slide=function(c){var u=c,n;if(n=this.table[u++].clone(),n.weight&1)for(;n.weight>this.table[u+1].weight;)u++;return this.table[c].set(this.table[u]),this.table[u].set(n),this.table[u].up=this.table[c].up,this.table[c].up=n.up,n.weight&1?(this.table[n.down].up=u,this.table[n.down-1].up=u,this.map[this.table[c].symbol]=c):(this.table[this.table[c].down-1].up=c,this.table[this.table[c].down].up=c,this.map[n.symbol]=u),u},m.prototype.increment=function(c){var u;for(this.table[c].up===c+1?(this.table[c].weight+=2,c++):c=this.leader(c);this.table[c].weight+=2,u=this.table[c].up;){for(;this.table[c].weight>this.table[c+1].weight;)c=this.slide(c);this.table[c].weight&1?c=u:c=this.table[c].up}this.max_weight&&this.table[this.root].weight>=this.max_weight&&this.scale(1)},m.prototype.scale=function(c){for(var u=this.esc,n,l;++u<=this.root;)for(this.table[u].weight&1?(n=this.table[this.table[u].down].weight&-2)&&(n+=this.table[this.table[u].down-1].weight|1):(n=this.table[u].weight>>c&-2)||(this.map[this.table[u].symbol]=0,this.esc++&&this.esc++),this.table[u].weight=n,l=u;n<this.table[--l].weight;)this.slide(l);this.table[this.esc].down=0},m.prototype.sendid=function(c){for(var u=0,n;c--;)this.map[c]||u++;if(n=this.size-Math.floor((this.root-this.esc)/2)-1)do this.writeBit(u&1),u>>=1;while(n>>=1)},m.prototype.encode=function(c){var u=1,n,l,p,t;if(c<this.size)t=this.map[c];else{console.assert(!1);return}if(!(!(p=t)&&!(p=this.esc))){for(;l=this.table[p].up;)u<<=1,u|=p&1,p=l;for(;n=u&1,u>>=1;)this.writeBit(n);t||(this.sendid(c),t=this.split(c)),this.increment(t)}},m.prototype.readid=function(){var c=0,u=1,n,l;if(n=this.size-Math.floor((this.root-this.esc)/2)-1)do c|=this.readBit()?u:0,u<<=1;while(n>>=1);for(l=0;l<this.size;l++)if(!this.map[l]&&!c--)return l;return console.assert(!1),0},m.prototype.decode=function(){for(var c=this.root,u,n;n=this.table[c].down;)this.readBit()?c=n-1:c=n;if(c===this.esc)if(this.esc)u=this.readid(),c=this.split(u);else return console.assert(!1),0;else u=this.table[c].symbol;return this.increment(c),u},m.MAGIC="huff",m.compressFile=d.compressFileHelper(m.MAGIC,function(c,u,n,l){var p=new U(u),t=256;n<0&&t++;var r=new m(257,t,p,8191);d.compressWithModel(c,n,r),p.flush()}),m.decompressFile=d.decompressFileHelper(m.MAGIC,function(c,u,n){var l=new U(c),p=256;n<0&&p++;var t=new m(257,p,l,8191);d.decompressWithModel(u,n,t)}),xe=m,xe}var Be,Qe;function je(){if(Qe)return Be;Qe=1;const U=ce(),d=qe(),h=Y();var m=function(c,u,n){var l;for(this.literalModel=[],l=0;l<u;l++)this.literalModel[l]=c(n)};return m.prototype.encode=function(c,u){this.literalModel[u].encode(c)},m.prototype.decode=function(c){return this.literalModel[c].decode()},m.MAGIC="ctx1",m.compressFile=h.compressFileHelper(m.MAGIC,function(c,u,n,l){var p=new U(u),t=256;n<0&&t++;var r=d.factory(p,8191),e=new m(r,256,t),i=32,s={encode:function(o){e.encode(o,i),i=o}};h.compressWithModel(c,n,s),p.flush()}),m.decompressFile=h.decompressFileHelper(m.MAGIC,function(c,u,n){var l=new U(c),p=256;n<0&&p++;var t=d.factory(l,8191),r=new m(t,256,p),e=32,i={decode:function(){var s=r.decode(e);return e=s,s}};h.decompressWithModel(u,n,i)}),Be=m,Be}var ge,et;function re(){if(et)return ge;et=1;var U=32,d=Math.pow(2,U-1),h=U-9,m=(U-2)%8+1,c=d>>>8,u=Math.pow(2,U)-1,n=function(t){this.low=0,this.range=d,this.buffer=0,this.help=0,this.bytecount=0,this.stream=t},l=function(t,r){for(;t.range<=c;){if(t.low<255<<h){for(r.writeByte(t.buffer);t.help;t.help--)r.writeByte(255);t.buffer=t.low>>>h&255}else if(t.low&d){for(r.writeByte(t.buffer+1);t.help;t.help--)r.writeByte(0);t.buffer=t.low>>>h&255}else if(t.help++,t.help>u)throw new Error("Too many bytes outstanding, file too large!");t.range=t.range<<8>>>0,t.low=(t.low<<8&d-1)>>>0,t.bytecount++}};n.prototype.encodeStart=function(t,r){this.low=0,this.range=d,this.buffer=t,this.help=0,this.bytecount=r},n.prototype.encodeFreq=function(t,r,e){l(this,this.stream);var i=this.range/e>>>0,s=i*r;this.low+=s,r+t<e?this.range=i*t:this.range-=s},n.prototype.encodeShift=function(t,r,e){l(this,this.stream);var i=this.range>>>e,s=i*r;this.low+=s,r+t>>>e?this.range-=s:this.range=i*t},n.prototype.encodeBit=function(t){this.encodeShift(1,t?1:0,1)},n.prototype.encodeByte=function(t){this.encodeShift(1,t,8)},n.prototype.encodeShort=function(t){this.encodeShift(1,t,16)},n.prototype.encodeFinish=function(){var t=this.stream;l(this,t),this.bytecount+=5;var r=this.low>>>h;if((this.low&c-1)>=(this.bytecount&16777215)>>>1&&r++,r>255)for(t.writeByte(this.buffer+1);this.help;this.help--)t.writeByte(0);else for(t.writeByte(this.buffer);this.help;this.help--)t.writeByte(255);return t.writeByte(r&255),t.writeByte(this.bytecount>>>16&255),t.writeByte(this.bytecount>>>8&255),t.writeByte(this.bytecount&255),this.bytecount},n.prototype.decodeStart=function(t){var r=t?0:this.stream.readByte();return typeof r!="number"||r<0||(this.buffer=this.stream.readByte(),this.low=this.buffer>>>8-m,this.range=1<<m),r};var p=function(t,r){for(;t.range<=c;)t.low=t.low<<8|t.buffer<<m&255,t.buffer=r.readByte(),t.low|=t.buffer>>>8-m,t.low=t.low>>>0,t.range=t.range<<8>>>0};return n.prototype.decodeCulFreq=function(t){p(this,this.stream),this.help=this.range/t>>>0;var r=this.low/this.help>>>0;return r>=t?t-1:r},n.prototype.decodeCulShift=function(t){p(this,this.stream),this.help=this.range>>>t;var r=this.low/this.help>>>0;return r>>>t?(1<<t)-1:r},n.prototype.decodeUpdate=function(t,r,e){var i=this.help*r;this.low-=i,r+t<e?this.range=this.help*t:this.range-=i},n.prototype.decodeBit=function(){var t=this.decodeCulShift(1);return this.decodeUpdate(1,t,2),t},n.prototype.decodeByte=function(){var t=this.decodeCulShift(8);return this.decodeUpdate(1,t,256),t},n.prototype.decodeShort=function(){var t=this.decodeCulShift(16);return this.decodeUpdate(1,t,65536),t},n.prototype.decodeFinish=function(){p(this,this.stream)},n.prototype.writeBit=n.prototype.encodeBit,n.prototype.readBit=n.prototype.decodeBit,n.prototype.writeByte=n.prototype.encodeByte,n.prototype.readByte=n.prototype.decodeByte,ge=n,ge}var Fe,tt;function He(){if(tt)return Fe;tt=1;const U=re();Q();const d=Y();var h=8,m=1<<h,c=40,u=function(n,l,p){var t;console.assert(l<300);var r=this.numSyms=l;for(this.coder=n,this.prob=d.makeU16Buffer(l+2),this.escape=d.makeU16Buffer(l+1),this.update=d.makeU16Buffer(l+1),this.prob[r+1]=m,t=0;t<=this.numSyms;t++)this.escape[t]=t;if(this.updateCount=0,this.updateThresh=m-Math.floor(m/2),!!p){for(this.probToSym=d.makeU16Buffer(m),this.escProbToSym=d.makeU16Buffer(this.numSyms),t=0;t<m;t++)this.probToSym[t]=r;for(t=0;t<this.numSyms;t++)this.escProbToSym[t]=t}};return u.factory=function(n,l){return function(p){return new u(n,p,l)}},u.prototype._update=function(n,l){if(!(n===this.numSyms&&(this.update[n]>=c||this.updateCount>=this.updateThresh-1))&&(this.update[n]++,this.updateCount++,!(this.updateCount<this.updateThresh))){var p,t,r,e,i,s;for(this.escape[0]=this.prob[0]=p=t=r=0,e=0;e<this.numSyms+1;e++){var o=(this.prob[e+1]-this.prob[e]>>>1)+this.update[e];o?(this.prob[e]=p,p+=o,o&1&&r++,this.escape[e]=t):(this.prob[e]=p,this.escape[e]=t,t++)}for(this.prob[e]=p,console.assert(p===m),this.updateThresh=m-Math.floor((p-r)/2),e=0;e<this.numSyms+1;e++)this.update[e]=0;if(this.update[this.numSyms]=1,this.updateCount=1,!!l)for(e=0,i=0,s=0;e<this.numSyms+1;e++){for(var f=this.prob[e+1];i<f;i++)this.probToSym[i]=e;for(var b=this.escape[e+1];s<b;s++)this.escProbToSym[s]=e}}},u.prototype.encode=function(n){var l=this.prob[n],p=this.prob[n+1]-l;if(console.assert(this.prob[this.numSyms+1]===m),p)return this.coder.encodeShift(p,l,h),this._update(n);console.assert(n!==this.numSyms),this.encode(this.numSyms),l=this.escape[n],p=this.escape[n+1]-l;var t=this.escape[this.numSyms];return this.coder.encodeFreq(p,l,t),this._update(n)},u.prototype.decode=function(){var n=this.coder.decodeCulShift(h),l=this.probToSym[n],p=this.prob[l],t=this.prob[l+1]-p;if(this.coder.decodeUpdate(t,p,m),this._update(l,!0),l!==this.numSyms)return l;var r=this.escape[this.numSyms];return n=this.coder.decodeCulFreq(r),l=this.escProbToSym[n],p=this.escape[l],t=this.escape[l+1]-p,this.coder.decodeUpdate(t,p,r),this._update(l,!0),l},u.MAGIC="dfsm",u.compressFile=d.compressFileHelper(u.MAGIC,function(n,l,p,t,r){var e=new U(l);e.encodeStart(r,1);var i=new u(e,p<0?257:256);d.compressWithModel(n,p,i),e.encodeFinish()},!0),u.decompressFile=d.decompressFileHelper(u.MAGIC,function(n,l,p){var t=new U(n);t.decodeStart(!0);var r=new u(t,p<0?257:256,!0);d.decompressWithModel(l,p,r),t.decodeFinish()}),Fe=u,Fe}var _e,rt;function le(){if(rt)return _e;rt=1;const U=re();Q();const d=Y();var h=65280,m=256,c=65535,u=0,n=4294901760,l=16,p=4294901758,t=function(r,e,i,s){this.coder=r,this.numSyms=e+1,this.tree=d.makeU32Buffer(this.numSyms*2),this.increment=+s||m,this.max_prob=+i||h,console.assert(this.max_prob+(this.increment-1)<=65535),console.assert(e<=65535);var o;for(o=0;o<e;o++)this.tree[this.numSyms+o]=1<<u|0<<l;this.tree[this.numSyms+o]=0<<u|this.increment<<l,this._sumTree()};return t.factory=function(r,e,i){return function(s){return new t(r,s,e,i)}},t.prototype.clone=function(){var r=new t(this.coder,this.size,this.max_prob,this.increment),e;for(e=1;e<this.tree.length;e++)r.tree[e]=this.tree[e];return r},t.prototype.encode=function(r){var e=this.numSyms+r,i=this.tree[e],s=n,o=l,f=this.increment<<l;(i&n)===0?(this.encode(this.numSyms-1),s=c,f-=1<<u,o=u):r===this.numSyms-1&&(this.tree[1]&c)>>>u===1&&(f=-this.tree[e]);for(var b=0;e>1;){var a=e&1,w=e>>>1;a&&(b+=this.tree[2*w]),this.tree[e]+=f,e=w}var v=this.tree[1];this.tree[1]+=f,i=(i&s)>>>o,b=(b&s)>>>o,v=(v&s)>>>o,this.coder.encodeFreq(i,b,v),(this.tree[1]&n)>>>l>=this.max_prob&&this._rescale()},t.prototype._decode=function(r){var e=n,i=l,s=this.increment<<l;r&&(e=c,s-=1<<u,i=u);for(var o=(this.tree[1]&e)>>>i,f=this.coder.decodeCulFreq(o),b=1,a=0;b<this.numSyms;){this.tree[b]+=s;var w=(this.tree[2*b]&e)>>>i;b*=2,f-a>=w&&(a+=w,b++)}var v=b-this.numSyms,B=(this.tree[b]&e)>>>i;if(this.tree[b]+=s,this.coder.decodeUpdate(B,a,o),v===this.numSyms-1&&(this.tree[1]&c)>>>u===1)for(s=-this.tree[b];b>=1;)this.tree[b]+=s,b=b>>>1;return(this.tree[1]&n)>>>l>=this.max_prob&&this._rescale(),v},t.prototype.decode=function(){var r=this._decode(!1);return r===this.numSyms-1&&(r=this._decode(!0)),r},t.prototype._rescale=function(){var r,e,i=!0;for(r=0;r<this.numSyms-1;r++){if(e=this.tree[this.numSyms+r],(e&c)!==0){i=!1;continue}e=(e&p)>>>1,e===0&&(e=1<<u,i=!1),this.tree[this.numSyms+r]=e}e=this.tree[this.numSyms+r],e=(e&p)>>>1,i?e=0:e===0&&(e=1<<l),this.tree[this.numSyms+r]=e,this._sumTree()},t.prototype._sumTree=function(){var r;for(r=this.numSyms-1;r>0;r--)this.tree[r]=this.tree[2*r]+this.tree[2*r+1]},t.MAGIC="fenw",t.compressFile=d.compressFileHelper(t.MAGIC,function(r,e,i,s,o){var f=new U(e);f.encodeStart(o,1);var b=new t(f,i<0?257:256);d.compressWithModel(r,i,b),f.encodeFinish()},!0),t.decompressFile=d.decompressFileHelper(t.MAGIC,function(r,e,i){var s=new U(r);s.decodeStart(!0);var o=new t(s,i<0?257:256);d.decompressWithModel(e,i,o),s.decodeFinish()}),_e=t,_e}var Ce,it;function xt(){if(it)return Ce;it=1;const U=re();Q();const d=Y();var h=65280,m=256,c=function(n,l){return n-l},u=function(n,l,p,t,r){this.coder=n,this.increment=+t||m,this.max_prob=+p||h,console.assert(this.max_prob+(this.increment-1)<=65535),this.sym=d.makeU16Buffer(l+1),this.prob=d.makeU16Buffer(l+2),this.sym[0]=l,this.prob[0]=0,this.seenSyms=1,this.prob[this.seenSyms]=this.increment,this.numSyms=l,r&&(this.sortedSeen=[l])};return u.factory=function(n,l,p,t){return function(r){return new u(n,r,l,p,t)}},u.prototype.clone=function(){var n=new u(this.coder,this.numSyms,this.max_prob,this.increment,!!this.sortedSeen),l;for(l=0;l<this.seenSyms;l++)n.sym[l]=this.sym[l],n.prob[l]=this.prob[l];return n.prob[l]=this.prob[l],n.seenSyms=this.seenSyms,this.sortedSeen&&(n.sortedSeen=this.sortedSeen.slice(0)),n},u.prototype._update=function(n,l,p){var t,r;for(t=l;t<this.seenSyms-1;t++)this.sym[t]=this.sym[t+1],this.prob[t]=this.prob[t+1]-p;l<this.seenSyms?(this.sym[t]=n,this.prob[t]=this.prob[t+1]-p,this.prob[this.seenSyms]=r=this.prob[this.seenSyms]+this.increment,n===this.numSyms&&this.seenSyms>=this.numSyms&&(r=this.prob[--this.seenSyms],this.sortedSeen&&this.sortedSeen.length--)):(r=this.prob[this.seenSyms],this.sym[l]=n,this.prob[l]=r,r+=this.increment,this.prob[++this.seenSyms]=r,this.sortedSeen&&(this.sortedSeen.push(n),this.sortedSeen.sort(c))),r>=this.max_prob&&this._rescale()},u.prototype._rescale=function(){var n,l,p=0,t=!0;for(this.sortedSeen&&(this.sortedSeen.length=0),n=0,l=0;n<this.seenSyms;n++){var r=this.sym[n],e=this.prob[n+1]-this.prob[n];e>>>=1,e>0&&(r===this.numSyms&&(t=!1),this.sym[l]=r,this.prob[l++]=p,p+=e,this.sortedSeen&&this.sortedSeen.push(r))}this.prob[l]=p,this.seenSyms=l,this.sortedSeen&&this.sortedSeen.sort(c),t&&this.seenSyms<this.numSyms&&this._update(this.numSyms,this.seenSyms)},u.prototype.decode=function(){var n=this.prob[this.seenSyms],l=this.coder.decodeCulFreq(n),p;for(p=this.seenSyms-1;p>=0&&!(this.prob[p]<=l);p--);console.assert(p>=0);var t=this.sym[p],r=this.prob[p],e=this.prob[p+1]-r;if(this.coder.decodeUpdate(e,r,n),this._update(t,p,e),t===this.numSyms){if(e=1,n=this.numSyms,this.sortedSeen){var i=this.sortedSeen;for(n=this.numSyms-this.seenSyms,i[i.length-1]===this.numSyms&&n++,t=r=this.coder.decodeCulFreq(n),p=0;p<i.length&&i[p]<=t;p++)t++}else t=r=this.coder.decodeCulFreq(n);this.coder.decodeUpdate(e,r,n),this._update(t,this.seenSyms)}return t},u.prototype.encode=function(n){var l,p,t,r;for(l=this.seenSyms-1;l>=0;l--)if(n===this.sym[l])return t=this.prob[l],p=this.prob[l+1]-t,r=this.prob[this.seenSyms],this.coder.encodeFreq(p,t,r),this._update(n,l,p);if(console.assert(n!==this.numSyms),this.encode(this.numSyms),p=1,t=n,r=this.numSyms,this.sortedSeen){var e=this.sortedSeen;for(r-=this.seenSyms,e[e.length-1]===this.numSyms&&r++,l=0;l<e.length&&e[l]<n;l++)t--}return this.coder.encodeFreq(p,t,r),this._update(n,this.seenSyms)},u.MAGIC="mtfm",u.compressFile=d.compressFileHelper(u.MAGIC,function(n,l,p,t,r){var e=new U(l);e.encodeStart(r,1);var i=new u(e,p<0?257:256);d.compressWithModel(n,p,i),e.encodeFinish()},!0),u.decompressFile=d.decompressFileHelper(u.MAGIC,function(n,l,p){var t=new U(n);t.decodeStart(!0);var r=new u(t,p<0?257:256);d.decompressWithModel(l,p,r),t.decodeFinish()}),Ce=u,Ce}var Me,st;function pe(){if(st)return Me;st=1;const U=ce(),d=Y();var h=function(m,c){this.bitstream=m,this.bits=d.fls(c-1)};return h.factory=function(m){return function(c){return new h(m,c)}},h.prototype.encode=function(m){var c;for(c=this.bits-1;c>=0;c--){var u=m>>>c&1;this.bitstream.writeBit(u)}},h.prototype.decode=function(){var m,c=0;for(m=this.bits-1;m>=0;m--)c<<=1,this.bitstream.readBit()&&c++;return c},h.MAGIC="nomo",h.compressFile=d.compressFileHelper(h.MAGIC,function(m,c,u,n){var l=new U(c),p=new h(l,u<0?257:256);d.compressWithModel(m,u,p),l.flush()}),h.decompressFile=d.decompressFileHelper(h.MAGIC,function(m,c,u){var n=new U(m),l=new h(n,u<0?257:256);d.decompressWithModel(c,u,l)}),Me=h,Me}var Ee,ot;function ze(){if(ot)return Ee;ot=1;const U=Y();var d=function(h,m,c,u){var n,l=U.fls(h-1);for(this.extraStates=+m||0,this.lgDistanceModel=c(1+l+m),this.distanceModel=[],n=2;n<=l;n++){var p=n-1;this.distanceModel[n]=u(1<<p)}};return d.prototype.encode=function(h){if(h<2){this.lgDistanceModel.encode(h+this.extraStates);return}var m=U.fls(h);console.assert(h&1<<m-1),console.assert(m>=2),this.lgDistanceModel.encode(m+this.extraStates);var c=h&(1<<m-1)-1;this.distanceModel[m].encode(c)},d.prototype.decode=function(){var h=this.lgDistanceModel.decode()-this.extraStates;if(h<2)return h;var m=this.distanceModel[h].decode();return(1<<h-1)+m},Ee=d,Ee}var Se,nt;function Tt(){if(nt)return Se;nt=1,fe();const U=Q(),d=Le(),h=He(),m=le(),c=ze(),u=pe(),n=re(),l=Y();U.EOF;var p=65280,t=256;return BWTC=Object.create(null),BWTC.MAGIC="bwtc",BWTC.compressFile=l.compressFileHelper(BWTC.MAGIC,function(r,e,i,s,o){var f=new n(e);f.encodeStart(o,1);var b=9;typeof s=="number"&&s>=1&&s<=9&&(b=s),f.encodeByte(b);var a=b<=5;b*=1e5;var w=l.makeU8Buffer(b),v=function(){var q;for(q=0;q<b;){var j=r.readByte();if(j<0)break;w[q++]=j}return q},B=l.makeU8Buffer(b),E=l.makeS32Buffer(b),R=l.makeU8Buffer(256),S=u.factory(f),I=new c(b,0,S,S),k,N,x,_,y,F;do{if(k=v(),k===0)break;k===w.length?(f.encodeFreq(1,0,3),N=w):(f.encodeFreq(1,1,3),I.encode(k),N=w.subarray(0,k)),_=d.bwtransform(N,B,E,k,256),I.encode(_);var g=l.makeU16Buffer(512);for(y=0;y<k;y++)x=B[y],g[256+x]=1;for(y=255;y>0;y--)g[y]=g[2*y]+g[2*y+1];for(g[0]=1,y=1;y<512;y++){var C=y>>>1,M=1<<9-l.fls(y);if(!(g[C]===0||g[C]===M*2))if(y>=256)f.encodeBit(g[y]);else{var A=g[y];A=A===0?0:A===M?2:1,f.encodeFreq(1,A,3)}}var O=0;for(y=0;y<256;y++)g[256+y]&&(R[O++]=y);for(g=null,y=0;y<k;y++){for(x=B[y],F=0;F<O&&R[F]!==x;F++);for(console.assert(F<O),B[y]=F;F>0;F--)R[F]=R[F-1];R[0]=x}var L=new m(f,O+1,p,t);a&&(L=new h(f,O+1));var D=0,G=function(){for(;D!==0;)D&1?(L.encode(0),D-=1):(L.encode(1),D-=2),D>>>=1};for(y=0;y<k;y++)x=B[y],x===0?D++:(G(),L.encode(x+1),D=0);G()}while(k===w.length);f.encodeFreq(1,2,3),f.encodeFinish()},!0),BWTC.decompressFile=l.decompressFileHelper(BWTC.MAGIC,function(r,e,i){var s=new n(r);s.decodeStart(!0);var o=s.decodeByte();console.assert(o>=1&&o<=9);var f=o<=5;o*=1e5;for(var b=l.makeU8Buffer(o),a=l.makeU8Buffer(o),w=l.makeS32Buffer(o),v=l.makeU8Buffer(256),B=u.factory(s),E=new c(o,0,B,B),R,S,I,k,N;;){var x=s.decodeCulFreq(3);if(s.decodeUpdate(1,x,3),x===0)S=o,R=b;else if(x===1)S=E.decode(),R=b.subarray(0,S);else if(x===2)break;var _=E.decode(),y=l.makeU16Buffer(512);for(y[0]=1,I=1;I<512;I++){var F=I>>>1,g=1<<9-l.fls(I);if(y[F]===0||y[F]===g*2)y[I]=y[F]>>>1;else if(I>=256)y[I]=s.decodeBit();else{var C=s.decodeCulFreq(3);s.decodeUpdate(1,C,3),y[I]=C===2?g:C}}var M=0;for(I=0;I<256;I++)y[256+I]&&(v[M++]=I);y=null;var A=new m(s,M+1,p,t);f&&(A=new h(s,M+1,!0));var O=1;for(I=0;I<S;)if(N=A.decode(),N===0){for(k=0;k<O;k++)R[I++]=0;O*=2}else if(N===1){for(k=0;k<O;k++)R[I++]=0,R[I++]=0;O*=2}else O=1,R[I++]=N-1;for(I=0;I<S;I++){for(k=R[I],R[I]=N=v[k];k>0;k--)v[k]=v[k-1];v[0]=N}d.unbwtransform(b,a,w,S,_),e.write(a,0,S)}s.decodeFinish()}),Se=BWTC,Se}var Re,at;function Dt(){if(at)return Re;at=1;const U=Y();var d=U.arraycopy(U.makeU32Buffer(256),[0,79764919,159529838,222504665,319059676,398814059,445009330,507990021,638119352,583659535,797628118,726387553,890018660,835552979,1015980042,944750013,1276238704,1221641927,1167319070,1095957929,1595256236,1540665371,1452775106,1381403509,1780037320,1859660671,1671105958,1733955601,2031960084,2111593891,1889500026,1952343757,2552477408,2632100695,2443283854,2506133561,2334638140,2414271883,2191915858,2254759653,3190512472,3135915759,3081330742,3009969537,2905550212,2850959411,2762807018,2691435357,3560074640,3505614887,3719321342,3648080713,3342211916,3287746299,3467911202,3396681109,4063920168,4143685023,4223187782,4286162673,3779000052,3858754371,3904687514,3967668269,881225847,809987520,1023691545,969234094,662832811,591600412,771767749,717299826,311336399,374308984,453813921,533576470,25881363,88864420,134795389,214552010,2023205639,2086057648,1897238633,1976864222,1804852699,1867694188,1645340341,1724971778,1587496639,1516133128,1461550545,1406951526,1302016099,1230646740,1142491917,1087903418,2896545431,2825181984,2770861561,2716262478,3215044683,3143675388,3055782693,3001194130,2326604591,2389456536,2200899649,2280525302,2578013683,2640855108,2418763421,2498394922,3769900519,3832873040,3912640137,3992402750,4088425275,4151408268,4197601365,4277358050,3334271071,3263032808,3476998961,3422541446,3585640067,3514407732,3694837229,3640369242,1762451694,1842216281,1619975040,1682949687,2047383090,2127137669,1938468188,2001449195,1325665622,1271206113,1183200824,1111960463,1543535498,1489069629,1434599652,1363369299,622672798,568075817,748617968,677256519,907627842,853037301,1067152940,995781531,51762726,131386257,177728840,240578815,269590778,349224269,429104020,491947555,4046411278,4126034873,4172115296,4234965207,3794477266,3874110821,3953728444,4016571915,3609705398,3555108353,3735388376,3664026991,3290680682,3236090077,3449943556,3378572211,3174993278,3120533705,3032266256,2961025959,2923101090,2868635157,2813903052,2742672763,2604032198,2683796849,2461293480,2524268063,2284983834,2364738477,2175806836,2238787779,1569362073,1498123566,1409854455,1355396672,1317987909,1246755826,1192025387,1137557660,2072149281,2135122070,1912620623,1992383480,1753615357,1816598090,1627664531,1707420964,295390185,358241886,404320391,483945776,43990325,106832002,186451547,266083308,932423249,861060070,1041341759,986742920,613929101,542559546,756411363,701822548,3316196985,3244833742,3425377559,3370778784,3601682597,3530312978,3744426955,3689838204,3819031489,3881883254,3928223919,4007849240,4037393693,4100235434,4180117107,4259748804,2310601993,2373574846,2151335527,2231098320,2596047829,2659030626,2470359227,2550115596,2947551409,2876312838,2788305887,2733848168,3165939309,3094707162,3040238851,2985771188]),h=function(){var m=4294967295;this.getCRC=function(){return~m>>>0},this.updateCRC=function(c){m=m<<8^d[(m>>>24^c)&255]},this.updateCRCRun=function(c,u){for(;u-- >0;)m=m<<8^d[(m>>>24^c)&255]}};return Re=h,Re}var Ue,ft;function Pt(){if(ft)return Ue;ft=1;const U=fe(),d=Y();var h=function(p,t,r){for(var e=p.length,i=t,s=p.length-2;t>=r&&p[t]%e>i;)s=t,t-=i-t+1;for(t=Math.max(r-1,t);s>t+1;){var o=t+s>>1;p[o]%e>i?s=o:t=o}return s},m=function(p){var t=p.length;p[0]+=p[1];var r,e,i,s;for(r=0,e=1,i=2;e<t-1;e++)i>=t||p[r]<p[i]?(s=p[r],p[r++]=e):s=p[i++],i>=t||r<e&&p[r]<p[i]?(s+=p[r],p[r++]=e+t):s+=p[i++],p[e]=s},c=function(p,t){var r=p.length-2,e;for(e=1;e<t-1&&r>1;e++)r=h(p,r-1,0);return r},u=function(p){var t=p.length-2,r=p.length-1,e,i,s,o;for(e=1,i=2;i>0;e++){for(s=t,t=h(p,s-1,0),o=i-(s-t);o>0;o--)p[r--]=e;i=s-t<<1}},n=function(p,t,r){var e=p.length-2,i=p.length-1,s=r==1?2:1,o=r==1?t-2:t,f,b,a,w;for(f=s<<1;f>0;s++){for(b=e,e=e<=t?e:h(p,b-1,t),a=0,s>=r?a=Math.min(o,1<<s-r):s==r-1&&(a=1,p[e]==b&&e++),w=f-(b-e+a);w>0;w--)p[i--]=s;o-=a,f=b-e+a<<1}},l=function(p,t){switch(p.length){case 2:p[1]=1;case 1:p[0]=1;return}m(p);var r=c(p,t);if(p[0]%p.length>=r)u(p);else{var e=t-d.fls(r-1);n(p,r,e)}};return Ue=U({allocateHuffmanCodeLengths:l}),Ue}var ke,ht;function Lt(){if(ht)return ke;ht=1,fe();const U=ce(),d=Le(),h=Dt(),m=Pt(),c=Q(),u=Y();var n=20,l=258,p=0,t=1,r=2,e=6,i=50,s=54156738319193,o=25779555029136,f=c.EOF,b=function(x,_){var y=x[_],F;for(F=_;F>0;F--)x[F]=x[F-1];return x[0]=y,y},a={OK:0,LAST_BLOCK:-1,NOT_BZIP_DATA:-2,UNEXPECTED_INPUT_EOF:-3,UNEXPECTED_OUTPUT_EOF:-4,DATA_ERROR:-5,OUT_OF_MEMORY:-6,OBSOLETE_INPUT:-7,END_OF_BLOCK:-8},w={};w[a.LAST_BLOCK]="Bad file checksum",w[a.NOT_BZIP_DATA]="Not bzip data",w[a.UNEXPECTED_INPUT_EOF]="Unexpected input EOF",w[a.UNEXPECTED_OUTPUT_EOF]="Unexpected output EOF",w[a.DATA_ERROR]="Data error",w[a.OUT_OF_MEMORY]="Out of memory",w[a.OBSOLETE_INPUT]="Obsolete (pre 0.9.5) bzip format not supported.";var v=function(x,_){var y=w[x]||"unknown error";_&&(y+=": "+_);var F=new TypeError(y);throw F.errorCode=x,F},B=function(x,_){this.writePos=this.writeCurrent=this.writeCount=0,this._start_bunzip(x,_)};B.prototype._init_block=function(){var x=this._get_next_block();return x?(this.blockCRC=new h,!0):(this.writeCount=-1,!1)},B.prototype._start_bunzip=function(x,_){var y=u.makeU8Buffer(4);(x.read(y,0,4)!==4||String.fromCharCode(y[0],y[1],y[2])!=="BZh")&&v(a.NOT_BZIP_DATA,"bad magic");var F=y[3]-48;(F<1||F>9)&&v(a.NOT_BZIP_DATA,"level out of range"),this.reader=new U(x),this.dbufSize=1e5*F,this.nextoutput=0,this.outputStream=_,this.streamCRC=0},B.prototype._get_next_block=function(){var x,_,y,F=this.reader,g=F.readBits(48);if(g===o)return!1;g!==s&&v(a.NOT_BZIP_DATA),this.targetBlockCRC=F.readBits(32),this.streamCRC=(this.targetBlockCRC^(this.streamCRC<<1|this.streamCRC>>>31))>>>0,F.readBits(1)&&v(a.OBSOLETE_INPUT);var C=F.readBits(24);C>this.dbufSize&&v(a.DATA_ERROR,"initial position out of bounds");var M=F.readBits(16),A=u.makeU8Buffer(256),O=0;for(x=0;x<16;x++)if(M&1<<15-x){var L=x*16;for(y=F.readBits(16),_=0;_<16;_++)y&1<<15-_&&(A[O++]=L+_)}var D=F.readBits(3);(D<r||D>e)&&v(a.DATA_ERROR);var G=F.readBits(15);G===0&&v(a.DATA_ERROR);var q=u.makeU8Buffer(256);for(x=0;x<D;x++)q[x]=x;var j=u.makeU8Buffer(G);for(x=0;x<G;x++){for(_=0;F.readBits(1);_++)_>=D&&v(a.DATA_ERROR);j[x]=b(q,_)}var z=O+2,W=[],P;for(_=0;_<D;_++){var T=u.makeU8Buffer(z),V=u.makeU16Buffer(n+1);for(M=F.readBits(5),x=0;x<z;x++){for(;(M<1||M>n)&&v(a.DATA_ERROR),!!F.readBits(1);)F.readBits(1)?M--:M++;T[x]=M}var K,H;for(K=H=T[0],x=1;x<z;x++)T[x]>H?H=T[x]:T[x]<K&&(K=T[x]);P={},W.push(P),P.permute=u.makeU16Buffer(l),P.limit=u.makeU32Buffer(n+2),P.base=u.makeU32Buffer(n+1),P.minLen=K,P.maxLen=H;var $=0;for(x=K;x<=H;x++)for(V[x]=P.limit[x]=0,M=0;M<z;M++)T[M]===x&&(P.permute[$++]=M);for(x=0;x<z;x++)V[T[x]]++;for($=M=0,x=K;x<H;x++)$+=V[x],P.limit[x]=$-1,$<<=1,M+=V[x],P.base[x+1]=$-M;P.limit[H+1]=Number.MAX_VALUE,P.limit[H]=$+V[H]-1,P.base[K]=0}var X=u.makeU32Buffer(256);for(x=0;x<256;x++)q[x]=x;var ee=0,J=0,ie=0,Z,se=this.dbuf=u.makeU32Buffer(this.dbufSize);for(z=0;;){for(z--||(z=i-1,ie>=G&&v(a.DATA_ERROR),P=W[j[ie++]]),x=P.minLen,_=F.readBits(x);x>P.maxLen&&v(a.DATA_ERROR),!(_<=P.limit[x]);x++)_=_<<1|F.readBits(1);_-=P.base[x],(_<0||_>=l)&&v(a.DATA_ERROR);var oe=P.permute[_];if(oe===p||oe===t){ee||(ee=1,M=0),oe===p?M+=ee:M+=2*ee,ee<<=1;continue}if(ee)for(ee=0,J+M>this.dbufSize&&v(a.DATA_ERROR),Z=A[q[0]],X[Z]+=M;M--;)se[J++]=Z;if(oe>O)break;J>=this.dbufSize&&v(a.DATA_ERROR),x=oe-1,Z=b(q,x),Z=A[Z],X[Z]++,se[J++]=Z}for((C<0||C>=J)&&v(a.DATA_ERROR),_=0,x=0;x<256;x++)y=_+X[x],X[x]=_,_=y;for(x=0;x<J;x++)Z=se[x]&255,se[X[Z]]|=x<<8,X[Z]++;var he=0,te=0,Ge=0;return J&&(he=se[C],te=he&255,he>>=8,Ge=-1),this.writePos=he,this.writeCurrent=te,this.writeCount=J,this.writeRun=Ge,!0},B.prototype._read_bunzip=function(x,_){var y,F,g;if(this.writeCount<0)return 0;var C=this.dbuf,M=this.writePos,A=this.writeCurrent,O=this.writeCount;this.outputsize;for(var L=this.writeRun;O;){for(O--,F=A,M=C[M],A=M&255,M>>=8,L++===3?(y=A,g=F,A=-1):(y=1,g=A),this.blockCRC.updateCRCRun(g,y);y--;)this.outputStream.writeByte(g),this.nextoutput++;A!=F&&(L=0)}return this.writeCount=O,this.blockCRC.getCRC()!==this.targetBlockCRC&&v(a.DATA_ERROR,"Bad block CRC (got "+this.blockCRC.getCRC().toString(16)+" expected "+this.targetBlockCRC.toString(16)+")"),this.nextoutput},B.Err=a,B.decode=function(x,_,y){for(var F=u.coerceInputStream(x),g=u.coerceOutputStream(_,_),C=g.stream,M=new B(F,C);!("eof"in F&&F.eof());)if(M._init_block())M._read_bunzip();else{var A=M.reader.readBits(32);if(A!==M.streamCRC&&v(a.DATA_ERROR,"Bad stream CRC (got "+M.streamCRC.toString(16)+" expected "+A.toString(16)+")"),y&&"eof"in F&&!F.eof())M._start_bunzip(F,C);else break}return g.retval},B.decodeBlock=function(x,_,y){var F=u.coerceInputStream(x),g=u.coerceOutputStream(y,y),C=g.stream,M=new B(F,C);M.reader.seekBit(_);var A=M._get_next_block();return A&&(M.blockCRC=new h,M.writeCopies=0,M._read_bunzip()),g.retval},B.table=function(x,_,y){var F=new c;F.delegate=u.coerceInputStream(x),F.pos=0,F.readByte=function(){return this.pos++,this.delegate.readByte()},F.tell=function(){return this.pos},F.delegate.eof&&(F.eof=F.delegate.eof.bind(F.delegate));var g=new c;g.pos=0,g.writeByte=function(){this.pos++};for(var C=new B(F,g),M=C.dbufSize;!("eof"in F&&F.eof());){var A=C.reader.tellBit();if(C._init_block()){var O=g.pos;C._read_bunzip(),_(A,g.pos-O)}else if(C.reader.readBits(32),y&&"eof"in F&&!F.eof())C._start_bunzip(F,g),console.assert(C.dbufSize===M,"shouldn't change block size within multistream file");else break}};var E=function(x,_){var y,F=[];for(y=0;y<_;y++)F[y]=x[y]<<9|y;F.sort(function(M,A){return M-A});var g=F.map(function(M){return M>>>9});for(m.allocateHuffmanCodeLengths(g,n),this.codeLengths=u.makeU8Buffer(_),y=0;y<_;y++){var C=F[y]&511;this.codeLengths[C]=g[y]}};E.prototype.computeCanonical=function(){var x=this.codeLengths.length,_,y=[];for(_=0;_<x;_++)y[_]=this.codeLengths[_]<<9|_;y.sort(function(A,O){return A-O}),this.code=u.makeU32Buffer(x);var F=0,g=0;for(_=0;_<x;_++){var C=y[_]>>>9,M=y[_]&511;console.assert(g<=C),F<<=C-g,this.code[M]=F++,g=C}},E.prototype.cost=function(x,_,y){var F,g=0;for(F=0;F<y;F++)g+=this.codeLengths[x[_+F]];return g},E.prototype.emit=function(x){var _,y=this.codeLengths[0];for(x.writeBits(5,y),_=0;_<this.codeLengths.length;_++){var F=this.codeLengths[_],g,C;for(console.assert(F>0&&F<=n),y<F?(g=2,C=F-y):(g=3,C=y-F);C-- >0;)x.writeBits(2,g);x.writeBit(0),y=F}},E.prototype.encode=function(x,_){x.writeBits(this.codeLengths[_],this.code[_])};var R=function(x,_,y,F){for(var g=0,C=-1,M=0;g<y&&!(M===4&&(_[g++]=0,g>=y));){var A=x.readByte();if(A===f)break;if(F.updateCRC(A),A!==C)C=A,M=1;else if(M++,M>4)if(M<256){_[g-1]++;continue}else M=1;_[g++]=A}return g},S=function(x,_,y){var F,g,C;for(F=0,C=0;F<y.length;F+=i){var M=Math.min(i,y.length-F),A=0,O=_[0].cost(y,F,M);for(g=1;g<_.length;g++){var L=_[g].cost(y,F,M);L<O&&(A=g,O=L)}x[C++]=A}},I=function(x,_,y,F,g){for(var C,M,A,O=[];x.length<_;){for(S(F,x,y),C=0;C<x.length;C++)O[C]=0;for(C=0;C<F.length;C++)O[F[C]]++;var L=O.indexOf(Math.max.apply(Math,O)),D=[];for(C=0,M=0;C<F.length;C++)if(F[C]===L){var G=C*i,q=Math.min(G+i,y.length);D.push({index:C,cost:x[L].cost(y,G,q-G)})}for(D.sort(function(W,P){return W.cost-P.cost}),C=D.length>>>1;C<D.length;C++)F[D[C].index]=x.length;x.push(null);var j=[],z;for(C=0;C<x.length;C++)for(z=j[C]=[],M=0;M<g;M++)z[M]=0;for(C=0,M=0;C<y.length;)for(z=j[F[M++]],A=0;A<i&&C<y.length;A++)z[y[C++]]++;for(C=0;C<x.length;C++)x[C]=new E(j[C],g)}},k=function(x,_,y){var F,g,C,M,A=u.makeU8Buffer(_),O=d.bwtransform2(x,A,_,256);y.writeBit(0),y.writeBits(24,O);var L=[],D=[];for(g=0;g<_;g++)F=x[g],L[F]=!0,D[F>>>4]=!0;for(g=0;g<16;g++)y.writeBit(!!D[g]);for(g=0;g<16;g++)if(D[g])for(C=0;C<16;C++)y.writeBit(!!L[g<<4|C]);var G=0;for(g=0;g<256;g++)L[g]&&G++;var q=u.makeU16Buffer(_+1),j=G+1,z=[];for(g=0;g<=j;g++)z[g]=0;var W=u.makeU8Buffer(G);for(g=0,C=0;g<256;g++)L[g]&&(W[C++]=g);L=null,D=null;var P=0,T=0,V=function(ie){q[P++]=ie,z[ie]++},K=function(){for(;T!==0;)T&1?(V(0),T-=1):(V(1),T-=2),T>>>=1};for(g=0;g<A.length;g++){for(F=A[g],C=0;C<G&&W[C]!==F;C++);console.assert(C!==G),b(W,C),C===0?T++:(K(),V(C+1),T=0)}K(),V(j),q=q.subarray(0,P);var H=[],$;for(P>=2400?$=6:P>=1200?$=5:P>=600?$=4:P>=200?$=3:$=2,H.push(new E(z,j+1)),g=0;g<=j;g++)z[g]=1;H.push(new E(z,j+1)),z=null;var X=u.makeU8Buffer(Math.ceil(P/i));for(I(H,$,q,X,j+1),S(X,H,q),console.assert(H.length>=r&&H.length<=e),y.writeBits(3,H.length),y.writeBits(15,X.length),g=0;g<H.length;g++)W[g]=g;for(g=0;g<X.length;g++){var ee=X[g];for(C=0;C<H.length&&W[C]!==ee;C++);for(console.assert(C<H.length),b(W,C);C>0;C--)y.writeBit(1);y.writeBit(0)}for(g=0;g<H.length;g++)H[g].emit(y),H[g].computeCanonical();for(g=0,M=0;g<P;){var J=H[X[M++]];for(C=0;C<i&&g<P;C++)J.encode(y,q[g++])}},N=Object.create(null);return N.compressFile=function(x,_,y){x=u.coerceInputStream(x);var F=u.coerceOutputStream(_,_);_=new U(F.stream);var g=9;if(typeof y=="number"&&(g=y),g<1||g>9)throw new Error("Invalid block size multiplier");var C=g*1e5;C-=19,_.writeByte(66),_.writeByte(90),_.writeByte(104),_.writeByte(48+g);var M=u.makeU8Buffer(C),A=0,O;do{var L=new h;O=R(x,M,C,L),O>0&&(A=((A<<1|A>>>31)^L.getCRC())>>>0,_.writeBits(48,s),_.writeBits(32,L.getCRC()),k(M,O,_))}while(O===C);return _.writeBits(48,o),_.writeBits(32,A),_.flush(),F.retval},N.decompressFile=B.decode,N.decompressBlock=B.decodeBlock,N.table=B.table,ke=N,ke}var Ie,ct;function qt(){if(ct)return Ie;ct=1;const U=xt(),d=re(),h=Q(),m=Y();var c=65535,u=8,n=128,l=65280,p=256,t=Object.create(null);t.MAGIC="dmc!";var r=function(i,s,o){this.out=[],this.model=o?o.clone():new U(i,s,l,p),this.count=m.makeU16Buffer(s),this.sum=0};r.prototype.clone=function(i,s){var o,f=new r(i,s,null);for(o=0;o<s;o++)f.out[o]=this.out[o];return f};var e=function(i,s,o,f){var b,a;for(this.coder=i,this.size=s,this.MIN_CNT1=o||u,this.MIN_CNT2=f||n,this.nodes=[],b=0;b<s;b++)this.nodes[b]=new r(i,s);for(b=0;b<s;b++)for(a=0;a<s;a++)this.nodes[b].out[a]=this.nodes[a];this.current=this.nodes[0]};return e.prototype.maybeSplit=function(i,s,o){var f=i.count[s],b=o.sum,a;if(f<=this.MIN_CNT1||b-f<=this.MIN_CNT2)return o;var w=o.clone(this.coder,this.size);for(this.nodes.push(w),i.out[s]=w,w.sum=o.sum=0,a=0;a<this.size;a++)w.count[a]=o.count[a]*f/b,w.sum+=w.count[a],o.count[a]-=w.count[a],o.sum+=o.count[a];return w},e.prototype.encode=function(i){var s=this.current;s.model.encode(i);var o=s.out[i];s.count[i]!==c&&(s.count[i]++,s.sum++),this.current=this.maybeSplit(s,i,o)},e.prototype.decode=function(){var i=this.current,s=i.model.decode(),o=i.out[s];return i.count[s]!==c&&(i.count[s]++,i.sum++),this.current=this.maybeSplit(i,s,o),s},t.compressFile=m.compressFileHelper(t.MAGIC,function(i,s,o,f){f=f||{};var b=+f.m||u,a=+f.n||n;m.writeUnsignedNumber(s,b),m.writeUnsignedNumber(s,a);var w=new d(s);w.encodeStart(202,0);for(var v=new e(w,o<0?257:256,b,a),B=0;B!==o;){var E=i.readByte();if(E===h.EOF){v.encode(256);break}v.encode(E),B++}w.encodeFinish()}),t.decompressFile=m.decompressFileHelper(t.MAGIC,function(i,s,o){var f=m.readUnsignedNumber(i),b=m.readUnsignedNumber(i),a=new d(i);a.decodeStart();for(var w=new e(a,o<0?257:256,f,b),v=0;v!==o;){var B=w.decode();if(B===256)break;s.writeByte(B),v++}a.decodeFinish()}),Ie=t,Ie}var Ae,dt;function jt(){if(dt)return Ae;dt=1;const U=Q(),d=Y();var h=Object.create(null);h.MAGIC="lzjb";var m=8,c=6,u=3,n=(1<<c)+(u-1),l=(1<<16-c)-1,p=1024,t=U.EOF;return h.compressFile=d.compressFileHelper(h.MAGIC,function(r,e,i,s){var o,f,b,a,w,v,B,E=p,R=1;typeof s=="number"&&(E*=2,s=Math.max(1,Math.min(9,s))-1,R=1<<Math.floor(s/2),s&1&&(R=Math.round(R*1.5)),s>=2&&s<=4&&R++),v=d.makeU16Buffer(E*R);for(var S=d.makeU8Buffer(l+1),I=0,k=function(T){return S[I++]=T,I>=S.length&&(I=0),T},N=d.makeU8Buffer(17),x=0,_=function(){var T;for(T=0;T<x;T++)e.writeByte(N[T]);x=0},y=[],F=function(){return y.length?y.pop():r.readByte()},g=function(T){y.push(T)},C=1<<m-1,M=[];;){var A=F();if(A===t)break;(C<<=1)==1<<m&&(_(),C=1,N[0]=0,x=1);var O=F();if(O===t){N[x++]=k(A);break}var L=F();if(L===t){N[x++]=k(A),g(O);continue}for(a=(A<<16)+(O<<8)+L,a^=a>>9,a+=a>>5,a^=A,w=(a&E-1)*R,M.length=0,B=0;B<R;B++){b=I-v[w+B]&l,o=S.length+I-b;var D=S[o&l],G=S[o+1&l],q=S[o+2&l];b===0?D=A^1:b==1?(G=A,q=O):b==2&&(q=A),A===D&&O===G&&L===q&&M.push(b)}for(B=R-1;B>0;B--)v[w+B]=v[w+B-1];if(v[w]=I,M.length===0)N[x++]=k(A),g(L),g(O);else{N[0]|=C,k(A),k(O),k(L);var j=F(),z=M[0],W=S.length+I;for(f=u;f<n&&j!==t;f++,W++){for(B=0;B<M.length;){var P=S[W-M[B]&l];j!==P?(z=M[B],M.splice(B,1)):B++}if(M.length===0)break;k(j),j=F()}M.length!==0&&(z=M[0]),g(j),N[x++]=f-u<<m-c|z>>m,N[x++]=z&255}}_()}),h.decompressFile=d.decompressFileHelper(h.MAGIC,function(r,e,i){for(var s,o,f,b,a,w=d.makeU8Buffer(l+1),v=0,B=1<<m-1;i!==0&&(a=r.readByte(),a!==t);)if((B<<=1)==1<<m&&(B=1,o=a,a=r.readByte()),o&B)for(f=(a>>m-c)+u,b=(a<<m|r.readByte())&l,s=v-b,s<0&&(s+=w.length),i>=0&&(i-=f);--f>=0;)a=w[v++]=w[s++],e.writeByte(a),v>=w.length&&(v=0),s>=w.length&&(s=0);else e.writeByte(a),w[v++]=a,v>=w.length&&(v=0),i>=0&&i--}),Ae=h,Ae}var Oe,ut;function Ht(){if(ut)return Oe;ut=1;const U=je(),d=le(),h=ze(),m=pe(),c=re(),u=Q(),n=Y();var l=Object.create(null);l.MAGIC="lzjR";var p=6,t=3,r=(1<<p)+(t-1),e=(1<<16-p)-1,i=1024,s=32;return l.compressFile=n.compressFileHelper(l.MAGIC,function(o,f,b,a,w){var v,B,E,R,S,I,k,N=i,x=1;typeof a=="number"&&(N*=2,a=Math.max(1,Math.min(9,a))-1,x=1<<Math.floor(a/2),a&1&&(x=Math.round(x*1.5)),a>=2&&a<=4&&x++);var _=new c(f);_.encodeStart(w,1),I=n.makeU16Buffer(N*x);for(var y=n.makeU8Buffer(e+1),F=0,g=function(te){return y[F++]=te,F>=y.length&&(F=0),te},C=[],M=function(){return C.length?C.pop():o.readByte()},A=function(te){C.push(te)},O=[],L=256,D=257,G=m.factory(_),q=d.factory(_,65280,256),j=new U(q,256,(b<0?D:L)+1),z=function(te){return te<=s?q(te):G(te)},W=new h(r-t+1,0,q,z),P=new h(e+1,1,q,z),T=32,V=0;;){var K=F,H=M();if(H===u.EOF)break;var $=M();if($===u.EOF){j.encode(g(H),T);break}var X=M();if(X===u.EOF){j.encode(g(H),T),A($),T=H;continue}for(R=(H<<16)+($<<8)+X,R^=R>>9,R+=R>>5,R^=H,S=(R&N-1)*x,O.length=0,k=0;k<x;k++){E=F-I[S+k]&e,v=y.length+F-E;var ee=y[v&e],J=y[v+1&e],ie=y[v+2&e];E==1?(J=H,ie=$):E==2&&(ie=H),H===ee&&$===J&&X===ie&&O.push(E)}for(k=x-1;k>0;k--)I[S+k]=I[S+k-1];if(I[S]=F,O.length===0)j.encode(g(H),T),A(X),A($),T=H;else{j.encode(L,T),g(H),g($),g(X),T=X;var Z=M(),se=O[0],oe=y.length+F;for(B=t;B<r&&Z!==u.EOF;B++,oe++){for(k=0;k<O.length;){var he=y[oe-O[k]&e];Z!==he?(se=O[k],O.splice(k,1)):k++}if(O.length===0)break;g(Z),T=Z,Z=M()}O.length!==0&&(se=O[0]),A(Z),W.encode(B-t),E=K-se&e,E===V?P.encode(-1):(P.encode(E),V=E)}}b<0&&j.encode(D,T),_.encodeFinish()},!0),l.decompressFile=n.decompressFileHelper(l.MAGIC,function(o,f,b){var a,w,v,B=n.makeU8Buffer(e+1),E=0,R=new c(o);R.decodeStart(!0);for(var S=256,I=257,k=m.factory(R),N=d.factory(R,65280,256),x=new U(N,256,(b<0?I:S)+1),_=function(M){return M<=s?N(M):k(M)},y=new h(r-t+1,0,N,_),F=new h(e+1,1,N,_),g=32,C=0;b!==0&&(v=x.decode(g),v!==I);)if(v===S)for(w=y.decode()+t,a=F.decode(),a<0?a=C:C=a,b>=0&&(b-=w);--w>=0;)v=g=B[E++]=B[a++],f.writeByte(v),E>=B.length&&(E=0),a>=B.length&&(a=0);else f.writeByte(v),B[E++]=g=v,E>=B.length&&(E=0),b>=0&&b--;R.decodeFinish()}),Oe=l,Oe}var Ne,lt;function zt(){if(lt)return Ne;lt=1;const U=ce(),d=je();He();const h=le(),m=qe(),c=ze(),u=pe(),n=re(),l=Q(),p=Y();var t=Object.create(null);t.MAGIC="lzp3";var r=256,e=65280,i=256,s=65536,o=4096,f=65536,b=20,a=1<<b,w=a-1,v=16,B=16777215,E=65535,R=function(S){this.buffer=p.makeU8Buffer(Math.min(S+4,a)),this.pos=0,this.ctxt4=p.makeU32Buffer(s),this.ctxt3=p.makeU32Buffer(o),this.ctxt2=p.makeU32Buffer(f),this.put(99),this.put(83),this.put(97),this.put(32)};return R.prototype.put=function(S){return this.buffer[this.pos++]=S,this.pos>=a&&(this.pos=0),S},R.prototype.get=function(S){return this.buffer[S&a-1]},R.prototype.context=function(S,I){var k=0,N;for(S=S-I&a-1,N=0;N<I;N++)k=k<<8|this.buffer[S++],S>=a&&(S=0);return k},R.prototype.getIndex=function(S,I){var k=this.context(S,4),N=(k>>>15^k)&s-1,x=(k>>>11^k)&o-1,_=k&E,y=0;return I===0&&(y=this.ctxt4[N],y!==0&&k!==this.context(y-1,4)&&(y=0),y===0&&(y=this.ctxt3[x],y!==0&&(k&B)!==this.context(y-1,3)&&(y=0),y===0&&(y=this.ctxt2[_],y!==0&&(k&&E)!==this.context(y-1,2)&&(y=0)))),I&&I--,this.ctxt4[N]=this.ctxt3[x]=this.ctxt2[_]=(S|I<<b)+1,y},t.compressFile=p.compressFileHelper(t.MAGIC,function(S,I,k,N){var x=new R(k>=0?k:a),_,y,F;{var g=new n(I);g.encodeStart(0,0),_=h.factory(g,e,i);var C=u.factory(g);y=function(T){return T>r?C(T):_(T)},F=function(){g.encodeFinish()}}var M=new d(_,256,k<0?257:256),A=[],O;for(O=0;O<v;O++)A[O]=new c(w+1,1,_,y);for(var L=0,D,G=0;L!==k;){var q=S.readByte();D=x.pos;var j=x.getIndex(D,0);if(j!==0){j--;for(var z=(j>>>b)+1,W=0;x.get(j+W)===q&&W<w;)W++,x.put(q),q=S.readByte();z===W?A[G&v-1].encode(-1):A[G&v-1].encode(W),x.getIndex(D,W),L+=W,G<<=1,W>0&&(G|=1)}var P=x.get(x.pos-1);if(q===l.EOF){k<0&&M.encode(256,P);break}M.encode(q,P),x.put(q),L++}F&&F()}),t.decompressFile=p.decompressFileHelper(t.MAGIC,function(S,I,k){var N=S.readByte(),x=!!(N&128),_=new R(k>=0?k:a),y,F,g;if(x){var C=new U(S);y=m.factory(C,E),F=u.factory(C)}else{var M=new n(S);M.decodeStart(!0),y=h.factory(M,e,i);var A=u.factory(M);F=function(K){return K>r?A(K):y(K)},g=function(){M.decodeFinish()}}var O=new d(y,256,k<0?257:256),L=[],D;for(D=0;D<v;D++)L[D]=new c(w+1,1,y,F);for(var G,q,j=0,z=0;j!==k;){G=_.pos;var W=_.getIndex(G,0);if(W!==0){W--;var P=(W>>>b)+1,T=L[z&v-1].decode();for(T<0&&(T=P),D=0;D<T;D++)q=_.get(W+D),I.writeByte(_.put(q));_.getIndex(G,T),j+=T,z<<=1,T>0&&(z|=1)}if(j===k)break;var V=_.get(_.pos-1);if(q=O.decode(V),q===256)break;I.writeByte(_.put(q)),j++}g&&g()}),Ne=t,Ne}var Te,pt;function Gt(){if(pt)return Te;pt=1;const U=re(),d=Y();var h=5,m=18,c=1<<m,u=function(){this.buffer=d.makeU8Buffer(c),this.pos=0,this.firstPass=!0;for(var t=0;t<h;t++)this.put("cSaCsA".charCodeAt(t%6))};u.prototype.put=function(t){return this.buffer[this.pos++]=t,this.pos>=c&&(this.pos=0,this.firstPass=!1),t},u.prototype.get=function(t){return this.buffer[t&c-1]},u.prototype.context=function(t,r){var e=[],i;for(t=t-r&c-1,i=0;i<r;i++)e.push(this.buffer[t++]),t>=c&&(t=0);return String.fromCharCode.apply(String,e)};var n=256,l=65280,p=function(t,r){this.window=new u,this.contexts=Object.create(null);var e=function(){};e.prototype.encode=function(s,o){var f,b=0;for(f=0;f<s;f++)o[f]||b++;var a=r-o.total;t.encodeFreq(1,b,a)},e.prototype.decode=function(s){var o,f,b,a=r-s.total;for(f=b=t.decodeCulFreq(a),o=0;o<=f;o++)s[o]&&f++;return t.decodeUpdate(1,b,a),f},this.cm1coder=new e;var i=function(){this.sym=[r],this.prob=[0,n],this.refcount=0};i.prototype._rescale=function(){var s=this.sym.length,o,f,b=0,a=!0;for(o=0,f=0;o<s;o++){var w=this.sym[o],v=this.prob[o+1]-this.prob[o];v>>>=1,v>0&&(w===r&&(a=!1),this.sym[f]=w,this.prob[f++]=b,b+=v)}return this.prob[f]=b,s=this.sym.length=f,this.prob.length=s+1,a&&s<r&&(b=this._update(r,s,0,1)),b},i.prototype.update=function(s,o){var f=0;for(f=0;f<this.sym.length;f++)if(this.sym[f]===s)return this._update(s,f,this.prob[f+1]-this.prob[f],o);return this._update(s,f,0,o)},i.prototype._update=function(s,o,f,b){var a=this.sym.length,w,v,B;for(v=o;v<a-1;v++)this.sym[v]=this.sym[v+1],this.prob[v]=this.prob[v+1]-f;if(o<a)this.sym[v]=s,this.prob[v]=this.prob[v+1]-f,this.prob[a]=B=this.prob[a]+b;else if(B=this.prob[a],this.sym[o]=s,this.prob[o]=B,B+=b,this.prob[++a]=B,this.sym.length>r)for(w=0;w<a;w++)r===this.sym[w]&&(this._update(r,w,this.prob[w+1]-this.prob[w],-1),this.sym.length--,this.prob.length--,B=this.prob[this.prob.length-1]);return B>=l&&(B=this._rescale()),B},i.prototype.encode=function(s,o){var f,b,a,w,v,B=this.sym.length,E=0,R=0,S=0,I;for(f=B-1;f>=0;f--)if(w=this.prob[f],a=this.prob[f+1]-w,s===this.sym[f]){for(b=f-1;b>=0&&E<o.total;b--)o[this.sym[b]]&&(E+=1,I=this.prob[b+1]-this.prob[b],R+=I,S+=I);return v=this.prob[B],w-=R,v-=S,t.encodeFreq(a,w,v),s===r?(this._update(s,f,a,n/2),!1):!0}else o[this.sym[f]]&&(E+=1,S+=a);for(this.encode(r,o),console.assert(this.sym[this.sym.length-1]===r),f=0;f<this.sym.length-1;f++)o[this.sym[f]]||(o[this.sym[f]]=!0,o.total++)},i.prototype.decode=function(s){var o=this.sym.length,f=this.prob[o],b=0,a=0,w=0,v,B;for(B=o-1;B>=0&&b<s.total;B--)s[this.sym[B]]&&(b+=1,w+=this.prob[B+1]-this.prob[B]);var E=t.decodeCulFreq(f-w)+w;for(a=w,B=o-1;B>=0;B--)if(s[this.sym[B]])v=this.prob[B+1]-this.prob[B],a-=v,E-=v;else if(this.prob[B]<=E)break;console.assert(B>=0);var R=this.sym[B],S=this.prob[B],I=this.prob[B+1]-S;if(t.decodeUpdate(I,S-a,f-w),R<r)return R;for(this._update(R,B,I,n/2),console.assert(this.sym[this.sym.length-1]===r),B=0;B<this.sym.length-1;B++)s[this.sym[B]]||(s[this.sym[B]]=!0,s.total++);return-1},this.newContext=function(s){return new i},this.newExclude=function(){var s=Object.create(null);return s.total=0,s},(function(){var s,o;for(s=0;s<h;s++)for(o=0;o<=s;o++){var f=this.window.context(o+(h-1-s),o);this.contexts[f]||(this.contexts[f]=this.newContext()),this.contexts[f].refcount++}}).call(this)};return p.prototype.update=function(t,r,e){var i,s,o;for(s=0;s<=h;s++)o=r.slice(h-s),i=this.contexts[o],i||(i=this.contexts[o]=this.newContext()),s>=e&&i.update(t,n/2),i.refcount++;r=this.window.context(this.window.pos+h,h);var f=this.window.firstPass;for(s=h;s>=0&&!f;s--)o=r.slice(0,s),i=this.contexts[o],console.assert(i),--i.refcount<=0&&(console.assert(o!==""),delete this.contexts[o]);this.window.put(t)},p.prototype.decode=function(){var t=this.window.context(this.window.pos,h),r=this.newExclude(),e,i,s,o;for(i=h;i>=0;i--)if(s=t.slice(h-i),e=this.contexts[s],e&&(o=e.decode(r),o>=0))return this.update(o,t,i),o;return o=this.cm1coder.decode(r),this.update(o,t,i),o},p.prototype.encode=function(t){var r=this.window.context(this.window.pos,h),e=this.newExclude(),i;for(i=h;i>=0;i--){var s=r.slice(h-i),o=this.contexts[s];if(o){var f=o.encode(t,e);if(f){this.update(t,r,i);return}}}this.cm1coder.encode(t,e),this.update(t,r,i)},p.MAGIC="ppm2",p.compressFile=d.compressFileHelper(p.MAGIC,function(t,r,e,i,s){var o=new U(r);o.encodeStart(s,1);var f=new p(o,e<0?257:256);d.compressWithModel(t,e,f),o.encodeFinish()},!0),p.decompressFile=d.decompressFileHelper(p.MAGIC,function(t,r,e){var i=new U(t);i.decodeStart(!0);var s=new p(i,e<0?257:256);d.decompressWithModel(r,e,s),i.decodeFinish()}),Te=p,Te}var De,vt;function Wt(){if(vt)return De;vt=1;const U=re(),d=Q(),h=Y();var m=1<<17,c=Object.create(null);return c.MAGIC="smpl",c.compressFile=h.compressFileHelper(c.MAGIC,function(u,n,l,p,t){var r=new U(n);r.encodeStart(t,1);for(var e=h.makeU8Buffer(m),i=[],s=0,o=!1,f=function(){var w=0;for(w=0;w<256;w++)i[w]=0;if(o){s=0;return}for(w=0;w<m;){var v=u.readByte();if(v===d.EOF){o=!0;break}if(e[w++]=v,i[v]++,i[v]===65535)break}s=w};;){var b;if(f(),o&&s===0)break;for(r.encodeBit(!0),b=0;b<256;b++)r.encodeShort(i[b]);for(i[256]=s,b=256;b;b--)i[b-1]=i[b]-i[b-1];for(b=0;b<s;b++){var a=e[b];r.encodeFreq(i[a+1]-i[a],i[a],i[256])}}r.encodeBit(!1),r.encodeFinish()},!0),c.decompressFile=h.decompressFileHelper(c.MAGIC,function(u,n,l){var p=new U(u);for(p.decodeStart(!0);p.decodeBit();){var t,r=[];for(t=0;t<256;t++)r[t]=p.decodeShort();var e=0;for(t=0;t<256;t++){var i=r[t];r[t]=e,e+=i}for(r[256]=e,t=0;t<e;t++){var s=p.decodeCulFreq(e),o;for(o=0;o<256&&!(r[o]<=s&&s<r[o+1]);o++);p.decodeUpdate(r[o+1]-r[o],r[o],e),n.writeByte(o)}}p.decodeFinish()}),De=c,De}var Pe,mt;function $t(){if(mt)return Pe;mt=1;const U=fe(),d=ce(),h=Q(),m=Le(),c=je(),u=He(),n=le(),l=xt(),p=pe(),t=qe(),r=re(),e=Tt(),i=Lt(),s=qt(),o=jt(),f=Ht(),b=zt(),a=Gt(),w=Wt();return Pe=U({version:"1.2.0",BitStream:d,Stream:h,BWT:m,Context1Model:c,DefSumModel:u,FenwickModel:n,MTFModel:l,NoModel:p,Huffman:t,RangeCoder:r,BWTC:e,Bzip2:i,Dmc:s,Lzjb:o,LzjbR:f,Lzp3:b,PPM:a,Simple:w}),Pe}var Bt=$t();const gt=Buffer.from(["B","Z","h","1"].map(U=>U.charCodeAt(0))),Xt=65535,bt=16777215;function wt(U){const d=Buffer.concat([gt,U]),h=Bt.Bzip2.decompressFile(d);return Buffer.from(h)}function yt(U){const d=Bt.Bzip2.compressFile(U,void 0,1);return Buffer.from(d).subarray(gt.length)}function ne(U){U=U.toUpperCase();let d=0;for(let h=0;h<U.length;h+=1)d=(d*61|0)+U.charCodeAt(h)-32;return d}class Zt{entries;header;zippedBuffer;unzippedBuffer;size=0;compressedSize=0;constructor(){this.entries=new Map}readHeader(){if(!this.header)throw new Error("No header");this.size=this.header.getUInt3(),this.compressedSize=this.header.getUInt3()}decompress(){if(!this.zippedBuffer||!this.zippedBuffer.length)throw new Error("no archive to decompress");this.size!==this.compressedSize?this.unzippedBuffer=new ae(wt(this.zippedBuffer)):this.unzippedBuffer=new ae(this.zippedBuffer)}readEntries(){if(!this.unzippedBuffer)throw new Error("Unzipped buffer missing");const d=this.unzippedBuffer.getUShort();let h=2+d*10;for(let m=0;m<d;m+=1){const c=this.unzippedBuffer.getInt4(),u=this.unzippedBuffer.getUInt3(),n=this.unzippedBuffer.getUInt3(),l=Buffer.from(this.unzippedBuffer.data.slice(h,h+n));let p;u!==n?p=wt(l):p=l,this.entries.set(c,p),h+=n}}readArchive(d){this.header=new ae(d.subarray(0,6)),this.zippedBuffer=d.subarray(6),this.readHeader(),this.decompress(),this.readEntries()}hasEntry(d){const h=typeof d=="number"?d:ne(d);return this.entries.has(h)}getEntry(d){const h=typeof d=="number"?d:ne(d);if(!this.entries.has(h))throw new Error(`entry ${d} (${h}) not found`);return this.entries.get(h)}putEntry(d,h){const m=ne(d);this.entries.set(m,h)}writeHeader(){if(!this.unzippedBuffer||!this.zippedBuffer)throw new Error("Buffers not prepared");this.header=new ae(Buffer.alloc(6)),this.header.writeUInt3(this.unzippedBuffer.size),this.header.writeUInt3(this.zippedBuffer.length)}compress(d=!0){if(!this.unzippedBuffer)throw new Error("Unzipped buffer missing");d?this.zippedBuffer=Buffer.from(this.unzippedBuffer.data):this.zippedBuffer=yt(Buffer.from(this.unzippedBuffer.data))}writeEntries(d=!0){if(this.entries.size>Xt)throw new RangeError(`too many entries (${this.entries.size})`);const h=new Map;let m=0;for(const[u,n]of this.entries){const l=d?yt(n):n;if(h.set(u,l),n.length>bt||l.length>bt)throw new RangeError(`entry ${u} is too big`);m+=l.length}let c=2+this.entries.size*10;this.unzippedBuffer=new ae(Buffer.alloc(c+m)),this.unzippedBuffer.writeUShort(this.entries.size);for(const[u,n]of h)this.unzippedBuffer.writeInt4(u),this.unzippedBuffer.writeUInt3(this.entries.get(u).length),this.unzippedBuffer.writeUInt3(n.length),Buffer.from(n).copy(Buffer.from(this.unzippedBuffer.data.buffer),c),c+=n.length}toArchive(d=!0){if(this.writeEntries(d),this.compress(d),this.writeHeader(),!this.header||!this.zippedBuffer)throw new Error("Build failed");return Buffer.concat([Buffer.from(this.header.data),this.zippedBuffer])}}class Yt{archive;sprites;CanvasKit;constructor(){this.archive=new Zt,this.sprites=new Map}async init(){typeof window>"u"&&globalThis.CanvasKitInit&&(this.CanvasKit=await globalThis.CanvasKitInit())}loadArchive(d){this.archive.readArchive(d)}createCanvas(d,h){if(typeof document<"u"){const m=document.createElement("canvas");return m.width=d,m.height=h,m}else if(this.CanvasKit){const m=this.CanvasKit.MakeCanvas(d,h);return m.width=d,m.height=h,m}throw new Error("No Canvas environment found")}parseSprite(d,h,m){h.caret=d.getUShort();const c=h.getUShort(),u=h.getUShort(),n=h.getUByte(),l=new Int32Array(n);l[0]=16711935;for(let t=0;t<n-1;t++)l[t+1]=(h.getUByte()<<16)+(h.getUByte()<<8)+h.getUByte();const p=[];for(let t=0;t<m;t+=1){const r=h.getUByte(),e=h.getUByte(),i=h.getUShort(),s=h.getUShort(),o=i*s,f=h.getUByte(),b=new Uint8Array(o);if(f===0)for(let a=0;a<o;a++)b[a]=d.getUByte();else for(let a=0;a<i;a++)for(let w=0;w<s;w++)b[a+w*i]=d.getUByte();try{const a=this.createCanvas(c,u),w=a.getContext("2d");w.translate(r,e);for(let v=0;v<i;v++)for(let B=0;B<s;B++){const E=l[b[v+B*i]];if(E===16711935)continue;const R=E.toString(16).padStart(6,"0");w.fillStyle=`#${R}`,w.fillRect(v,B,1,1)}p.push(a)}catch(a){console.warn("Canvas creation failed, storing raw data",a),p.push({spriteColourIndex:b,palette:l,width:i,height:s})}}return p}compressSprites(d){return console.log("Packing sprites not fully implemented in shim"),this.archive.toArchive(!0)}getSprite(d){if(this.sprites.has(d))return this.sprites.get(d);try{const h=this.archive.getEntry(`${d}.dat`),m=this.archive.getEntry("index.dat"),c=this.parseSprite(new ae(h),new ae(m),1);if(c&&c.length>0){const u={img:c[0]};return this.sprites.set(d,u),u}}catch(h){console.warn(`SpritePacker: Failed to extract sprite ${d}`,h)}return null}}class tr{constructor(d={}){this.serviceConfig=d}engineCache=null;sceneCache=null;classicSource=null;configData=null;activeBlueprint=null;spritePacker=null;setBlueprint(d,h){this.activeBlueprint={name:d,path:h},console.log(`[ClassicRSMV] Blueprint active: ${d} (${h})`)}getBlueprint(){return this.activeBlueprint}async linkClassicDir(d){const h={readFileBuffer:async m=>{const c=await de.readLocalFile(`${d}\\${m}`,!0);if(!c.success||!c.content)throw new Error(`Failed to read ${m}`);const u=atob(c.content),n=new Uint8Array(u.length);for(let l=0;l<u.length;l++)n[l]=u.charCodeAt(l);return Buffer.from(n)},readFileText:async m=>{const c=await de.readLocalFile(`${d}\\${m}`,!1);if(!c.success||!c.content)throw new Error(`Failed to read ${m}`);return c.content},readDir:async m=>{const c=await de.listDirectory(`${d}\\${m}`);return!c.success||!c.files?[]:c.files.map(u=>({name:u.name,kind:u.isDirectory?"directory":"file",isDir:u.isDirectory,size:0}))},copyFile:async(m,c)=>{const u=await de.readLocalFile(`${d}\\from`,!0);if(!u.success||!u.content)throw new Error(`Failed to copy from ${m}`)},writeFile:async()=>{throw new Error("Write not supported")},mkDir:async()=>{throw new Error("Mkdir not supported")},unlink:async()=>{throw new Error("Unlink not supported")}};this.classicSource=await Ct.create(h),this.engineCache=await Mt.create(this.classicSource),this.configData=await Et(this.classicSource,this.classicSource.getBuildNr()),this.sceneCache=await St.create(this.engineCache);try{const m=await h.readFileBuffer("media.jag");this.spritePacker=new Yt,this.spritePacker.loadArchive(m)}catch(m){console.warn("[ClassicRSMV] Failed to load media.jag (some UI sprites might be missing)",m)}return!0}async loadModel(d,h){if(!this.sceneCache||!this.engineCache||!this.configData)throw new Error("Classic RSMV: Not initialized.");if(h==="npc"||h==="npcs"){const n=this.configData.npcs[d];if(!n)throw new Error(`NPC ${d} definition not found`);console.log(`[ClassicRSMV] Attempting to load paper NPC: ${d} (${n.name})`);const l=await this.engineCache.getArchiveById(0,102),t=`npc${n.walkmodel}`,r=l.find(v=>v.namehash===ne("INDEX.DAT")),e=l.find(v=>v.namehash===ne(`${t}.DAT`))||l.find(v=>v.namehash===ne(`npc${d}.DAT`));if(!r||!e)throw new Error(`Sprite ${t} not found in entity archive for NPC ${d}`);const{parseLegacySprite:i}=await _t(async()=>{const{parseLegacySprite:v}=await import("./enginecache-DOiY41nD.js").then(B=>B.s);return{parseLegacySprite:v}},__vite__mapDeps([0,1,2,3])),s=i(r.buffer,e.buffer),o=new Rt(s.img.data,s.img.width,s.img.height,Ut);o.needsUpdate=!0,o.minFilter=$e,o.magFilter=$e;const f=new kt(s.img.width/100,s.img.height/100),b=new It({map:o,transparent:!0,side:At,alphaTest:.1}),a=new Ot(f,b);a.name=`npc_sprite_${d}`,a.onBeforeRender=(v,B,E)=>{a.quaternion.copy(E.quaternion)};const w=new Nt;return w.add(a),w.scale.set(512,512,512),{id:d,name:n.name,scene:w,metadata:{id:d,examine:n.examine,type:"paper-npc",sprite:t,classic:!0,paper:!0}}}if(h==="item"||h==="items"){const n=this.configData.items[d];if(!n)throw new Error(`Item ${d} definition not found`);const l=n.baseSymbol||n.sprite||d;console.log(`[ClassicRSMV] Loading item model ${l} for ${n.name}`);const p=[{modelid:l,mods:{}}],t=new ve(this.sceneCache,p,`item_model:${l}`);return await t.model,{id:d,name:n.name,scene:t.rootnode,metadata:{...n,type:"item",modelId:l}}}if(h==="object"||h==="objects"){const n=this.configData.objects[d];if(!n)throw new Error(`Object ${d} definition not found`);const l=n.model.id;if(l===void 0)throw new Error(`Object ${d} has no valid model ID`);console.log(`[ClassicRSMV] Loading object model ${l} (${n.model.name}) for ${n.name}`);const p=[{modelid:l,mods:{}}],t=new ve(this.sceneCache,p,`object_model:${l}`);return await t.model,{id:d,name:n.name,scene:t.rootnode,metadata:{...n,type:"object",modelId:l,modelName:n.model.name}}}const m=[{modelid:d,mods:{}}],c=new ve(this.sceneCache,m,`classic_model:${d}`),u=await c.model;return{id:d,name:c.rootnode.name||`Model ${d}`,scene:c.rootnode,metadata:{id:d,classic:!0,paper:!1,...u?.modeldata||{}}}}async loadAvatar(d){throw new Error("Classic Avatar loading not implemented.")}dispose(){this.engineCache?.close(),this.sceneCache=null,this.engineCache=null,this.classicSource=null,this.spritePacker=null}async getItems(){return this.configData?.items||[]}async getNPCs(){return this.configData?.npcs||[]}async getObjects(){return this.configData?.objects||[]}async getSpells(){return this.configData?.spells||[]}async getPrayers(){return this.configData?.prayers||[]}async getWallObjects(){return this.configData?.wallobjects||[]}async getTiles(){return this.configData?.tiles||[]}async loadMap(d){if(!this.engineCache)throw new Error("Classic RSMV: Not initialized.");const h=await this.engineCache.getArchiveById(0,103),m=await this.engineCache.getArchiveById(0,104),c=`m${d}`,u=`l${d}`,n=h.find(p=>p.namehash===ne(`${c}.jag`))||h.find(p=>p.fileid===d),l=m.find(p=>p.namehash===ne(`${u}.jag`))||m.find(p=>p.fileid===d);return{id:d,map:n?.buffer,land:l?.buffer,type:"rsc_map"}}async loadAudio(d){if(!this.engineCache)throw new Error("Classic RSMV: Not initialized.");const m=(await this.engineCache.getArchiveById(0,108)).find(c=>c.fileid===d);if(!m)throw new Error(`Audio ${d} not found in sounds archive`);return{id:d,buffer:m.buffer,type:"rsc_audio"}}async loadUI(d){if(!this.spritePacker)throw new Error("Classic RSMV: UI media not loaded.");const h=this.spritePacker.getSprite(d);if(!h)throw new Error(`UI Sprite ${d} not found`);return{name:d,img:h.img,type:"rsc_ui"}}getConfig(){return this.configData}}export{tr as ClassicRSMVService};

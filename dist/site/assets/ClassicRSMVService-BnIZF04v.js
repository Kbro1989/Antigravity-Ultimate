const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/enginecache-KDYRmXzf.js","assets/main-BVuYDR_W.js","assets/main-DmuLaqgn.css","assets/three.module-DqfR4SX2.js"])))=>i.map(i=>d[i]);
import{p as gt,B as V,_ as Ft,l as ue}from"./main-BVuYDR_W.js";import{a as _t,E as Ct,b as Mt,T as Et,R as St}from"./enginecache-KDYRmXzf.js";import{ah as Rt,Z as Ut,N as We,af as kt,ai as At,j as It,h as Ot,G as Nt}from"./three.module-DqfR4SX2.js";import"../src/services/rsmv/clientscript/index.ts";import"../src/services/rsmv/clientscript/interpreter.ts";class fe{data;caret;constructor(d){this.data=new Uint8Array(d),this.caret=0}get size(){return this.data.length}oobError(){return new RangeError("out of bounds")}getUByte(){if(this.caret+1>this.size)throw this.oobError();const d=this.data[this.caret]>>>0;return this.caret+=1,d}getUShort(){if(this.caret+2>this.size)throw this.oobError();let d=(this.data[this.caret]&255)<<8>>>0;return d=(d|this.data[this.caret+1]&255)>>>0,this.caret+=2,d}getUInt3(){if(this.caret+3>this.size)throw this.oobError();let d=(this.data[this.caret]&255)<<16>>>0;return d=(d|(this.data[this.caret+1]&255)<<8)>>>0,d=(d|this.data[this.caret+2]&255)>>>0,this.caret+=3,d}getInt4(){if(this.caret+4>this.size)throw this.oobError();let d=(this.data[this.caret]&255)<<24;return d=d|(this.data[this.caret+1]&255)<<16,d=d|(this.data[this.caret+2]&255)<<8,d=d|this.data[this.caret+3]&255,this.caret+=4,d}getBytes(d,c){const m=c===void 0||isNaN(c)?this.caret:c,h=this.data.slice(m,m+d);return this.caret+=d,h}writeUByte(d){this.data[this.caret]=d,this.caret+=1}writeUShort(d){this.data[this.caret]=d>>8&255,this.data[this.caret+1]=d&255,this.caret+=2}writeUInt3(d){this.data[this.caret]=d>>16>>>0,this.data[this.caret+1]=d>>8>>>0,this.data[this.caret+2]=d&255,this.caret+=3}writeInt4(d){this.data[this.caret]=d>>24,this.data[this.caret+1]=d>>16,this.data[this.caret+2]=d>>8,this.data[this.caret+3]=d&255,this.caret+=4}}var le={exports:{}},$e;function he(){return $e||($e=1,Object.freeze?le.exports=Object.freeze:le.exports=function(U){return U}),le.exports}var me,Xe;function ee(){if(Xe)return me;Xe=1;const U=he();var d=-1,c=function(){};return c.prototype.readByte=function(){var m=[0],h=this.read(m,0,1);return h===0?(this._eof=!0,d):m[0]},c.prototype.read=function(m,h,u){for(var n,v=0;v<u;){if(n=this.readByte(),n===d){this._eof=!0;break}m[h+v++]=n}return v},c.prototype.eof=function(){return!!this._eof},c.prototype.seek=function(m){throw new Error("Stream is not seekable.")},c.prototype.tell=function(){throw new Error("Stream is not seekable.")},c.prototype.writeByte=function(m){var h=[m];this.write(h,0,1)},c.prototype.write=function(m,h,u){var n;for(n=0;n<u;n++)this.writeByte(m[h+n]);return u},c.prototype.flush=function(){},c.EOF=d,me=U(c),me}var be,Ze;function de(){if(Ze)return be;Ze=1;const U=ee();var d=function(c){(function(){var m=256;this.readBit=function(){if((m&255)===0){var h=c.readByte();if(h===U.EOF)return this._eof=!0,h;m=h<<1|1}var u=m&256?1:0;return m<<=1,u},this.seekBit=function(h){var u=h>>>3,n=h-u*8;this.seek(u),this._eof=!1,this.readBits(n)},this.tellBit=function(){for(var h=c.tell()*8,u=m;(u&255)!==0;)h--,u<<=1;return h},this.readByte=function(){return(m&255)===0?c.readByte():this.readBits(8)},this.seek=function(h){c.seek(h),m=256}}).call(this),(function(){var m=1;this.writeBit=function(h){m<<=1,h&&(m|=1),m&256&&(c.writeByte(m&255),m=1)},this.writeByte=function(h){m===1?c.writeByte(h):c.writeBits(8,h)},this.flush=function(){for(;m!==1;)this.writeBit(0);c.flush&&c.flush()}}).call(this)};return d.EOF=U.EOF,d.prototype=Object.create(U.prototype),d.prototype.readBits=function(c){var m,h=0;if(c>31)return h=this.readBits(c-16)*65536,h+this.readBits(16);for(m=0;m<c;m++)h<<=1,this.readBit()>0&&h++;return h},d.prototype.writeBits=function(c,m){if(c>32){var h=m&65535,u=(m-h)/65536;this.writeBits(c-16,u),this.writeBits(16,h);return}var n;for(n=c-1;n>=0;n--)this.writeBit(m>>>n&1)},be=d,be}var we,Ye;function Y(){if(Ye)return we;Ye=1;const U=he(),d=ee();var c=Object.create(null),m=d.EOF;c.coerceInputStream=function(r,e){if("readByte"in r){if(e&&!("read"in r)){var s=r;r=new d,r.readByte=function(){var o=s.readByte();return o===m&&(this._eof=!0),o},"size"in s&&(r.size=s.size),"seek"in s&&(r.seek=function(o){s.seek(o),this._eof=!1}),"tell"in s&&(r.tell=s.tell.bind(s))}}else{var i=r;r=new d,r.size=i.length,r.pos=0,r.readByte=function(){return this.pos>=this.size?m:i[this.pos++]},r.read=function(o,f,b){for(var a=0;a<b&&this.pos<i.length;)o[f++]=i[this.pos++],a++;return a},r.seek=function(o){this.pos=o},r.tell=function(){return this.pos},r.eof=function(){return this.pos>=i.length}}return r};var h=function(r,e){this.buffer=r,this.resizeOk=e,this.pos=0};h.prototype=Object.create(d.prototype),h.prototype.writeByte=function(r){if(this.resizeOk&&this.pos>=this.buffer.length){var e=c.makeU8Buffer(this.buffer.length*2);e.set(this.buffer),this.buffer=e}this.buffer[this.pos++]=r},h.prototype.getBuffer=function(){if(this.pos!==this.buffer.length){if(!this.resizeOk)throw new TypeError("outputsize does not match decoded input");var r=c.makeU8Buffer(this.pos);r.set(this.buffer.subarray(0,this.pos)),this.buffer=r}return this.buffer},c.coerceOutputStream=function(r,e){var i={stream:r,retval:r};if(r){if(typeof r=="object"&&"writeByte"in r)return i;typeof e=="number"?(console.assert(e>=0),i.stream=new h(c.makeU8Buffer(e),!1)):i.stream=new h(r,!1)}else i.stream=new h(c.makeU8Buffer(16384),!0);return Object.defineProperty(i,"retval",{get:i.stream.getBuffer.bind(i.stream)}),i},c.compressFileHelper=function(r,e,i){return function(s,o,f){s=c.coerceInputStream(s);var b=c.coerceOutputStream(o,o);o=b.stream;var a;for(a=0;a<r.length;a++)o.writeByte(r.charCodeAt(a));var w;if("size"in s&&s.size>=0?w=s.size:w=-1,i){var p=c.coerceOutputStream([]);for(c.writeUnsignedNumber(p.stream,w+1),p=p.retval,a=0;a<p.length-1;a++)o.writeByte(p[a]);i=p[p.length-1]}else c.writeUnsignedNumber(o,w+1);return e(s,o,w,f,i),b.retval}},c.decompressFileHelper=function(r,e){return function(i,s){i=c.coerceInputStream(i);var o;for(o=0;o<r.length;o++)if(r.charCodeAt(o)!==i.readByte())throw new Error("Bad magic");var f=c.readUnsignedNumber(i)-1,b=c.coerceOutputStream(s,f);return s=b.stream,e(i,s,f),b.retval}},c.compressWithModel=function(r,e,i){for(var s=0;s!==e;){var o=r.readByte();if(o===m){i.encode(256);break}i.encode(o),s++}},c.decompressWithModel=function(r,e,i){for(var s=0;s!==e;){var o=i.decode();if(o===256)break;r.writeByte(o),s++}},c.writeUnsignedNumber=function(r,e){console.assert(e>=0);var i=[],s;do i.push(e&127),e=Math.floor(e/128);while(e!==0);for(i[0]|=128,s=i.length-1;s>=0;s--)r.writeByte(i[s]);return r},c.readUnsignedNumber=function(r){for(var e=0,i;;){if(i=r.readByte(),i&128){e+=i&127;break}e=(e+i)*128}return e};var u=function(r){for(var e=0,i=r.length;e<i;e++)r[e]=0;return r},n=function(r){return u(new Array(r))},v=function(e){return e};typeof gt<"u"&&Array.prototype.some.call(new Uint32Array(128),function(r){return r!==0})&&(v=u),c.makeU8Buffer=typeof Uint8Array<"u"?function(r){return v(new Uint8Array(r))}:typeof V<"u"?function(r){var e=new V(r);return e.fill(0),e}:n,c.makeU16Buffer=typeof Uint16Array<"u"?function(r){return v(new Uint16Array(r))}:n,c.makeU32Buffer=typeof Uint32Array<"u"?function(r){return v(new Uint32Array(r))}:n,c.makeS32Buffer=typeof Int32Array<"u"?function(r){return v(new Int32Array(r))}:n,c.arraycopy=function(r,e){console.assert(r.length>=e.length);for(var i=0,s=e.length;i<s;i++)r[i]=e[i];return r};var l=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8];console.assert(l.length===256);var t=c.fls=function(r){return console.assert(r>=0),r>4294967295?32+t(Math.floor(r/4294967296)):(r&4294901760)!==0?(r&4278190080)!==0?24+l[r>>>24&255]:16+l[r>>>16]:(r&65280)!==0?8+l[r>>>8]:l[r]};return c.log2c=function(r){return r===0?-1:t(r-1)},we=U(c),we}var xe,Ke;function Le(){if(Ke)return xe;Ke=1;const U=he(),d=Y();var c=console.assert.bind(console),m=function(e,i,s,o){var f;for(f=0;f<o;f++)i[f]=0;for(f=0;f<s;f++)i[e[f]]++},h=function(e,i,s,o){var f,b=0;if(o)for(f=0;f<s;f++)b+=e[f],i[f]=b;else for(f=0;f<s;f++)b+=e[f],i[f]=b-e[f]},u=function(e,i,s,o,f,b){var a,w,p,B,E;for(s===o&&m(e,s,f,b),h(s,o,b,!1),p=f-1,a=o[E=e[p]],p--,i[a++]=e[p]<E?~p:p,w=0;w<f;w++)(p=i[w])>0?(c(e[p]>=e[p+1]),(B=e[p])!==E&&(o[E]=a,a=o[E=B]),c(w<a),p--,i[a++]=e[p]<E?~p:p,i[w]=0):p<0&&(i[w]=~p);for(s===o&&m(e,s,f,b),h(s,o,b,1),w=f-1,a=o[E=0];w>=0;w--)(p=i[w])>0&&(c(e[p]<=e[p+1]),(B=e[p])!==E&&(o[E]=a,a=o[E=B]),c(a<=w),p--,i[--a]=e[p]>E?~(p+1):p,i[w]=0)},n=function(e,i,s,o){var f,b,a,w,p,B,E,R,S,A;for(c(s>0),f=0;(a=i[f])<0;f++)i[f]=~a,c(f+1<s);if(f<o)for(b=f,f++;c(f<s),!((a=i[f])<0&&(i[b++]=~a,i[f]=0,b===o));f++);R=e[f=b=s-1];do S=R;while(--f>=0&&(R=e[f])>=S);for(;f>=0;){do S=R;while(--f>=0&&(R=e[f])<=S);if(f>=0){i[o+(f+1>>>1)]=b-f,b=f+1;do S=R;while(--f>=0&&(R=e[f])>=S)}}for(f=0,E=0,w=s,B=0;f<o;f++){if(a=i[f],p=i[o+(a>>>1)],A=!0,p===B&&w+p<s){for(b=0;b<p&&e[a+b]===e[w+b];)b++;b===p&&(A=!1)}A&&(E++,w=a,B=p),i[o+(a>>>1)]=E}return E},v=function(e,i,s,o,f,b){var a,w,p,B,E;for(s===o&&m(e,s,f,b),h(s,o,b,!1),p=f-1,a=o[E=e[p]],i[a++]=p>0&&e[p-1]<E?~p:p,w=0;w<f;w++)p=i[w],i[w]=~p,p>0&&(p--,c(e[p]>=e[p+1]),(B=e[p])!==E&&(o[E]=a,a=o[E=B]),c(w<a),i[a++]=p>0&&e[p-1]<E?~p:p);for(s===o&&m(e,s,f,b),h(s,o,b,!0),w=f-1,a=o[E=0];w>=0;w--)(p=i[w])>0?(p--,c(e[p]<=e[p+1]),(B=e[p])!==E&&(o[E]=a,a=o[E=B]),c(a<=w),i[--a]=p===0||e[p-1]>E?~p:p):i[w]=~p},l=function(e,i,s,o,f,b){var a,w,p,B=-1,E,R;for(s===o&&m(e,s,f,b),h(s,o,b,!1),p=f-1,a=o[R=e[p]],i[a++]=p>0&&e[p-1]<R?~p:p,w=0;w<f;w++)(p=i[w])>0?(p--,c(e[p]>=e[p+1]),i[w]=~(E=e[p]),E!==R&&(o[R]=a,a=o[R=E]),c(w<a),i[a++]=p>0&&e[p-1]<R?~p:p):p!==0&&(i[w]=~p);for(s===o&&m(e,s,f,b),h(s,o,b,!0),w=f-1,a=o[R=0];w>=0;w--)(p=i[w])>0?(p--,c(e[p]<=e[p+1]),i[w]=E=e[p],E!==R&&(o[R]=a,a=o[R=E]),c(a<=w),i[--a]=p>0&&e[p-1]>R?~e[p-1]:p):p!==0?i[w]=~p:B=w;return B},t=function(e,i,s,o,f,b){var a,w,p,B,E,R,S,A,k,N,y=0,_,x,F,g=0;for(f<=256?(a=d.makeS32Buffer(f),f<=s?(w=i.subarray(o+s-f),g=1):(w=d.makeS32Buffer(f),g=3)):f<=s?(a=i.subarray(o+s-f),f<=s-f?(w=i.subarray(o+s-f*2),g=0):f<=1024?(w=d.makeS32Buffer(f),g=2):(w=a,g=8)):(a=w=d.makeS32Buffer(f),g=12),m(e,a,o,f),h(a,w,f,!0),B=0;B<o;B++)i[B]=0;R=-1,B=o-1,E=o,S=0,x=e[o-1];do F=x;while(--B>=0&&(x=e[B])>=F);for(;B>=0;){do F=x;while(--B>=0&&(x=e[B])<=F);if(B>=0){R>=0&&(i[R]=E),R=--w[F],E=B,++S;do F=x;while(--B>=0&&(x=e[B])>=F)}}if(S>1?(u(e,i,a,w,o,f),N=n(e,i,o,S)):S===1?(i[R]=E+1,N=1):N=0,N<S){for((g&4)!==0&&(a=null,w=null),(g&2)!==0&&(w=null),_=o+s-S*2,(g&13)===0&&(f+N<=_?_-=f:g|=8),c(o>>>1<=_+S),B=S+(o>>>1)-1,E=S*2+_-1;S<=B;B--)i[B]!==0&&(i[E--]=i[B]-1);p=i.subarray(S+_),t(p,i,_,S,N,!1),p=null,B=o-1,E=S*2-1,x=e[o-1];do F=x;while(--B>=0&&(x=e[B])>=F);for(;B>=0;){do F=x;while(--B>=0&&(x=e[B])<=F);if(B>=0){i[E--]=B+1;do F=x;while(--B>=0&&(x=e[B])>=F)}}for(B=0;B<S;B++)i[B]=i[S+i[B]];(g&4)!==0&&(a=w=d.makeS32Buffer(f)),(g&2)!==0&&(w=d.makeS32Buffer(f))}if((g&8)!==0&&m(e,a,o,f),S>1){h(a,w,f,!0),B=S-1,E=o,A=i[S-1],F=e[A];do{for(k=w[x=F];k<E;)i[--E]=0;do{if(i[--E]=A,--B<0)break;A=i[B]}while((F=e[A])===x)}while(B>=0);for(;E>0;)i[--E]=0}return b?y=l(e,i,a,w,o,f):v(e,i,a,w,o,f),a=null,w=null,y},r=Object.create(null);return r.suffixsort=function(e,i,s,o){if(c(e&&i&&e.length>=s&&i.length>=s),s<=1)return s===1&&(i[0]=0),0;if(!o)if(e.BYTES_PER_ELEMENT===1)o=256;else if(e.BYTES_PER_ELEMENT===2)o=65536;else throw new Error("Need to specify alphabetSize");return c(o>0),e.BYTES_PER_ELEMENT&&c(o<=1<<e.BYTES_PER_ELEMENT*8),t(e,i,0,s,o,!1)},r.bwtransform=function(e,i,s,o,f){var b,a;if(c(e&&i&&s),c(e.length>=o&&i.length>=o&&s.length>=o),o<=1)return o===1&&(i[0]=e[0]),o;if(!f)if(e.BYTES_PER_ELEMENT===1)f=256;else if(e.BYTES_PER_ELEMENT===2)f=65536;else throw new Error("Need to specify alphabetSize");for(c(f>0),e.BYTES_PER_ELEMENT&&c(f<=1<<e.BYTES_PER_ELEMENT*8),a=t(e,s,0,o,f,!0),i[0]=e[o-1],b=0;b<a;b++)i[b+1]=s[b];for(b+=1;b<o;b++)i[b]=s[b];return a+1},r.unbwtransform=function(e,i,s,o,f){var b=d.makeU32Buffer(256),a,w;for(a=0;a<256;a++)b[a]=0;for(a=0;a<o;a++)s[a]=b[e[a]]++;for(a=0,w=0;a<256;a++)w+=b[a],b[a]=w-b[a];for(a=o-1,w=0;a>=0;a--)w=s[w]+b[i[a]=e[w]],w+=w<f?1:0;b=null},r.bwtransform2=function(e,i,s,o){var f,b,a=0;if(c(e&&i),c(e.length>=s&&i.length>=s),s<=1)return s===1&&(i[0]=e[0]),0;if(!o)if(e.BYTES_PER_ELEMENT===1)o=256;else if(e.BYTES_PER_ELEMENT===2)o=65536;else throw new Error("Need to specify alphabetSize");c(o>0),e.BYTES_PER_ELEMENT&&c(o<=1<<e.BYTES_PER_ELEMENT*8);var w;if(e.length>=s*2?w=e:o<=256?w=d.makeU8Buffer(s*2):o<=65536?w=d.makeU16Buffer(s*2):w=d.makeU32Buffer(s*2),w!==e)for(f=0;f<s;f++)w[f]=e[f];for(f=0;f<s;f++)w[s+f]=w[f];var p=d.makeS32Buffer(s*2);for(t(w,p,0,s*2,o,!1),f=0,b=0;f<2*s;f++){var B=p[f];B<s&&(B===0&&(a=b),--B<0&&(B=s-1),i[b++]=e[B])}return c(b===s),a},xe=U(r),xe}var ye,Ve;function qe(){if(Ve)return ye;Ve=1;const U=de(),d=Y();var c=function(h,u,n,v){this.up=h,this.down=u,this.symbol=n,this.weight=v};c.prototype.clone=function(){return new c(this.up,this.down,this.symbol,this.weight)},c.prototype.set=function(h){this.up=h.up,this.down=h.down,this.symbol=h.symbol,this.weight=h.weight};var m=function(h,u,n,v){var l;for(console.assert(h&&typeof h=="number"),(!u||u>h)&&(u=h),(u<<=1)&&u--,this.table=[],l=0;l<=u;l++)this.table[l]=new c(0,0,0,0);if(this.map=[],this.size=h)for(l=0;l<h;l++)this.map[l]=0;this.esc=this.root=u,n&&(this.readBit=n.readBit.bind(n),this.writeBit=n.writeBit.bind(n)),this.max_weight=v};return m.factory=function(h,u){return function(n){return new m(n,n,h,u)}},m.prototype.split=function(h){var u,n;if(u=this.esc)this.esc--;else return console.assert(!1),0;return(n=this.esc)?(this.table[u].down=n,this.table[u].weight=1,this.table[n].up=u,this.esc--):(u=0,n=1),this.table[n].symbol=h,this.table[n].weight=0,this.table[n].down=0,this.map[h]=n,this.table[this.esc].weight=0,this.table[this.esc].down=0,this.table[this.esc].up=u,n},m.prototype.leader=function(h){for(var u=this.table[h].weight,n=h,v,l;u===this.table[n+1].weight;)n++;return n===h?h:(l=this.table[h].symbol,v=this.table[n].symbol,this.table[n].symbol=l,this.table[h].symbol=v,this.map[l]=n,this.map[v]=h,n)},m.prototype.slide=function(h){var u=h,n;if(n=this.table[u++].clone(),n.weight&1)for(;n.weight>this.table[u+1].weight;)u++;return this.table[h].set(this.table[u]),this.table[u].set(n),this.table[u].up=this.table[h].up,this.table[h].up=n.up,n.weight&1?(this.table[n.down].up=u,this.table[n.down-1].up=u,this.map[this.table[h].symbol]=h):(this.table[this.table[h].down-1].up=h,this.table[this.table[h].down].up=h,this.map[n.symbol]=u),u},m.prototype.increment=function(h){var u;for(this.table[h].up===h+1?(this.table[h].weight+=2,h++):h=this.leader(h);this.table[h].weight+=2,u=this.table[h].up;){for(;this.table[h].weight>this.table[h+1].weight;)h=this.slide(h);this.table[h].weight&1?h=u:h=this.table[h].up}this.max_weight&&this.table[this.root].weight>=this.max_weight&&this.scale(1)},m.prototype.scale=function(h){for(var u=this.esc,n,v;++u<=this.root;)for(this.table[u].weight&1?(n=this.table[this.table[u].down].weight&-2)&&(n+=this.table[this.table[u].down-1].weight|1):(n=this.table[u].weight>>h&-2)||(this.map[this.table[u].symbol]=0,this.esc++&&this.esc++),this.table[u].weight=n,v=u;n<this.table[--v].weight;)this.slide(v);this.table[this.esc].down=0},m.prototype.sendid=function(h){for(var u=0,n;h--;)this.map[h]||u++;if(n=this.size-Math.floor((this.root-this.esc)/2)-1)do this.writeBit(u&1),u>>=1;while(n>>=1)},m.prototype.encode=function(h){var u=1,n,v,l,t;if(h<this.size)t=this.map[h];else{console.assert(!1);return}if(!(!(l=t)&&!(l=this.esc))){for(;v=this.table[l].up;)u<<=1,u|=l&1,l=v;for(;n=u&1,u>>=1;)this.writeBit(n);t||(this.sendid(h),t=this.split(h)),this.increment(t)}},m.prototype.readid=function(){var h=0,u=1,n,v;if(n=this.size-Math.floor((this.root-this.esc)/2)-1)do h|=this.readBit()?u:0,u<<=1;while(n>>=1);for(v=0;v<this.size;v++)if(!this.map[v]&&!h--)return v;return console.assert(!1),0},m.prototype.decode=function(){for(var h=this.root,u,n;n=this.table[h].down;)this.readBit()?h=n-1:h=n;if(h===this.esc)if(this.esc)u=this.readid(),h=this.split(u);else return console.assert(!1),0;else u=this.table[h].symbol;return this.increment(h),u},m.MAGIC="huff",m.compressFile=d.compressFileHelper(m.MAGIC,function(h,u,n,v){var l=new U(u),t=256;n<0&&t++;var r=new m(257,t,l,8191);d.compressWithModel(h,n,r),l.flush()}),m.decompressFile=d.decompressFileHelper(m.MAGIC,function(h,u,n){var v=new U(h),l=256;n<0&&l++;var t=new m(257,l,v,8191);d.decompressWithModel(u,n,t)}),ye=m,ye}var Be,Je;function He(){if(Je)return Be;Je=1;const U=de(),d=qe(),c=Y();var m=function(h,u,n){var v;for(this.literalModel=[],v=0;v<u;v++)this.literalModel[v]=h(n)};return m.prototype.encode=function(h,u){this.literalModel[u].encode(h)},m.prototype.decode=function(h){return this.literalModel[h].decode()},m.MAGIC="ctx1",m.compressFile=c.compressFileHelper(m.MAGIC,function(h,u,n,v){var l=new U(u),t=256;n<0&&t++;var r=d.factory(l,8191),e=new m(r,256,t),i=32,s={encode:function(o){e.encode(o,i),i=o}};c.compressWithModel(h,n,s),l.flush()}),m.decompressFile=c.decompressFileHelper(m.MAGIC,function(h,u,n){var v=new U(h),l=256;n<0&&l++;var t=d.factory(v,8191),r=new m(t,256,l),e=32,i={decode:function(){var s=r.decode(e);return e=s,s}};c.decompressWithModel(u,n,i)}),Be=m,Be}var ge,Qe;function ie(){if(Qe)return ge;Qe=1;var U=32,d=Math.pow(2,U-1),c=U-9,m=(U-2)%8+1,h=d>>>8,u=Math.pow(2,U)-1,n=function(t){this.low=0,this.range=d,this.buffer=0,this.help=0,this.bytecount=0,this.stream=t},v=function(t,r){for(;t.range<=h;){if(t.low<255<<c){for(r.writeByte(t.buffer);t.help;t.help--)r.writeByte(255);t.buffer=t.low>>>c&255}else if(t.low&d){for(r.writeByte(t.buffer+1);t.help;t.help--)r.writeByte(0);t.buffer=t.low>>>c&255}else if(t.help++,t.help>u)throw new Error("Too many bytes outstanding, file too large!");t.range=t.range<<8>>>0,t.low=(t.low<<8&d-1)>>>0,t.bytecount++}};n.prototype.encodeStart=function(t,r){this.low=0,this.range=d,this.buffer=t,this.help=0,this.bytecount=r},n.prototype.encodeFreq=function(t,r,e){v(this,this.stream);var i=this.range/e>>>0,s=i*r;this.low+=s,r+t<e?this.range=i*t:this.range-=s},n.prototype.encodeShift=function(t,r,e){v(this,this.stream);var i=this.range>>>e,s=i*r;this.low+=s,r+t>>>e?this.range-=s:this.range=i*t},n.prototype.encodeBit=function(t){this.encodeShift(1,t?1:0,1)},n.prototype.encodeByte=function(t){this.encodeShift(1,t,8)},n.prototype.encodeShort=function(t){this.encodeShift(1,t,16)},n.prototype.encodeFinish=function(){var t=this.stream;v(this,t),this.bytecount+=5;var r=this.low>>>c;if((this.low&h-1)>=(this.bytecount&16777215)>>>1&&r++,r>255)for(t.writeByte(this.buffer+1);this.help;this.help--)t.writeByte(0);else for(t.writeByte(this.buffer);this.help;this.help--)t.writeByte(255);return t.writeByte(r&255),t.writeByte(this.bytecount>>>16&255),t.writeByte(this.bytecount>>>8&255),t.writeByte(this.bytecount&255),this.bytecount},n.prototype.decodeStart=function(t){var r=t?0:this.stream.readByte();return typeof r!="number"||r<0||(this.buffer=this.stream.readByte(),this.low=this.buffer>>>8-m,this.range=1<<m),r};var l=function(t,r){for(;t.range<=h;)t.low=t.low<<8|t.buffer<<m&255,t.buffer=r.readByte(),t.low|=t.buffer>>>8-m,t.low=t.low>>>0,t.range=t.range<<8>>>0};return n.prototype.decodeCulFreq=function(t){l(this,this.stream),this.help=this.range/t>>>0;var r=this.low/this.help>>>0;return r>=t?t-1:r},n.prototype.decodeCulShift=function(t){l(this,this.stream),this.help=this.range>>>t;var r=this.low/this.help>>>0;return r>>>t?(1<<t)-1:r},n.prototype.decodeUpdate=function(t,r,e){var i=this.help*r;this.low-=i,r+t<e?this.range=this.help*t:this.range-=i},n.prototype.decodeBit=function(){var t=this.decodeCulShift(1);return this.decodeUpdate(1,t,2),t},n.prototype.decodeByte=function(){var t=this.decodeCulShift(8);return this.decodeUpdate(1,t,256),t},n.prototype.decodeShort=function(){var t=this.decodeCulShift(16);return this.decodeUpdate(1,t,65536),t},n.prototype.decodeFinish=function(){l(this,this.stream)},n.prototype.writeBit=n.prototype.encodeBit,n.prototype.readBit=n.prototype.decodeBit,n.prototype.writeByte=n.prototype.encodeByte,n.prototype.readByte=n.prototype.decodeByte,ge=n,ge}var Fe,et;function ze(){if(et)return Fe;et=1;const U=ie();ee();const d=Y();var c=8,m=1<<c,h=40,u=function(n,v,l){var t;console.assert(v<300);var r=this.numSyms=v;for(this.coder=n,this.prob=d.makeU16Buffer(v+2),this.escape=d.makeU16Buffer(v+1),this.update=d.makeU16Buffer(v+1),this.prob[r+1]=m,t=0;t<=this.numSyms;t++)this.escape[t]=t;if(this.updateCount=0,this.updateThresh=m-Math.floor(m/2),!!l){for(this.probToSym=d.makeU16Buffer(m),this.escProbToSym=d.makeU16Buffer(this.numSyms),t=0;t<m;t++)this.probToSym[t]=r;for(t=0;t<this.numSyms;t++)this.escProbToSym[t]=t}};return u.factory=function(n,v){return function(l){return new u(n,l,v)}},u.prototype._update=function(n,v){if(!(n===this.numSyms&&(this.update[n]>=h||this.updateCount>=this.updateThresh-1))&&(this.update[n]++,this.updateCount++,!(this.updateCount<this.updateThresh))){var l,t,r,e,i,s;for(this.escape[0]=this.prob[0]=l=t=r=0,e=0;e<this.numSyms+1;e++){var o=(this.prob[e+1]-this.prob[e]>>>1)+this.update[e];o?(this.prob[e]=l,l+=o,o&1&&r++,this.escape[e]=t):(this.prob[e]=l,this.escape[e]=t,t++)}for(this.prob[e]=l,console.assert(l===m),this.updateThresh=m-Math.floor((l-r)/2),e=0;e<this.numSyms+1;e++)this.update[e]=0;if(this.update[this.numSyms]=1,this.updateCount=1,!!v)for(e=0,i=0,s=0;e<this.numSyms+1;e++){for(var f=this.prob[e+1];i<f;i++)this.probToSym[i]=e;for(var b=this.escape[e+1];s<b;s++)this.escProbToSym[s]=e}}},u.prototype.encode=function(n){var v=this.prob[n],l=this.prob[n+1]-v;if(console.assert(this.prob[this.numSyms+1]===m),l)return this.coder.encodeShift(l,v,c),this._update(n);console.assert(n!==this.numSyms),this.encode(this.numSyms),v=this.escape[n],l=this.escape[n+1]-v;var t=this.escape[this.numSyms];return this.coder.encodeFreq(l,v,t),this._update(n)},u.prototype.decode=function(){var n=this.coder.decodeCulShift(c),v=this.probToSym[n],l=this.prob[v],t=this.prob[v+1]-l;if(this.coder.decodeUpdate(t,l,m),this._update(v,!0),v!==this.numSyms)return v;var r=this.escape[this.numSyms];return n=this.coder.decodeCulFreq(r),v=this.escProbToSym[n],l=this.escape[v],t=this.escape[v+1]-l,this.coder.decodeUpdate(t,l,r),this._update(v,!0),v},u.MAGIC="dfsm",u.compressFile=d.compressFileHelper(u.MAGIC,function(n,v,l,t,r){var e=new U(v);e.encodeStart(r,1);var i=new u(e,l<0?257:256);d.compressWithModel(n,l,i),e.encodeFinish()},!0),u.decompressFile=d.decompressFileHelper(u.MAGIC,function(n,v,l){var t=new U(n);t.decodeStart(!0);var r=new u(t,l<0?257:256,!0);d.decompressWithModel(v,l,r),t.decodeFinish()}),Fe=u,Fe}var _e,tt;function pe(){if(tt)return _e;tt=1;const U=ie();ee();const d=Y();var c=65280,m=256,h=65535,u=0,n=4294901760,v=16,l=4294901758,t=function(r,e,i,s){this.coder=r,this.numSyms=e+1,this.tree=d.makeU32Buffer(this.numSyms*2),this.increment=+s||m,this.max_prob=+i||c,console.assert(this.max_prob+(this.increment-1)<=65535),console.assert(e<=65535);var o;for(o=0;o<e;o++)this.tree[this.numSyms+o]=1<<u|0<<v;this.tree[this.numSyms+o]=0<<u|this.increment<<v,this._sumTree()};return t.factory=function(r,e,i){return function(s){return new t(r,s,e,i)}},t.prototype.clone=function(){var r=new t(this.coder,this.size,this.max_prob,this.increment),e;for(e=1;e<this.tree.length;e++)r.tree[e]=this.tree[e];return r},t.prototype.encode=function(r){var e=this.numSyms+r,i=this.tree[e],s=n,o=v,f=this.increment<<v;(i&n)===0?(this.encode(this.numSyms-1),s=h,f-=1<<u,o=u):r===this.numSyms-1&&(this.tree[1]&h)>>>u===1&&(f=-this.tree[e]);for(var b=0;e>1;){var a=e&1,w=e>>>1;a&&(b+=this.tree[2*w]),this.tree[e]+=f,e=w}var p=this.tree[1];this.tree[1]+=f,i=(i&s)>>>o,b=(b&s)>>>o,p=(p&s)>>>o,this.coder.encodeFreq(i,b,p),(this.tree[1]&n)>>>v>=this.max_prob&&this._rescale()},t.prototype._decode=function(r){var e=n,i=v,s=this.increment<<v;r&&(e=h,s-=1<<u,i=u);for(var o=(this.tree[1]&e)>>>i,f=this.coder.decodeCulFreq(o),b=1,a=0;b<this.numSyms;){this.tree[b]+=s;var w=(this.tree[2*b]&e)>>>i;b*=2,f-a>=w&&(a+=w,b++)}var p=b-this.numSyms,B=(this.tree[b]&e)>>>i;if(this.tree[b]+=s,this.coder.decodeUpdate(B,a,o),p===this.numSyms-1&&(this.tree[1]&h)>>>u===1)for(s=-this.tree[b];b>=1;)this.tree[b]+=s,b=b>>>1;return(this.tree[1]&n)>>>v>=this.max_prob&&this._rescale(),p},t.prototype.decode=function(){var r=this._decode(!1);return r===this.numSyms-1&&(r=this._decode(!0)),r},t.prototype._rescale=function(){var r,e,i=!0;for(r=0;r<this.numSyms-1;r++){if(e=this.tree[this.numSyms+r],(e&h)!==0){i=!1;continue}e=(e&l)>>>1,e===0&&(e=1<<u,i=!1),this.tree[this.numSyms+r]=e}e=this.tree[this.numSyms+r],e=(e&l)>>>1,i?e=0:e===0&&(e=1<<v),this.tree[this.numSyms+r]=e,this._sumTree()},t.prototype._sumTree=function(){var r;for(r=this.numSyms-1;r>0;r--)this.tree[r]=this.tree[2*r]+this.tree[2*r+1]},t.MAGIC="fenw",t.compressFile=d.compressFileHelper(t.MAGIC,function(r,e,i,s,o){var f=new U(e);f.encodeStart(o,1);var b=new t(f,i<0?257:256);d.compressWithModel(r,i,b),f.encodeFinish()},!0),t.decompressFile=d.decompressFileHelper(t.MAGIC,function(r,e,i){var s=new U(r);s.decodeStart(!0);var o=new t(s,i<0?257:256);d.decompressWithModel(e,i,o),s.decodeFinish()}),_e=t,_e}var Ce,rt;function xt(){if(rt)return Ce;rt=1;const U=ie();ee();const d=Y();var c=65280,m=256,h=function(n,v){return n-v},u=function(n,v,l,t,r){this.coder=n,this.increment=+t||m,this.max_prob=+l||c,console.assert(this.max_prob+(this.increment-1)<=65535),this.sym=d.makeU16Buffer(v+1),this.prob=d.makeU16Buffer(v+2),this.sym[0]=v,this.prob[0]=0,this.seenSyms=1,this.prob[this.seenSyms]=this.increment,this.numSyms=v,r&&(this.sortedSeen=[v])};return u.factory=function(n,v,l,t){return function(r){return new u(n,r,v,l,t)}},u.prototype.clone=function(){var n=new u(this.coder,this.numSyms,this.max_prob,this.increment,!!this.sortedSeen),v;for(v=0;v<this.seenSyms;v++)n.sym[v]=this.sym[v],n.prob[v]=this.prob[v];return n.prob[v]=this.prob[v],n.seenSyms=this.seenSyms,this.sortedSeen&&(n.sortedSeen=this.sortedSeen.slice(0)),n},u.prototype._update=function(n,v,l){var t,r;for(t=v;t<this.seenSyms-1;t++)this.sym[t]=this.sym[t+1],this.prob[t]=this.prob[t+1]-l;v<this.seenSyms?(this.sym[t]=n,this.prob[t]=this.prob[t+1]-l,this.prob[this.seenSyms]=r=this.prob[this.seenSyms]+this.increment,n===this.numSyms&&this.seenSyms>=this.numSyms&&(r=this.prob[--this.seenSyms],this.sortedSeen&&this.sortedSeen.length--)):(r=this.prob[this.seenSyms],this.sym[v]=n,this.prob[v]=r,r+=this.increment,this.prob[++this.seenSyms]=r,this.sortedSeen&&(this.sortedSeen.push(n),this.sortedSeen.sort(h))),r>=this.max_prob&&this._rescale()},u.prototype._rescale=function(){var n,v,l=0,t=!0;for(this.sortedSeen&&(this.sortedSeen.length=0),n=0,v=0;n<this.seenSyms;n++){var r=this.sym[n],e=this.prob[n+1]-this.prob[n];e>>>=1,e>0&&(r===this.numSyms&&(t=!1),this.sym[v]=r,this.prob[v++]=l,l+=e,this.sortedSeen&&this.sortedSeen.push(r))}this.prob[v]=l,this.seenSyms=v,this.sortedSeen&&this.sortedSeen.sort(h),t&&this.seenSyms<this.numSyms&&this._update(this.numSyms,this.seenSyms)},u.prototype.decode=function(){var n=this.prob[this.seenSyms],v=this.coder.decodeCulFreq(n),l;for(l=this.seenSyms-1;l>=0&&!(this.prob[l]<=v);l--);console.assert(l>=0);var t=this.sym[l],r=this.prob[l],e=this.prob[l+1]-r;if(this.coder.decodeUpdate(e,r,n),this._update(t,l,e),t===this.numSyms){if(e=1,n=this.numSyms,this.sortedSeen){var i=this.sortedSeen;for(n=this.numSyms-this.seenSyms,i[i.length-1]===this.numSyms&&n++,t=r=this.coder.decodeCulFreq(n),l=0;l<i.length&&i[l]<=t;l++)t++}else t=r=this.coder.decodeCulFreq(n);this.coder.decodeUpdate(e,r,n),this._update(t,this.seenSyms)}return t},u.prototype.encode=function(n){var v,l,t,r;for(v=this.seenSyms-1;v>=0;v--)if(n===this.sym[v])return t=this.prob[v],l=this.prob[v+1]-t,r=this.prob[this.seenSyms],this.coder.encodeFreq(l,t,r),this._update(n,v,l);if(console.assert(n!==this.numSyms),this.encode(this.numSyms),l=1,t=n,r=this.numSyms,this.sortedSeen){var e=this.sortedSeen;for(r-=this.seenSyms,e[e.length-1]===this.numSyms&&r++,v=0;v<e.length&&e[v]<n;v++)t--}return this.coder.encodeFreq(l,t,r),this._update(n,this.seenSyms)},u.MAGIC="mtfm",u.compressFile=d.compressFileHelper(u.MAGIC,function(n,v,l,t,r){var e=new U(v);e.encodeStart(r,1);var i=new u(e,l<0?257:256);d.compressWithModel(n,l,i),e.encodeFinish()},!0),u.decompressFile=d.decompressFileHelper(u.MAGIC,function(n,v,l){var t=new U(n);t.decodeStart(!0);var r=new u(t,l<0?257:256);d.decompressWithModel(v,l,r),t.decodeFinish()}),Ce=u,Ce}var Me,it;function ve(){if(it)return Me;it=1;const U=de(),d=Y();var c=function(m,h){this.bitstream=m,this.bits=d.fls(h-1)};return c.factory=function(m){return function(h){return new c(m,h)}},c.prototype.encode=function(m){var h;for(h=this.bits-1;h>=0;h--){var u=m>>>h&1;this.bitstream.writeBit(u)}},c.prototype.decode=function(){var m,h=0;for(m=this.bits-1;m>=0;m--)h<<=1,this.bitstream.readBit()&&h++;return h},c.MAGIC="nomo",c.compressFile=d.compressFileHelper(c.MAGIC,function(m,h,u,n){var v=new U(h),l=new c(v,u<0?257:256);d.compressWithModel(m,u,l),v.flush()}),c.decompressFile=d.decompressFileHelper(c.MAGIC,function(m,h,u){var n=new U(m),v=new c(n,u<0?257:256);d.decompressWithModel(h,u,v)}),Me=c,Me}var Ee,st;function je(){if(st)return Ee;st=1;const U=Y();var d=function(c,m,h,u){var n,v=U.fls(c-1);for(this.extraStates=+m||0,this.lgDistanceModel=h(1+v+m),this.distanceModel=[],n=2;n<=v;n++){var l=n-1;this.distanceModel[n]=u(1<<l)}};return d.prototype.encode=function(c){if(c<2){this.lgDistanceModel.encode(c+this.extraStates);return}var m=U.fls(c);console.assert(c&1<<m-1),console.assert(m>=2),this.lgDistanceModel.encode(m+this.extraStates);var h=c&(1<<m-1)-1;this.distanceModel[m].encode(h)},d.prototype.decode=function(){var c=this.lgDistanceModel.decode()-this.extraStates;if(c<2)return c;var m=this.distanceModel[c].decode();return(1<<c-1)+m},Ee=d,Ee}var Se,ot;function Tt(){if(ot)return Se;ot=1,he();const U=ee(),d=Le(),c=ze(),m=pe(),h=je(),u=ve(),n=ie(),v=Y();U.EOF;var l=65280,t=256;return BWTC=Object.create(null),BWTC.MAGIC="bwtc",BWTC.compressFile=v.compressFileHelper(BWTC.MAGIC,function(r,e,i,s,o){var f=new n(e);f.encodeStart(o,1);var b=9;typeof s=="number"&&s>=1&&s<=9&&(b=s),f.encodeByte(b);var a=b<=5;b*=1e5;var w=v.makeU8Buffer(b),p=function(){var q;for(q=0;q<b;){var H=r.readByte();if(H<0)break;w[q++]=H}return q},B=v.makeU8Buffer(b),E=v.makeS32Buffer(b),R=v.makeU8Buffer(256),S=u.factory(f),A=new h(b,0,S,S),k,N,y,_,x,F;do{if(k=p(),k===0)break;k===w.length?(f.encodeFreq(1,0,3),N=w):(f.encodeFreq(1,1,3),A.encode(k),N=w.subarray(0,k)),_=d.bwtransform(N,B,E,k,256),A.encode(_);var g=v.makeU16Buffer(512);for(x=0;x<k;x++)y=B[x],g[256+y]=1;for(x=255;x>0;x--)g[x]=g[2*x]+g[2*x+1];for(g[0]=1,x=1;x<512;x++){var C=x>>>1,M=1<<9-v.fls(x);if(!(g[C]===0||g[C]===M*2))if(x>=256)f.encodeBit(g[x]);else{var I=g[x];I=I===0?0:I===M?2:1,f.encodeFreq(1,I,3)}}var O=0;for(x=0;x<256;x++)g[256+x]&&(R[O++]=x);for(g=null,x=0;x<k;x++){for(y=B[x],F=0;F<O&&R[F]!==y;F++);for(console.assert(F<O),B[x]=F;F>0;F--)R[F]=R[F-1];R[0]=y}var L=new m(f,O+1,l,t);a&&(L=new c(f,O+1));var P=0,G=function(){for(;P!==0;)P&1?(L.encode(0),P-=1):(L.encode(1),P-=2),P>>>=1};for(x=0;x<k;x++)y=B[x],y===0?P++:(G(),L.encode(y+1),P=0);G()}while(k===w.length);f.encodeFreq(1,2,3),f.encodeFinish()},!0),BWTC.decompressFile=v.decompressFileHelper(BWTC.MAGIC,function(r,e,i){var s=new n(r);s.decodeStart(!0);var o=s.decodeByte();console.assert(o>=1&&o<=9);var f=o<=5;o*=1e5;for(var b=v.makeU8Buffer(o),a=v.makeU8Buffer(o),w=v.makeS32Buffer(o),p=v.makeU8Buffer(256),B=u.factory(s),E=new h(o,0,B,B),R,S,A,k,N;;){var y=s.decodeCulFreq(3);if(s.decodeUpdate(1,y,3),y===0)S=o,R=b;else if(y===1)S=E.decode(),R=b.subarray(0,S);else if(y===2)break;var _=E.decode(),x=v.makeU16Buffer(512);for(x[0]=1,A=1;A<512;A++){var F=A>>>1,g=1<<9-v.fls(A);if(x[F]===0||x[F]===g*2)x[A]=x[F]>>>1;else if(A>=256)x[A]=s.decodeBit();else{var C=s.decodeCulFreq(3);s.decodeUpdate(1,C,3),x[A]=C===2?g:C}}var M=0;for(A=0;A<256;A++)x[256+A]&&(p[M++]=A);x=null;var I=new m(s,M+1,l,t);f&&(I=new c(s,M+1,!0));var O=1;for(A=0;A<S;)if(N=I.decode(),N===0){for(k=0;k<O;k++)R[A++]=0;O*=2}else if(N===1){for(k=0;k<O;k++)R[A++]=0,R[A++]=0;O*=2}else O=1,R[A++]=N-1;for(A=0;A<S;A++){for(k=R[A],R[A]=N=p[k];k>0;k--)p[k]=p[k-1];p[0]=N}d.unbwtransform(b,a,w,S,_),e.write(a,0,S)}s.decodeFinish()}),Se=BWTC,Se}var Re,nt;function Pt(){if(nt)return Re;nt=1;const U=Y();var d=U.arraycopy(U.makeU32Buffer(256),[0,79764919,159529838,222504665,319059676,398814059,445009330,507990021,638119352,583659535,797628118,726387553,890018660,835552979,1015980042,944750013,1276238704,1221641927,1167319070,1095957929,1595256236,1540665371,1452775106,1381403509,1780037320,1859660671,1671105958,1733955601,2031960084,2111593891,1889500026,1952343757,2552477408,2632100695,2443283854,2506133561,2334638140,2414271883,2191915858,2254759653,3190512472,3135915759,3081330742,3009969537,2905550212,2850959411,2762807018,2691435357,3560074640,3505614887,3719321342,3648080713,3342211916,3287746299,3467911202,3396681109,4063920168,4143685023,4223187782,4286162673,3779000052,3858754371,3904687514,3967668269,881225847,809987520,1023691545,969234094,662832811,591600412,771767749,717299826,311336399,374308984,453813921,533576470,25881363,88864420,134795389,214552010,2023205639,2086057648,1897238633,1976864222,1804852699,1867694188,1645340341,1724971778,1587496639,1516133128,1461550545,1406951526,1302016099,1230646740,1142491917,1087903418,2896545431,2825181984,2770861561,2716262478,3215044683,3143675388,3055782693,3001194130,2326604591,2389456536,2200899649,2280525302,2578013683,2640855108,2418763421,2498394922,3769900519,3832873040,3912640137,3992402750,4088425275,4151408268,4197601365,4277358050,3334271071,3263032808,3476998961,3422541446,3585640067,3514407732,3694837229,3640369242,1762451694,1842216281,1619975040,1682949687,2047383090,2127137669,1938468188,2001449195,1325665622,1271206113,1183200824,1111960463,1543535498,1489069629,1434599652,1363369299,622672798,568075817,748617968,677256519,907627842,853037301,1067152940,995781531,51762726,131386257,177728840,240578815,269590778,349224269,429104020,491947555,4046411278,4126034873,4172115296,4234965207,3794477266,3874110821,3953728444,4016571915,3609705398,3555108353,3735388376,3664026991,3290680682,3236090077,3449943556,3378572211,3174993278,3120533705,3032266256,2961025959,2923101090,2868635157,2813903052,2742672763,2604032198,2683796849,2461293480,2524268063,2284983834,2364738477,2175806836,2238787779,1569362073,1498123566,1409854455,1355396672,1317987909,1246755826,1192025387,1137557660,2072149281,2135122070,1912620623,1992383480,1753615357,1816598090,1627664531,1707420964,295390185,358241886,404320391,483945776,43990325,106832002,186451547,266083308,932423249,861060070,1041341759,986742920,613929101,542559546,756411363,701822548,3316196985,3244833742,3425377559,3370778784,3601682597,3530312978,3744426955,3689838204,3819031489,3881883254,3928223919,4007849240,4037393693,4100235434,4180117107,4259748804,2310601993,2373574846,2151335527,2231098320,2596047829,2659030626,2470359227,2550115596,2947551409,2876312838,2788305887,2733848168,3165939309,3094707162,3040238851,2985771188]),c=function(){var m=4294967295;this.getCRC=function(){return~m>>>0},this.updateCRC=function(h){m=m<<8^d[(m>>>24^h)&255]},this.updateCRCRun=function(h,u){for(;u-- >0;)m=m<<8^d[(m>>>24^h)&255]}};return Re=c,Re}var Ue,at;function Dt(){if(at)return Ue;at=1;const U=he(),d=Y();var c=function(l,t,r){for(var e=l.length,i=t,s=l.length-2;t>=r&&l[t]%e>i;)s=t,t-=i-t+1;for(t=Math.max(r-1,t);s>t+1;){var o=t+s>>1;l[o]%e>i?s=o:t=o}return s},m=function(l){var t=l.length;l[0]+=l[1];var r,e,i,s;for(r=0,e=1,i=2;e<t-1;e++)i>=t||l[r]<l[i]?(s=l[r],l[r++]=e):s=l[i++],i>=t||r<e&&l[r]<l[i]?(s+=l[r],l[r++]=e+t):s+=l[i++],l[e]=s},h=function(l,t){var r=l.length-2,e;for(e=1;e<t-1&&r>1;e++)r=c(l,r-1,0);return r},u=function(l){var t=l.length-2,r=l.length-1,e,i,s,o;for(e=1,i=2;i>0;e++){for(s=t,t=c(l,s-1,0),o=i-(s-t);o>0;o--)l[r--]=e;i=s-t<<1}},n=function(l,t,r){var e=l.length-2,i=l.length-1,s=r==1?2:1,o=r==1?t-2:t,f,b,a,w;for(f=s<<1;f>0;s++){for(b=e,e=e<=t?e:c(l,b-1,t),a=0,s>=r?a=Math.min(o,1<<s-r):s==r-1&&(a=1,l[e]==b&&e++),w=f-(b-e+a);w>0;w--)l[i--]=s;o-=a,f=b-e+a<<1}},v=function(l,t){switch(l.length){case 2:l[1]=1;case 1:l[0]=1;return}m(l);var r=h(l,t);if(l[0]%l.length>=r)u(l);else{var e=t-d.fls(r-1);n(l,r,e)}};return Ue=U({allocateHuffmanCodeLengths:v}),Ue}var ke,ft;function Lt(){if(ft)return ke;ft=1,he();const U=de(),d=Le(),c=Pt(),m=Dt(),h=ee(),u=Y();var n=20,v=258,l=0,t=1,r=2,e=6,i=50,s=54156738319193,o=25779555029136,f=h.EOF,b=function(y,_){var x=y[_],F;for(F=_;F>0;F--)y[F]=y[F-1];return y[0]=x,x},a={OK:0,LAST_BLOCK:-1,NOT_BZIP_DATA:-2,UNEXPECTED_INPUT_EOF:-3,UNEXPECTED_OUTPUT_EOF:-4,DATA_ERROR:-5,OUT_OF_MEMORY:-6,OBSOLETE_INPUT:-7,END_OF_BLOCK:-8},w={};w[a.LAST_BLOCK]="Bad file checksum",w[a.NOT_BZIP_DATA]="Not bzip data",w[a.UNEXPECTED_INPUT_EOF]="Unexpected input EOF",w[a.UNEXPECTED_OUTPUT_EOF]="Unexpected output EOF",w[a.DATA_ERROR]="Data error",w[a.OUT_OF_MEMORY]="Out of memory",w[a.OBSOLETE_INPUT]="Obsolete (pre 0.9.5) bzip format not supported.";var p=function(y,_){var x=w[y]||"unknown error";_&&(x+=": "+_);var F=new TypeError(x);throw F.errorCode=y,F},B=function(y,_){this.writePos=this.writeCurrent=this.writeCount=0,this._start_bunzip(y,_)};B.prototype._init_block=function(){var y=this._get_next_block();return y?(this.blockCRC=new c,!0):(this.writeCount=-1,!1)},B.prototype._start_bunzip=function(y,_){var x=u.makeU8Buffer(4);(y.read(x,0,4)!==4||String.fromCharCode(x[0],x[1],x[2])!=="BZh")&&p(a.NOT_BZIP_DATA,"bad magic");var F=x[3]-48;(F<1||F>9)&&p(a.NOT_BZIP_DATA,"level out of range"),this.reader=new U(y),this.dbufSize=1e5*F,this.nextoutput=0,this.outputStream=_,this.streamCRC=0},B.prototype._get_next_block=function(){var y,_,x,F=this.reader,g=F.readBits(48);if(g===o)return!1;g!==s&&p(a.NOT_BZIP_DATA),this.targetBlockCRC=F.readBits(32),this.streamCRC=(this.targetBlockCRC^(this.streamCRC<<1|this.streamCRC>>>31))>>>0,F.readBits(1)&&p(a.OBSOLETE_INPUT);var C=F.readBits(24);C>this.dbufSize&&p(a.DATA_ERROR,"initial position out of bounds");var M=F.readBits(16),I=u.makeU8Buffer(256),O=0;for(y=0;y<16;y++)if(M&1<<15-y){var L=y*16;for(x=F.readBits(16),_=0;_<16;_++)x&1<<15-_&&(I[O++]=L+_)}var P=F.readBits(3);(P<r||P>e)&&p(a.DATA_ERROR);var G=F.readBits(15);G===0&&p(a.DATA_ERROR);var q=u.makeU8Buffer(256);for(y=0;y<P;y++)q[y]=y;var H=u.makeU8Buffer(G);for(y=0;y<G;y++){for(_=0;F.readBits(1);_++)_>=P&&p(a.DATA_ERROR);H[y]=b(q,_)}var j=O+2,W=[],D;for(_=0;_<P;_++){var T=u.makeU8Buffer(j),J=u.makeU16Buffer(n+1);for(M=F.readBits(5),y=0;y<j;y++){for(;(M<1||M>n)&&p(a.DATA_ERROR),!!F.readBits(1);)F.readBits(1)?M--:M++;T[y]=M}var K,z;for(K=z=T[0],y=1;y<j;y++)T[y]>z?z=T[y]:T[y]<K&&(K=T[y]);D={},W.push(D),D.permute=u.makeU16Buffer(v),D.limit=u.makeU32Buffer(n+2),D.base=u.makeU32Buffer(n+1),D.minLen=K,D.maxLen=z;var $=0;for(y=K;y<=z;y++)for(J[y]=D.limit[y]=0,M=0;M<j;M++)T[M]===y&&(D.permute[$++]=M);for(y=0;y<j;y++)J[T[y]]++;for($=M=0,y=K;y<z;y++)$+=J[y],D.limit[y]=$-1,$<<=1,M+=J[y],D.base[y+1]=$-M;D.limit[z+1]=Number.MAX_VALUE,D.limit[z]=$+J[z]-1,D.base[K]=0}var X=u.makeU32Buffer(256);for(y=0;y<256;y++)q[y]=y;var te=0,Q=0,se=0,Z,oe=this.dbuf=u.makeU32Buffer(this.dbufSize);for(j=0;;){for(j--||(j=i-1,se>=G&&p(a.DATA_ERROR),D=W[H[se++]]),y=D.minLen,_=F.readBits(y);y>D.maxLen&&p(a.DATA_ERROR),!(_<=D.limit[y]);y++)_=_<<1|F.readBits(1);_-=D.base[y],(_<0||_>=v)&&p(a.DATA_ERROR);var ne=D.permute[_];if(ne===l||ne===t){te||(te=1,M=0),ne===l?M+=te:M+=2*te,te<<=1;continue}if(te)for(te=0,Q+M>this.dbufSize&&p(a.DATA_ERROR),Z=I[q[0]],X[Z]+=M;M--;)oe[Q++]=Z;if(ne>O)break;Q>=this.dbufSize&&p(a.DATA_ERROR),y=ne-1,Z=b(q,y),Z=I[Z],X[Z]++,oe[Q++]=Z}for((C<0||C>=Q)&&p(a.DATA_ERROR),_=0,y=0;y<256;y++)x=_+X[y],X[y]=_,_=x;for(y=0;y<Q;y++)Z=oe[y]&255,oe[X[Z]]|=y<<8,X[Z]++;var ce=0,re=0,Ge=0;return Q&&(ce=oe[C],re=ce&255,ce>>=8,Ge=-1),this.writePos=ce,this.writeCurrent=re,this.writeCount=Q,this.writeRun=Ge,!0},B.prototype._read_bunzip=function(y,_){var x,F,g;if(this.writeCount<0)return 0;var C=this.dbuf,M=this.writePos,I=this.writeCurrent,O=this.writeCount;this.outputsize;for(var L=this.writeRun;O;){for(O--,F=I,M=C[M],I=M&255,M>>=8,L++===3?(x=I,g=F,I=-1):(x=1,g=I),this.blockCRC.updateCRCRun(g,x);x--;)this.outputStream.writeByte(g),this.nextoutput++;I!=F&&(L=0)}return this.writeCount=O,this.blockCRC.getCRC()!==this.targetBlockCRC&&p(a.DATA_ERROR,"Bad block CRC (got "+this.blockCRC.getCRC().toString(16)+" expected "+this.targetBlockCRC.toString(16)+")"),this.nextoutput},B.Err=a,B.decode=function(y,_,x){for(var F=u.coerceInputStream(y),g=u.coerceOutputStream(_,_),C=g.stream,M=new B(F,C);!("eof"in F&&F.eof());)if(M._init_block())M._read_bunzip();else{var I=M.reader.readBits(32);if(I!==M.streamCRC&&p(a.DATA_ERROR,"Bad stream CRC (got "+M.streamCRC.toString(16)+" expected "+I.toString(16)+")"),x&&"eof"in F&&!F.eof())M._start_bunzip(F,C);else break}return g.retval},B.decodeBlock=function(y,_,x){var F=u.coerceInputStream(y),g=u.coerceOutputStream(x,x),C=g.stream,M=new B(F,C);M.reader.seekBit(_);var I=M._get_next_block();return I&&(M.blockCRC=new c,M.writeCopies=0,M._read_bunzip()),g.retval},B.table=function(y,_,x){var F=new h;F.delegate=u.coerceInputStream(y),F.pos=0,F.readByte=function(){return this.pos++,this.delegate.readByte()},F.tell=function(){return this.pos},F.delegate.eof&&(F.eof=F.delegate.eof.bind(F.delegate));var g=new h;g.pos=0,g.writeByte=function(){this.pos++};for(var C=new B(F,g),M=C.dbufSize;!("eof"in F&&F.eof());){var I=C.reader.tellBit();if(C._init_block()){var O=g.pos;C._read_bunzip(),_(I,g.pos-O)}else if(C.reader.readBits(32),x&&"eof"in F&&!F.eof())C._start_bunzip(F,g),console.assert(C.dbufSize===M,"shouldn't change block size within multistream file");else break}};var E=function(y,_){var x,F=[];for(x=0;x<_;x++)F[x]=y[x]<<9|x;F.sort(function(M,I){return M-I});var g=F.map(function(M){return M>>>9});for(m.allocateHuffmanCodeLengths(g,n),this.codeLengths=u.makeU8Buffer(_),x=0;x<_;x++){var C=F[x]&511;this.codeLengths[C]=g[x]}};E.prototype.computeCanonical=function(){var y=this.codeLengths.length,_,x=[];for(_=0;_<y;_++)x[_]=this.codeLengths[_]<<9|_;x.sort(function(I,O){return I-O}),this.code=u.makeU32Buffer(y);var F=0,g=0;for(_=0;_<y;_++){var C=x[_]>>>9,M=x[_]&511;console.assert(g<=C),F<<=C-g,this.code[M]=F++,g=C}},E.prototype.cost=function(y,_,x){var F,g=0;for(F=0;F<x;F++)g+=this.codeLengths[y[_+F]];return g},E.prototype.emit=function(y){var _,x=this.codeLengths[0];for(y.writeBits(5,x),_=0;_<this.codeLengths.length;_++){var F=this.codeLengths[_],g,C;for(console.assert(F>0&&F<=n),x<F?(g=2,C=F-x):(g=3,C=x-F);C-- >0;)y.writeBits(2,g);y.writeBit(0),x=F}},E.prototype.encode=function(y,_){y.writeBits(this.codeLengths[_],this.code[_])};var R=function(y,_,x,F){for(var g=0,C=-1,M=0;g<x&&!(M===4&&(_[g++]=0,g>=x));){var I=y.readByte();if(I===f)break;if(F.updateCRC(I),I!==C)C=I,M=1;else if(M++,M>4)if(M<256){_[g-1]++;continue}else M=1;_[g++]=I}return g},S=function(y,_,x){var F,g,C;for(F=0,C=0;F<x.length;F+=i){var M=Math.min(i,x.length-F),I=0,O=_[0].cost(x,F,M);for(g=1;g<_.length;g++){var L=_[g].cost(x,F,M);L<O&&(I=g,O=L)}y[C++]=I}},A=function(y,_,x,F,g){for(var C,M,I,O=[];y.length<_;){for(S(F,y,x),C=0;C<y.length;C++)O[C]=0;for(C=0;C<F.length;C++)O[F[C]]++;var L=O.indexOf(Math.max.apply(Math,O)),P=[];for(C=0,M=0;C<F.length;C++)if(F[C]===L){var G=C*i,q=Math.min(G+i,x.length);P.push({index:C,cost:y[L].cost(x,G,q-G)})}for(P.sort(function(W,D){return W.cost-D.cost}),C=P.length>>>1;C<P.length;C++)F[P[C].index]=y.length;y.push(null);var H=[],j;for(C=0;C<y.length;C++)for(j=H[C]=[],M=0;M<g;M++)j[M]=0;for(C=0,M=0;C<x.length;)for(j=H[F[M++]],I=0;I<i&&C<x.length;I++)j[x[C++]]++;for(C=0;C<y.length;C++)y[C]=new E(H[C],g)}},k=function(y,_,x){var F,g,C,M,I=u.makeU8Buffer(_),O=d.bwtransform2(y,I,_,256);x.writeBit(0),x.writeBits(24,O);var L=[],P=[];for(g=0;g<_;g++)F=y[g],L[F]=!0,P[F>>>4]=!0;for(g=0;g<16;g++)x.writeBit(!!P[g]);for(g=0;g<16;g++)if(P[g])for(C=0;C<16;C++)x.writeBit(!!L[g<<4|C]);var G=0;for(g=0;g<256;g++)L[g]&&G++;var q=u.makeU16Buffer(_+1),H=G+1,j=[];for(g=0;g<=H;g++)j[g]=0;var W=u.makeU8Buffer(G);for(g=0,C=0;g<256;g++)L[g]&&(W[C++]=g);L=null,P=null;var D=0,T=0,J=function(se){q[D++]=se,j[se]++},K=function(){for(;T!==0;)T&1?(J(0),T-=1):(J(1),T-=2),T>>>=1};for(g=0;g<I.length;g++){for(F=I[g],C=0;C<G&&W[C]!==F;C++);console.assert(C!==G),b(W,C),C===0?T++:(K(),J(C+1),T=0)}K(),J(H),q=q.subarray(0,D);var z=[],$;for(D>=2400?$=6:D>=1200?$=5:D>=600?$=4:D>=200?$=3:$=2,z.push(new E(j,H+1)),g=0;g<=H;g++)j[g]=1;z.push(new E(j,H+1)),j=null;var X=u.makeU8Buffer(Math.ceil(D/i));for(A(z,$,q,X,H+1),S(X,z,q),console.assert(z.length>=r&&z.length<=e),x.writeBits(3,z.length),x.writeBits(15,X.length),g=0;g<z.length;g++)W[g]=g;for(g=0;g<X.length;g++){var te=X[g];for(C=0;C<z.length&&W[C]!==te;C++);for(console.assert(C<z.length),b(W,C);C>0;C--)x.writeBit(1);x.writeBit(0)}for(g=0;g<z.length;g++)z[g].emit(x),z[g].computeCanonical();for(g=0,M=0;g<D;){var Q=z[X[M++]];for(C=0;C<i&&g<D;C++)Q.encode(x,q[g++])}},N=Object.create(null);return N.compressFile=function(y,_,x){y=u.coerceInputStream(y);var F=u.coerceOutputStream(_,_);_=new U(F.stream);var g=9;if(typeof x=="number"&&(g=x),g<1||g>9)throw new Error("Invalid block size multiplier");var C=g*1e5;C-=19,_.writeByte(66),_.writeByte(90),_.writeByte(104),_.writeByte(48+g);var M=u.makeU8Buffer(C),I=0,O;do{var L=new c;O=R(y,M,C,L),O>0&&(I=((I<<1|I>>>31)^L.getCRC())>>>0,_.writeBits(48,s),_.writeBits(32,L.getCRC()),k(M,O,_))}while(O===C);return _.writeBits(48,o),_.writeBits(32,I),_.flush(),F.retval},N.decompressFile=B.decode,N.decompressBlock=B.decodeBlock,N.table=B.table,ke=N,ke}var Ae,ht;function qt(){if(ht)return Ae;ht=1;const U=xt(),d=ie(),c=ee(),m=Y();var h=65535,u=8,n=128,v=65280,l=256,t=Object.create(null);t.MAGIC="dmc!";var r=function(i,s,o){this.out=[],this.model=o?o.clone():new U(i,s,v,l),this.count=m.makeU16Buffer(s),this.sum=0};r.prototype.clone=function(i,s){var o,f=new r(i,s,null);for(o=0;o<s;o++)f.out[o]=this.out[o];return f};var e=function(i,s,o,f){var b,a;for(this.coder=i,this.size=s,this.MIN_CNT1=o||u,this.MIN_CNT2=f||n,this.nodes=[],b=0;b<s;b++)this.nodes[b]=new r(i,s);for(b=0;b<s;b++)for(a=0;a<s;a++)this.nodes[b].out[a]=this.nodes[a];this.current=this.nodes[0]};return e.prototype.maybeSplit=function(i,s,o){var f=i.count[s],b=o.sum,a;if(f<=this.MIN_CNT1||b-f<=this.MIN_CNT2)return o;var w=o.clone(this.coder,this.size);for(this.nodes.push(w),i.out[s]=w,w.sum=o.sum=0,a=0;a<this.size;a++)w.count[a]=o.count[a]*f/b,w.sum+=w.count[a],o.count[a]-=w.count[a],o.sum+=o.count[a];return w},e.prototype.encode=function(i){var s=this.current;s.model.encode(i);var o=s.out[i];s.count[i]!==h&&(s.count[i]++,s.sum++),this.current=this.maybeSplit(s,i,o)},e.prototype.decode=function(){var i=this.current,s=i.model.decode(),o=i.out[s];return i.count[s]!==h&&(i.count[s]++,i.sum++),this.current=this.maybeSplit(i,s,o),s},t.compressFile=m.compressFileHelper(t.MAGIC,function(i,s,o,f){f=f||{};var b=+f.m||u,a=+f.n||n;m.writeUnsignedNumber(s,b),m.writeUnsignedNumber(s,a);var w=new d(s);w.encodeStart(202,0);for(var p=new e(w,o<0?257:256,b,a),B=0;B!==o;){var E=i.readByte();if(E===c.EOF){p.encode(256);break}p.encode(E),B++}w.encodeFinish()}),t.decompressFile=m.decompressFileHelper(t.MAGIC,function(i,s,o){var f=m.readUnsignedNumber(i),b=m.readUnsignedNumber(i),a=new d(i);a.decodeStart();for(var w=new e(a,o<0?257:256,f,b),p=0;p!==o;){var B=w.decode();if(B===256)break;s.writeByte(B),p++}a.decodeFinish()}),Ae=t,Ae}var Ie,ct;function Ht(){if(ct)return Ie;ct=1;const U=ee(),d=Y();var c=Object.create(null);c.MAGIC="lzjb";var m=8,h=6,u=3,n=(1<<h)+(u-1),v=(1<<16-h)-1,l=1024,t=U.EOF;return c.compressFile=d.compressFileHelper(c.MAGIC,function(r,e,i,s){var o,f,b,a,w,p,B,E=l,R=1;typeof s=="number"&&(E*=2,s=Math.max(1,Math.min(9,s))-1,R=1<<Math.floor(s/2),s&1&&(R=Math.round(R*1.5)),s>=2&&s<=4&&R++),p=d.makeU16Buffer(E*R);for(var S=d.makeU8Buffer(v+1),A=0,k=function(T){return S[A++]=T,A>=S.length&&(A=0),T},N=d.makeU8Buffer(17),y=0,_=function(){var T;for(T=0;T<y;T++)e.writeByte(N[T]);y=0},x=[],F=function(){return x.length?x.pop():r.readByte()},g=function(T){x.push(T)},C=1<<m-1,M=[];;){var I=F();if(I===t)break;(C<<=1)==1<<m&&(_(),C=1,N[0]=0,y=1);var O=F();if(O===t){N[y++]=k(I);break}var L=F();if(L===t){N[y++]=k(I),g(O);continue}for(a=(I<<16)+(O<<8)+L,a^=a>>9,a+=a>>5,a^=I,w=(a&E-1)*R,M.length=0,B=0;B<R;B++){b=A-p[w+B]&v,o=S.length+A-b;var P=S[o&v],G=S[o+1&v],q=S[o+2&v];b===0?P=I^1:b==1?(G=I,q=O):b==2&&(q=I),I===P&&O===G&&L===q&&M.push(b)}for(B=R-1;B>0;B--)p[w+B]=p[w+B-1];if(p[w]=A,M.length===0)N[y++]=k(I),g(L),g(O);else{N[0]|=C,k(I),k(O),k(L);var H=F(),j=M[0],W=S.length+A;for(f=u;f<n&&H!==t;f++,W++){for(B=0;B<M.length;){var D=S[W-M[B]&v];H!==D?(j=M[B],M.splice(B,1)):B++}if(M.length===0)break;k(H),H=F()}M.length!==0&&(j=M[0]),g(H),N[y++]=f-u<<m-h|j>>m,N[y++]=j&255}}_()}),c.decompressFile=d.decompressFileHelper(c.MAGIC,function(r,e,i){for(var s,o,f,b,a,w=d.makeU8Buffer(v+1),p=0,B=1<<m-1;i!==0&&(a=r.readByte(),a!==t);)if((B<<=1)==1<<m&&(B=1,o=a,a=r.readByte()),o&B)for(f=(a>>m-h)+u,b=(a<<m|r.readByte())&v,s=p-b,s<0&&(s+=w.length),i>=0&&(i-=f);--f>=0;)a=w[p++]=w[s++],e.writeByte(a),p>=w.length&&(p=0),s>=w.length&&(s=0);else e.writeByte(a),w[p++]=a,p>=w.length&&(p=0),i>=0&&i--}),Ie=c,Ie}var Oe,dt;function zt(){if(dt)return Oe;dt=1;const U=He(),d=pe(),c=je(),m=ve(),h=ie(),u=ee(),n=Y();var v=Object.create(null);v.MAGIC="lzjR";var l=6,t=3,r=(1<<l)+(t-1),e=(1<<16-l)-1,i=1024,s=32;return v.compressFile=n.compressFileHelper(v.MAGIC,function(o,f,b,a,w){var p,B,E,R,S,A,k,N=i,y=1;typeof a=="number"&&(N*=2,a=Math.max(1,Math.min(9,a))-1,y=1<<Math.floor(a/2),a&1&&(y=Math.round(y*1.5)),a>=2&&a<=4&&y++);var _=new h(f);_.encodeStart(w,1),A=n.makeU16Buffer(N*y);for(var x=n.makeU8Buffer(e+1),F=0,g=function(re){return x[F++]=re,F>=x.length&&(F=0),re},C=[],M=function(){return C.length?C.pop():o.readByte()},I=function(re){C.push(re)},O=[],L=256,P=257,G=m.factory(_),q=d.factory(_,65280,256),H=new U(q,256,(b<0?P:L)+1),j=function(re){return re<=s?q(re):G(re)},W=new c(r-t+1,0,q,j),D=new c(e+1,1,q,j),T=32,J=0;;){var K=F,z=M();if(z===u.EOF)break;var $=M();if($===u.EOF){H.encode(g(z),T);break}var X=M();if(X===u.EOF){H.encode(g(z),T),I($),T=z;continue}for(R=(z<<16)+($<<8)+X,R^=R>>9,R+=R>>5,R^=z,S=(R&N-1)*y,O.length=0,k=0;k<y;k++){E=F-A[S+k]&e,p=x.length+F-E;var te=x[p&e],Q=x[p+1&e],se=x[p+2&e];E==1?(Q=z,se=$):E==2&&(se=z),z===te&&$===Q&&X===se&&O.push(E)}for(k=y-1;k>0;k--)A[S+k]=A[S+k-1];if(A[S]=F,O.length===0)H.encode(g(z),T),I(X),I($),T=z;else{H.encode(L,T),g(z),g($),g(X),T=X;var Z=M(),oe=O[0],ne=x.length+F;for(B=t;B<r&&Z!==u.EOF;B++,ne++){for(k=0;k<O.length;){var ce=x[ne-O[k]&e];Z!==ce?(oe=O[k],O.splice(k,1)):k++}if(O.length===0)break;g(Z),T=Z,Z=M()}O.length!==0&&(oe=O[0]),I(Z),W.encode(B-t),E=K-oe&e,E===J?D.encode(-1):(D.encode(E),J=E)}}b<0&&H.encode(P,T),_.encodeFinish()},!0),v.decompressFile=n.decompressFileHelper(v.MAGIC,function(o,f,b){var a,w,p,B=n.makeU8Buffer(e+1),E=0,R=new h(o);R.decodeStart(!0);for(var S=256,A=257,k=m.factory(R),N=d.factory(R,65280,256),y=new U(N,256,(b<0?A:S)+1),_=function(M){return M<=s?N(M):k(M)},x=new c(r-t+1,0,N,_),F=new c(e+1,1,N,_),g=32,C=0;b!==0&&(p=y.decode(g),p!==A);)if(p===S)for(w=x.decode()+t,a=F.decode(),a<0?a=C:C=a,b>=0&&(b-=w);--w>=0;)p=g=B[E++]=B[a++],f.writeByte(p),E>=B.length&&(E=0),a>=B.length&&(a=0);else f.writeByte(p),B[E++]=g=p,E>=B.length&&(E=0),b>=0&&b--;R.decodeFinish()}),Oe=v,Oe}var Ne,ut;function jt(){if(ut)return Ne;ut=1;const U=de(),d=He();ze();const c=pe(),m=qe(),h=je(),u=ve(),n=ie(),v=ee(),l=Y();var t=Object.create(null);t.MAGIC="lzp3";var r=256,e=65280,i=256,s=65536,o=4096,f=65536,b=20,a=1<<b,w=a-1,p=16,B=16777215,E=65535,R=function(S){this.buffer=l.makeU8Buffer(Math.min(S+4,a)),this.pos=0,this.ctxt4=l.makeU32Buffer(s),this.ctxt3=l.makeU32Buffer(o),this.ctxt2=l.makeU32Buffer(f),this.put(99),this.put(83),this.put(97),this.put(32)};return R.prototype.put=function(S){return this.buffer[this.pos++]=S,this.pos>=a&&(this.pos=0),S},R.prototype.get=function(S){return this.buffer[S&a-1]},R.prototype.context=function(S,A){var k=0,N;for(S=S-A&a-1,N=0;N<A;N++)k=k<<8|this.buffer[S++],S>=a&&(S=0);return k},R.prototype.getIndex=function(S,A){var k=this.context(S,4),N=(k>>>15^k)&s-1,y=(k>>>11^k)&o-1,_=k&E,x=0;return A===0&&(x=this.ctxt4[N],x!==0&&k!==this.context(x-1,4)&&(x=0),x===0&&(x=this.ctxt3[y],x!==0&&(k&B)!==this.context(x-1,3)&&(x=0),x===0&&(x=this.ctxt2[_],x!==0&&(k&&E)!==this.context(x-1,2)&&(x=0)))),A&&A--,this.ctxt4[N]=this.ctxt3[y]=this.ctxt2[_]=(S|A<<b)+1,x},t.compressFile=l.compressFileHelper(t.MAGIC,function(S,A,k,N){var y=new R(k>=0?k:a),_,x,F;{var g=new n(A);g.encodeStart(0,0),_=c.factory(g,e,i);var C=u.factory(g);x=function(T){return T>r?C(T):_(T)},F=function(){g.encodeFinish()}}var M=new d(_,256,k<0?257:256),I=[],O;for(O=0;O<p;O++)I[O]=new h(w+1,1,_,x);for(var L=0,P,G=0;L!==k;){var q=S.readByte();P=y.pos;var H=y.getIndex(P,0);if(H!==0){H--;for(var j=(H>>>b)+1,W=0;y.get(H+W)===q&&W<w;)W++,y.put(q),q=S.readByte();j===W?I[G&p-1].encode(-1):I[G&p-1].encode(W),y.getIndex(P,W),L+=W,G<<=1,W>0&&(G|=1)}var D=y.get(y.pos-1);if(q===v.EOF){k<0&&M.encode(256,D);break}M.encode(q,D),y.put(q),L++}F&&F()}),t.decompressFile=l.decompressFileHelper(t.MAGIC,function(S,A,k){var N=S.readByte(),y=!!(N&128),_=new R(k>=0?k:a),x,F,g;if(y){var C=new U(S);x=m.factory(C,E),F=u.factory(C)}else{var M=new n(S);M.decodeStart(!0),x=c.factory(M,e,i);var I=u.factory(M);F=function(K){return K>r?I(K):x(K)},g=function(){M.decodeFinish()}}var O=new d(x,256,k<0?257:256),L=[],P;for(P=0;P<p;P++)L[P]=new h(w+1,1,x,F);for(var G,q,H=0,j=0;H!==k;){G=_.pos;var W=_.getIndex(G,0);if(W!==0){W--;var D=(W>>>b)+1,T=L[j&p-1].decode();for(T<0&&(T=D),P=0;P<T;P++)q=_.get(W+P),A.writeByte(_.put(q));_.getIndex(G,T),H+=T,j<<=1,T>0&&(j|=1)}if(H===k)break;var J=_.get(_.pos-1);if(q=O.decode(J),q===256)break;A.writeByte(_.put(q)),H++}g&&g()}),Ne=t,Ne}var Te,lt;function Gt(){if(lt)return Te;lt=1;const U=ie(),d=Y();var c=5,m=18,h=1<<m,u=function(){this.buffer=d.makeU8Buffer(h),this.pos=0,this.firstPass=!0;for(var t=0;t<c;t++)this.put("cSaCsA".charCodeAt(t%6))};u.prototype.put=function(t){return this.buffer[this.pos++]=t,this.pos>=h&&(this.pos=0,this.firstPass=!1),t},u.prototype.get=function(t){return this.buffer[t&h-1]},u.prototype.context=function(t,r){var e=[],i;for(t=t-r&h-1,i=0;i<r;i++)e.push(this.buffer[t++]),t>=h&&(t=0);return String.fromCharCode.apply(String,e)};var n=256,v=65280,l=function(t,r){this.window=new u,this.contexts=Object.create(null);var e=function(){};e.prototype.encode=function(s,o){var f,b=0;for(f=0;f<s;f++)o[f]||b++;var a=r-o.total;t.encodeFreq(1,b,a)},e.prototype.decode=function(s){var o,f,b,a=r-s.total;for(f=b=t.decodeCulFreq(a),o=0;o<=f;o++)s[o]&&f++;return t.decodeUpdate(1,b,a),f},this.cm1coder=new e;var i=function(){this.sym=[r],this.prob=[0,n],this.refcount=0};i.prototype._rescale=function(){var s=this.sym.length,o,f,b=0,a=!0;for(o=0,f=0;o<s;o++){var w=this.sym[o],p=this.prob[o+1]-this.prob[o];p>>>=1,p>0&&(w===r&&(a=!1),this.sym[f]=w,this.prob[f++]=b,b+=p)}return this.prob[f]=b,s=this.sym.length=f,this.prob.length=s+1,a&&s<r&&(b=this._update(r,s,0,1)),b},i.prototype.update=function(s,o){var f=0;for(f=0;f<this.sym.length;f++)if(this.sym[f]===s)return this._update(s,f,this.prob[f+1]-this.prob[f],o);return this._update(s,f,0,o)},i.prototype._update=function(s,o,f,b){var a=this.sym.length,w,p,B;for(p=o;p<a-1;p++)this.sym[p]=this.sym[p+1],this.prob[p]=this.prob[p+1]-f;if(o<a)this.sym[p]=s,this.prob[p]=this.prob[p+1]-f,this.prob[a]=B=this.prob[a]+b;else if(B=this.prob[a],this.sym[o]=s,this.prob[o]=B,B+=b,this.prob[++a]=B,this.sym.length>r)for(w=0;w<a;w++)r===this.sym[w]&&(this._update(r,w,this.prob[w+1]-this.prob[w],-1),this.sym.length--,this.prob.length--,B=this.prob[this.prob.length-1]);return B>=v&&(B=this._rescale()),B},i.prototype.encode=function(s,o){var f,b,a,w,p,B=this.sym.length,E=0,R=0,S=0,A;for(f=B-1;f>=0;f--)if(w=this.prob[f],a=this.prob[f+1]-w,s===this.sym[f]){for(b=f-1;b>=0&&E<o.total;b--)o[this.sym[b]]&&(E+=1,A=this.prob[b+1]-this.prob[b],R+=A,S+=A);return p=this.prob[B],w-=R,p-=S,t.encodeFreq(a,w,p),s===r?(this._update(s,f,a,n/2),!1):!0}else o[this.sym[f]]&&(E+=1,S+=a);for(this.encode(r,o),console.assert(this.sym[this.sym.length-1]===r),f=0;f<this.sym.length-1;f++)o[this.sym[f]]||(o[this.sym[f]]=!0,o.total++)},i.prototype.decode=function(s){var o=this.sym.length,f=this.prob[o],b=0,a=0,w=0,p,B;for(B=o-1;B>=0&&b<s.total;B--)s[this.sym[B]]&&(b+=1,w+=this.prob[B+1]-this.prob[B]);var E=t.decodeCulFreq(f-w)+w;for(a=w,B=o-1;B>=0;B--)if(s[this.sym[B]])p=this.prob[B+1]-this.prob[B],a-=p,E-=p;else if(this.prob[B]<=E)break;console.assert(B>=0);var R=this.sym[B],S=this.prob[B],A=this.prob[B+1]-S;if(t.decodeUpdate(A,S-a,f-w),R<r)return R;for(this._update(R,B,A,n/2),console.assert(this.sym[this.sym.length-1]===r),B=0;B<this.sym.length-1;B++)s[this.sym[B]]||(s[this.sym[B]]=!0,s.total++);return-1},this.newContext=function(s){return new i},this.newExclude=function(){var s=Object.create(null);return s.total=0,s},(function(){var s,o;for(s=0;s<c;s++)for(o=0;o<=s;o++){var f=this.window.context(o+(c-1-s),o);this.contexts[f]||(this.contexts[f]=this.newContext()),this.contexts[f].refcount++}}).call(this)};return l.prototype.update=function(t,r,e){var i,s,o;for(s=0;s<=c;s++)o=r.slice(c-s),i=this.contexts[o],i||(i=this.contexts[o]=this.newContext()),s>=e&&i.update(t,n/2),i.refcount++;r=this.window.context(this.window.pos+c,c);var f=this.window.firstPass;for(s=c;s>=0&&!f;s--)o=r.slice(0,s),i=this.contexts[o],console.assert(i),--i.refcount<=0&&(console.assert(o!==""),delete this.contexts[o]);this.window.put(t)},l.prototype.decode=function(){var t=this.window.context(this.window.pos,c),r=this.newExclude(),e,i,s,o;for(i=c;i>=0;i--)if(s=t.slice(c-i),e=this.contexts[s],e&&(o=e.decode(r),o>=0))return this.update(o,t,i),o;return o=this.cm1coder.decode(r),this.update(o,t,i),o},l.prototype.encode=function(t){var r=this.window.context(this.window.pos,c),e=this.newExclude(),i;for(i=c;i>=0;i--){var s=r.slice(c-i),o=this.contexts[s];if(o){var f=o.encode(t,e);if(f){this.update(t,r,i);return}}}this.cm1coder.encode(t,e),this.update(t,r,i)},l.MAGIC="ppm2",l.compressFile=d.compressFileHelper(l.MAGIC,function(t,r,e,i,s){var o=new U(r);o.encodeStart(s,1);var f=new l(o,e<0?257:256);d.compressWithModel(t,e,f),o.encodeFinish()},!0),l.decompressFile=d.decompressFileHelper(l.MAGIC,function(t,r,e){var i=new U(t);i.decodeStart(!0);var s=new l(i,e<0?257:256);d.decompressWithModel(r,e,s),i.decodeFinish()}),Te=l,Te}var Pe,pt;function Wt(){if(pt)return Pe;pt=1;const U=ie(),d=ee(),c=Y();var m=1<<17,h=Object.create(null);return h.MAGIC="smpl",h.compressFile=c.compressFileHelper(h.MAGIC,function(u,n,v,l,t){var r=new U(n);r.encodeStart(t,1);for(var e=c.makeU8Buffer(m),i=[],s=0,o=!1,f=function(){var w=0;for(w=0;w<256;w++)i[w]=0;if(o){s=0;return}for(w=0;w<m;){var p=u.readByte();if(p===d.EOF){o=!0;break}if(e[w++]=p,i[p]++,i[p]===65535)break}s=w};;){var b;if(f(),o&&s===0)break;for(r.encodeBit(!0),b=0;b<256;b++)r.encodeShort(i[b]);for(i[256]=s,b=256;b;b--)i[b-1]=i[b]-i[b-1];for(b=0;b<s;b++){var a=e[b];r.encodeFreq(i[a+1]-i[a],i[a],i[256])}}r.encodeBit(!1),r.encodeFinish()},!0),h.decompressFile=c.decompressFileHelper(h.MAGIC,function(u,n,v){var l=new U(u);for(l.decodeStart(!0);l.decodeBit();){var t,r=[];for(t=0;t<256;t++)r[t]=l.decodeShort();var e=0;for(t=0;t<256;t++){var i=r[t];r[t]=e,e+=i}for(r[256]=e,t=0;t<e;t++){var s=l.decodeCulFreq(e),o;for(o=0;o<256&&!(r[o]<=s&&s<r[o+1]);o++);l.decodeUpdate(r[o+1]-r[o],r[o],e),n.writeByte(o)}}l.decodeFinish()}),Pe=h,Pe}var De,vt;function $t(){if(vt)return De;vt=1;const U=he(),d=de(),c=ee(),m=Le(),h=He(),u=ze(),n=pe(),v=xt(),l=ve(),t=qe(),r=ie(),e=Tt(),i=Lt(),s=qt(),o=Ht(),f=zt(),b=jt(),a=Gt(),w=Wt();return De=U({version:"1.2.0",BitStream:d,Stream:c,BWT:m,Context1Model:h,DefSumModel:u,FenwickModel:n,MTFModel:v,NoModel:l,Huffman:t,RangeCoder:r,BWTC:e,Bzip2:i,Dmc:s,Lzjb:o,LzjbR:f,Lzp3:b,PPM:a,Simple:w}),De}var yt=$t();const Bt=V.from(["B","Z","h","1"].map(U=>U.charCodeAt(0))),Xt=65535,mt=16777215;function bt(U){const d=V.concat([Bt,U]),c=yt.Bzip2.decompressFile(d);return V.from(c)}function wt(U){const d=yt.Bzip2.compressFile(U,void 0,1);return V.from(d).subarray(Bt.length)}function ae(U){U=U.toUpperCase();let d=0;for(let c=0;c<U.length;c+=1)d=(d*61|0)+U.charCodeAt(c)-32;return d}class Zt{entries;header;zippedBuffer;unzippedBuffer;size=0;compressedSize=0;constructor(){this.entries=new Map}readHeader(){if(!this.header)throw new Error("No header");this.size=this.header.getUInt3(),this.compressedSize=this.header.getUInt3()}decompress(){if(!this.zippedBuffer||!this.zippedBuffer.length)throw new Error("no archive to decompress");this.size!==this.compressedSize?this.unzippedBuffer=new fe(bt(this.zippedBuffer)):this.unzippedBuffer=new fe(this.zippedBuffer)}readEntries(){if(!this.unzippedBuffer)throw new Error("Unzipped buffer missing");const d=this.unzippedBuffer.getUShort();let c=2+d*10;for(let m=0;m<d;m+=1){const h=this.unzippedBuffer.getInt4(),u=this.unzippedBuffer.getUInt3(),n=this.unzippedBuffer.getUInt3(),v=V.from(this.unzippedBuffer.data.slice(c,c+n));let l;u!==n?l=bt(v):l=v,this.entries.set(h,l),c+=n}}readArchive(d){this.header=new fe(d.subarray(0,6)),this.zippedBuffer=d.subarray(6),this.readHeader(),this.decompress(),this.readEntries()}hasEntry(d){const c=typeof d=="number"?d:ae(d);return this.entries.has(c)}getEntry(d){const c=typeof d=="number"?d:ae(d);if(!this.entries.has(c))throw new Error(`entry ${d} (${c}) not found`);return this.entries.get(c)}putEntry(d,c){const m=ae(d);this.entries.set(m,c)}writeHeader(){if(!this.unzippedBuffer||!this.zippedBuffer)throw new Error("Buffers not prepared");this.header=new fe(V.alloc(6)),this.header.writeUInt3(this.unzippedBuffer.size),this.header.writeUInt3(this.zippedBuffer.length)}compress(d=!0){if(!this.unzippedBuffer)throw new Error("Unzipped buffer missing");d?this.zippedBuffer=V.from(this.unzippedBuffer.data):this.zippedBuffer=wt(V.from(this.unzippedBuffer.data))}writeEntries(d=!0){if(this.entries.size>Xt)throw new RangeError(`too many entries (${this.entries.size})`);const c=new Map;let m=0;for(const[u,n]of this.entries){const v=d?wt(n):n;if(c.set(u,v),n.length>mt||v.length>mt)throw new RangeError(`entry ${u} is too big`);m+=v.length}let h=2+this.entries.size*10;this.unzippedBuffer=new fe(V.alloc(h+m)),this.unzippedBuffer.writeUShort(this.entries.size);for(const[u,n]of c)this.unzippedBuffer.writeInt4(u),this.unzippedBuffer.writeUInt3(this.entries.get(u).length),this.unzippedBuffer.writeUInt3(n.length),V.from(n).copy(V.from(this.unzippedBuffer.data.buffer),h),h+=n.length}toArchive(d=!0){if(this.writeEntries(d),this.compress(d),this.writeHeader(),!this.header||!this.zippedBuffer)throw new Error("Build failed");return V.concat([V.from(this.header.data),this.zippedBuffer])}}class Yt{archive;sprites;CanvasKit;constructor(){this.archive=new Zt,this.sprites=new Map}async init(){typeof window>"u"&&globalThis.CanvasKitInit&&(this.CanvasKit=await globalThis.CanvasKitInit())}loadArchive(d){this.archive.readArchive(d)}createCanvas(d,c){if(typeof document<"u"){const m=document.createElement("canvas");return m.width=d,m.height=c,m}else if(this.CanvasKit){const m=this.CanvasKit.MakeCanvas(d,c);return m.width=d,m.height=c,m}throw new Error("No Canvas environment found")}parseSprite(d,c,m){c.caret=d.getUShort();const h=c.getUShort(),u=c.getUShort(),n=c.getUByte(),v=new Int32Array(n);v[0]=16711935;for(let t=0;t<n-1;t++)v[t+1]=(c.getUByte()<<16)+(c.getUByte()<<8)+c.getUByte();const l=[];for(let t=0;t<m;t+=1){const r=c.getUByte(),e=c.getUByte(),i=c.getUShort(),s=c.getUShort(),o=i*s,f=c.getUByte(),b=new Uint8Array(o);if(f===0)for(let a=0;a<o;a++)b[a]=d.getUByte();else for(let a=0;a<i;a++)for(let w=0;w<s;w++)b[a+w*i]=d.getUByte();try{const a=this.createCanvas(h,u),w=a.getContext("2d");w.translate(r,e);for(let p=0;p<i;p++)for(let B=0;B<s;B++){const E=v[b[p+B*i]];if(E===16711935)continue;const R=E.toString(16).padStart(6,"0");w.fillStyle=`#${R}`,w.fillRect(p,B,1,1)}l.push(a)}catch(a){console.warn("Canvas creation failed, storing raw data",a),l.push({spriteColourIndex:b,palette:v,width:i,height:s})}}return l}compressSprites(d){return console.log("Packing sprites not fully implemented in shim"),this.archive.toArchive(!0)}getSprite(d){if(this.sprites.has(d))return this.sprites.get(d);try{const c=this.archive.getEntry(`${d}.dat`),m=this.archive.getEntry("index.dat"),h=this.parseSprite(new fe(c),new fe(m),1);if(h&&h.length>0){const u={img:h[0]};return this.sprites.set(d,u),u}}catch(c){console.warn(`SpritePacker: Failed to extract sprite ${d}`,c)}return null}}class tr{constructor(d={}){this.serviceConfig=d}engineCache=null;sceneCache=null;classicSource=null;configData=null;activeBlueprint=null;spritePacker=null;setBlueprint(d,c){this.activeBlueprint={name:d,path:c},console.log(`[ClassicRSMV] Blueprint active: ${d} (${c})`)}getBlueprint(){return this.activeBlueprint}async linkClassicDir(d){const c={readFileBuffer:async m=>{const h=await ue.readLocalFile(`${d}\\${m}`,!0);if(!h.success||!h.content)throw new Error(`Failed to read ${m}`);const u=atob(h.content),n=new Uint8Array(u.length);for(let v=0;v<u.length;v++)n[v]=u.charCodeAt(v);return V.from(n)},readFileText:async m=>{const h=await ue.readLocalFile(`${d}\\${m}`,!1);if(!h.success||!h.content)throw new Error(`Failed to read ${m}`);return h.content},readDir:async m=>{const h=await ue.listDirectory(`${d}\\${m}`);return!h.success||!h.files?[]:h.files.map(u=>({name:u.name,kind:u.isDirectory?"directory":"file",isDir:u.isDirectory,size:0}))},copyFile:async(m,h)=>{const u=await ue.readLocalFile(`${d}\\from`,!0);if(!u.success||!u.content)throw new Error(`Failed to copy from ${m}`)},writeFile:async()=>{throw new Error("Write not supported")},mkDir:async()=>{throw new Error("Mkdir not supported")},unlink:async()=>{throw new Error("Unlink not supported")}};this.classicSource=await _t.create(c),this.engineCache=await Ct.create(this.classicSource),this.configData=await Mt(this.classicSource,this.classicSource.getBuildNr()),this.sceneCache=await Et.create(this.engineCache);try{const m=await c.readFileBuffer("media.jag");this.spritePacker=new Yt,this.spritePacker.loadArchive(m)}catch(m){console.warn("[ClassicRSMV] Failed to load media.jag (some UI sprites might be missing)",m)}return!0}async loadModel(d,c){if(!this.sceneCache||!this.engineCache||!this.configData)throw new Error("Classic RSMV: Not initialized.");if(c==="npc"||c==="npcs"){const n=this.configData.npcs[d];if(!n)throw new Error(`NPC ${d} definition not found`);console.log(`[ClassicRSMV] Attempting to load paper NPC: ${d} (${n.name})`);const v=await this.engineCache.getArchiveById(0,102),t=`npc${n.walkmodel}`,r=v.find(p=>p.namehash===ae("INDEX.DAT")),e=v.find(p=>p.namehash===ae(`${t}.DAT`))||v.find(p=>p.namehash===ae(`npc${d}.DAT`));if(!r||!e)throw new Error(`Sprite ${t} not found in entity archive for NPC ${d}`);const{parseLegacySprite:i}=await Ft(async()=>{const{parseLegacySprite:p}=await import("./enginecache-KDYRmXzf.js").then(B=>B.s);return{parseLegacySprite:p}},__vite__mapDeps([0,1,2,3])),s=i(r.buffer,e.buffer),o=new Rt(s.img.data,s.img.width,s.img.height,Ut);o.needsUpdate=!0,o.minFilter=We,o.magFilter=We;const f=new kt(s.img.width/100,s.img.height/100),b=new At({map:o,transparent:!0,side:It,alphaTest:.1}),a=new Ot(f,b);a.name=`npc_sprite_${d}`,a.onBeforeRender=(p,B,E)=>{a.quaternion.copy(E.quaternion)};const w=new Nt;return w.add(a),w.scale.set(512,512,512),{id:d,name:n.name,scene:w,metadata:{id:d,examine:n.examine,type:"paper-npc",sprite:t,classic:!0,paper:!0}}}const m=[{modelid:d,mods:{}}],h=new St(this.sceneCache,m,`classic_model:${d}`),u=await h.model;return{id:d,name:h.rootnode.name||`Model ${d}`,scene:h.rootnode,metadata:{id:d,classic:!0,paper:!1,...u?.modeldata||{}}}}async loadAvatar(d){throw new Error("Classic Avatar loading not implemented.")}dispose(){this.engineCache?.close(),this.sceneCache=null,this.engineCache=null,this.classicSource=null,this.spritePacker=null}async getItems(){return this.configData?.items||[]}async loadMap(d){if(!this.engineCache)throw new Error("Classic RSMV: Not initialized.");const c=await this.engineCache.getArchiveById(0,103),m=await this.engineCache.getArchiveById(0,104),h=`m${d}`,u=`l${d}`,n=c.find(l=>l.namehash===ae(`${h}.jag`))||c.find(l=>l.fileid===d),v=m.find(l=>l.namehash===ae(`${u}.jag`))||m.find(l=>l.fileid===d);return{id:d,map:n?.buffer,land:v?.buffer,type:"rsc_map"}}async loadAudio(d){if(!this.engineCache)throw new Error("Classic RSMV: Not initialized.");const m=(await this.engineCache.getArchiveById(0,108)).find(h=>h.fileid===d);if(!m)throw new Error(`Audio ${d} not found in sounds archive`);return{id:d,buffer:m.buffer,type:"rsc_audio"}}async loadUI(d){if(!this.spritePacker)throw new Error("Classic RSMV: UI media not loaded.");const c=this.spritePacker.getSprite(d);if(!c)throw new Error(`UI Sprite ${d} not found`);return{name:d,img:c.img,type:"rsc_ui"}}getConfig(){return this.configData}}export{tr as ClassicRSMVService};

import{k as ge,m as L,n as he,o as D,S as O}from"./main-Cu5wNbky.js";import{rsmv as ye}from"./index-DXYVQ0Sw.js";const Ee=(e,t)=>{ge.canEmit("critical")&&console.warn(`[Security] ${e}`,t)},be={input:{type:"input",category:"input",label:"Input",icon:"ðŸ“¥",description:"Manual input trigger",inputs:[],outputs:[{name:"data",type:"any",required:!1}],parameters:[{name:"value",type:"textarea",label:"Input Value",default:""}]},prompt:{type:"prompt",category:"input",label:"Prompt",icon:"ðŸ’­",description:"Text prompt input",inputs:[],outputs:[{name:"prompt",type:"string",required:!0}],parameters:[{name:"text",type:"textarea",label:"Prompt Text",required:!0}]},image_upload:{type:"image_upload",category:"input",label:"Image Upload",icon:"ðŸ–¼ï¸",description:"Upload reference image",inputs:[],outputs:[{name:"image",type:"object",required:!0}],parameters:[{name:"url",type:"string",label:"Image URL",required:!0}]},file_input:{type:"file_input",category:"input",label:"File Input",icon:"ðŸ“„",description:"Read file from filesystem",inputs:[],outputs:[{name:"content",type:"string",required:!0}],parameters:[{name:"path",type:"string",label:"File Path",required:!0}]},variable:{type:"variable",category:"input",label:"Variable",icon:"ðŸ”¢",description:"Store/retrieve variable",inputs:[{name:"value",type:"any",required:!1}],outputs:[{name:"value",type:"any",required:!1}],parameters:[{name:"name",type:"string",label:"Variable Name",required:!0},{name:"operation",type:"select",label:"Operation",options:[{label:"Get",value:"get"},{label:"Set",value:"set"}],default:"get"}]},ai_text:{type:"ai_text",category:"ai",label:"AI Text",icon:"ðŸ¤–",description:"Generate text with AI",inputs:[{name:"prompt",type:"string",required:!0}],outputs:[{name:"text",type:"string",required:!0}],parameters:[{name:"model",type:"select",label:"Model",options:[{label:"Gemini 2.0 Flash",value:"gemini"},{label:"Llama 3.1 70B",value:"llama"},{label:"DeepSeek R1",value:"deepseek"}],default:"gemini"},{name:"temperature",type:"number",label:"Temperature",default:.7},{name:"maxTokens",type:"number",label:"Max Tokens",default:2048}]},ai_image:{type:"ai_image",category:"ai",label:"AI Image",icon:"ðŸŽ¨",description:"Generate image with AI",inputs:[{name:"prompt",type:"string",required:!0}],outputs:[{name:"imageUrl",type:"string",required:!0}],parameters:[{name:"model",type:"select",label:"Model",options:[{label:"Imagen 3",value:"imagen"},{label:"Stable Diffusion XL",value:"sdxl"},{label:"Flux",value:"flux"}],default:"imagen"},{name:"size",type:"select",label:"Size",options:[{label:"512x512",value:"512x512"},{label:"1024x1024",value:"1024x1024"}],default:"1024x1024"}]},ai_code:{type:"ai_code",category:"ai",label:"AI Code",icon:"âš¡",description:"Generate code with AI",inputs:[{name:"prompt",type:"string",required:!0}],outputs:[{name:"code",type:"string",required:!0}],parameters:[{name:"language",type:"select",label:"Language",options:[{label:"TypeScript",value:"typescript"},{label:"JavaScript",value:"javascript"},{label:"Python",value:"python"},{label:"Rust",value:"rust"}],default:"typescript"}]},ai_reasoning:{type:"ai_reasoning",category:"ai",label:"AI Reasoning",icon:"ðŸ§ ",description:"Step-by-step reasoning",inputs:[{name:"problem",type:"string",required:!0}],outputs:[{name:"solution",type:"string",required:!0}],parameters:[{name:"model",type:"select",label:"Model",options:[{label:"DeepSeek R1",value:"deepseek-r1"},{label:"QwQ-32B",value:"qwq"}],default:"deepseek-r1"}]},transform:{type:"transform",category:"processing",label:"Transform",icon:"ðŸ”„",description:"Transform data",inputs:[{name:"data",type:"any",required:!0}],outputs:[{name:"result",type:"any",required:!0}],parameters:[{name:"code",type:"code",label:"Transform Code",default:"return data;",required:!0}]},filter:{type:"filter",category:"processing",label:"Filter",icon:"ðŸ”",description:"Conditional routing",inputs:[{name:"data",type:"any",required:!0}],outputs:[{name:"true",type:"any",required:!1},{name:"false",type:"any",required:!1}],parameters:[{name:"condition",type:"code",label:"Condition",default:"return true;",required:!0}]},loop:{type:"loop",category:"processing",label:"Loop",icon:"ðŸ”",description:"Iterate over items",inputs:[{name:"items",type:"array",required:!0}],outputs:[{name:"item",type:"any",required:!0}],parameters:[]},merge:{type:"merge",category:"processing",label:"Merge",icon:"ðŸ”€",description:"Merge multiple inputs",inputs:[{name:"input1",type:"any",required:!1},{name:"input2",type:"any",required:!1}],outputs:[{name:"merged",type:"any",required:!0}],parameters:[]},file_writer:{type:"file_writer",category:"output",label:"File Writer",icon:"ðŸ’¾",description:"Write file to filesystem",inputs:[{name:"path",type:"string",required:!0},{name:"content",type:"string",required:!0}],outputs:[{name:"success",type:"boolean",required:!0}],parameters:[]},"3d_export":{type:"3d_export",category:"output",label:"3D Export",icon:"ðŸ“¦",description:"Export 3D model",inputs:[{name:"model",type:"object",required:!0}],outputs:[{name:"path",type:"string",required:!0}],parameters:[{name:"format",type:"select",label:"Format",options:[{label:"GLB",value:"glb"},{label:"FBX",value:"fbx"},{label:"OBJ",value:"obj"}],default:"glb"},{name:"filename",type:"string",label:"Filename",required:!0}]},git_commit:{type:"git_commit",category:"output",label:"Git Commit",icon:"ðŸ“",description:"Commit changes to git",inputs:[{name:"files",type:"array",required:!0}],outputs:[{name:"commitHash",type:"string",required:!0}],parameters:[{name:"message",type:"string",label:"Commit Message",required:!0}]},deploy:{type:"deploy",category:"output",label:"Deploy",icon:"ðŸš€",description:"Deploy to production",inputs:[{name:"files",type:"array",required:!0}],outputs:[{name:"url",type:"string",required:!0}],parameters:[{name:"target",type:"select",label:"Target",options:[{label:"Cloudflare Pages",value:"pages"},{label:"Cloudflare Workers",value:"workers"}],default:"pages"}]},cloudflare:{type:"cloudflare",category:"integration",label:"Cloudflare",icon:"â˜ï¸",description:"Cloudflare API",inputs:[{name:"config",type:"object",required:!0}],outputs:[{name:"result",type:"any",required:!0}],parameters:[{name:"action",type:"select",label:"Action",options:[{label:"Deploy Worker",value:"deploy_worker"},{label:"Deploy Pages",value:"deploy_pages"},{label:"Update KV",value:"update_kv"}],default:"deploy_worker"}]},github:{type:"github",category:"integration",label:"GitHub",icon:"ðŸ™",description:"GitHub API",inputs:[{name:"config",type:"object",required:!0}],outputs:[{name:"result",type:"any",required:!0}],parameters:[{name:"action",type:"select",label:"Action",options:[{label:"Create PR",value:"create_pr"},{label:"Commit",value:"commit"},{label:"Create Issue",value:"create_issue"}],default:"commit"}]},discord:{type:"discord",category:"integration",label:"Discord",icon:"ðŸ’¬",description:"Send Discord notification",inputs:[{name:"message",type:"string",required:!0}],outputs:[{name:"success",type:"boolean",required:!0}],parameters:[{name:"webhookUrl",type:"string",label:"Webhook URL",required:!0}]},http:{type:"http",category:"integration",label:"HTTP Request",icon:"ðŸŒ",description:"Custom HTTP request",inputs:[{name:"body",type:"any",required:!1}],outputs:[{name:"response",type:"any",required:!0}],parameters:[{name:"url",type:"string",label:"URL",required:!0},{name:"method",type:"select",label:"Method",options:[{label:"GET",value:"GET"},{label:"POST",value:"POST"},{label:"PUT",value:"PUT"},{label:"DELETE",value:"DELETE"}],default:"GET"}]}};function _e(e){return be[e]}var F;(function(e){e.STRING="string",e.NUMBER="number",e.INTEGER="integer",e.BOOLEAN="boolean",e.ARRAY="array",e.OBJECT="object"})(F||(F={}));var H;(function(e){e.LANGUAGE_UNSPECIFIED="language_unspecified",e.PYTHON="python"})(H||(H={}));var K;(function(e){e.OUTCOME_UNSPECIFIED="outcome_unspecified",e.OUTCOME_OK="outcome_ok",e.OUTCOME_FAILED="outcome_failed",e.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded"})(K||(K={}));const q=["user","model","function","system"];var j;(function(e){e.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",e.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",e.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",e.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",e.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",e.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"})(j||(j={}));var B;(function(e){e.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",e.BLOCK_NONE="BLOCK_NONE"})(B||(B={}));var Y;(function(e){e.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",e.NEGLIGIBLE="NEGLIGIBLE",e.LOW="LOW",e.MEDIUM="MEDIUM",e.HIGH="HIGH"})(Y||(Y={}));var V;(function(e){e.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",e.SAFETY="SAFETY",e.OTHER="OTHER"})(V||(V={}));var R;(function(e){e.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",e.STOP="STOP",e.MAX_TOKENS="MAX_TOKENS",e.SAFETY="SAFETY",e.RECITATION="RECITATION",e.LANGUAGE="LANGUAGE",e.BLOCKLIST="BLOCKLIST",e.PROHIBITED_CONTENT="PROHIBITED_CONTENT",e.SPII="SPII",e.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",e.OTHER="OTHER"})(R||(R={}));var W;(function(e){e.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",e.RETRIEVAL_QUERY="RETRIEVAL_QUERY",e.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",e.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",e.CLASSIFICATION="CLASSIFICATION",e.CLUSTERING="CLUSTERING"})(W||(W={}));var J;(function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.AUTO="AUTO",e.ANY="ANY",e.NONE="NONE"})(J||(J={}));var X;(function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.MODE_DYNAMIC="MODE_DYNAMIC"})(X||(X={}));class m extends Error{constructor(t){super(`[GoogleGenerativeAI Error]: ${t}`)}}class C extends m{constructor(t,n){super(t),this.response=n}}class re extends m{constructor(t,n,o,a){super(t),this.status=n,this.statusText=o,this.errorDetails=a}}class b extends m{}class ce extends m{}const Ce="https://generativelanguage.googleapis.com",ve="v1beta",Ie="0.24.1",Re="genai-js";var _;(function(e){e.GENERATE_CONTENT="generateContent",e.STREAM_GENERATE_CONTENT="streamGenerateContent",e.COUNT_TOKENS="countTokens",e.EMBED_CONTENT="embedContent",e.BATCH_EMBED_CONTENTS="batchEmbedContents"})(_||(_={}));class we{constructor(t,n,o,a,s){this.model=t,this.task=n,this.apiKey=o,this.stream=a,this.requestOptions=s}toString(){var t,n;const o=((t=this.requestOptions)===null||t===void 0?void 0:t.apiVersion)||ve;let s=`${((n=this.requestOptions)===null||n===void 0?void 0:n.baseUrl)||Ce}/${o}/${this.model}:${this.task}`;return this.stream&&(s+="?alt=sse"),s}}function Ae(e){const t=[];return e?.apiClient&&t.push(e.apiClient),t.push(`${Re}/${Ie}`),t.join(" ")}async function Se(e){var t;const n=new Headers;n.append("Content-Type","application/json"),n.append("x-goog-api-client",Ae(e.requestOptions)),n.append("x-goog-api-key",e.apiKey);let o=(t=e.requestOptions)===null||t===void 0?void 0:t.customHeaders;if(o){if(!(o instanceof Headers))try{o=new Headers(o)}catch(a){throw new b(`unable to convert customHeaders value ${JSON.stringify(o)} to Headers: ${a.message}`)}for(const[a,s]of o.entries()){if(a==="x-goog-api-key")throw new b(`Cannot set reserved header name ${a}`);if(a==="x-goog-api-client")throw new b(`Header name ${a} can only be set using the apiClient field`);n.append(a,s)}}return n}async function Oe(e,t,n,o,a,s){const i=new we(e,t,n,o,s);return{url:i.toString(),fetchOptions:Object.assign(Object.assign({},xe(s)),{method:"POST",headers:await Se(i),body:a})}}async function S(e,t,n,o,a,s={},i=fetch){const{url:r,fetchOptions:l}=await Oe(e,t,n,o,a,s);return Te(r,l,i)}async function Te(e,t,n=fetch){let o;try{o=await n(e,t)}catch(a){Ne(a,e)}return o.ok||await Me(o,e),o}function Ne(e,t){let n=e;throw n.name==="AbortError"?(n=new ce(`Request aborted when fetching ${t.toString()}: ${e.message}`),n.stack=e.stack):e instanceof re||e instanceof b||(n=new m(`Error fetching from ${t.toString()}: ${e.message}`),n.stack=e.stack),n}async function Me(e,t){let n="",o;try{const a=await e.json();n=a.error.message,a.error.details&&(n+=` ${JSON.stringify(a.error.details)}`,o=a.error.details)}catch{}throw new re(`Error fetching from ${t.toString()}: [${e.status} ${e.statusText}] ${n}`,e.status,e.statusText,o)}function xe(e){const t={};if(e?.signal!==void 0||e?.timeout>=0){const n=new AbortController;e?.timeout>=0&&setTimeout(()=>n.abort(),e.timeout),e?.signal&&e.signal.addEventListener("abort",()=>{n.abort()}),t.signal=n.signal}return t}function G(e){return e.text=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),N(e.candidates[0]))throw new C(`${E(e)}`,e);return Le(e)}else if(e.promptFeedback)throw new C(`Text not available. ${E(e)}`,e);return""},e.functionCall=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),N(e.candidates[0]))throw new C(`${E(e)}`,e);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),Q(e)[0]}else if(e.promptFeedback)throw new C(`Function call not available. ${E(e)}`,e)},e.functionCalls=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),N(e.candidates[0]))throw new C(`${E(e)}`,e);return Q(e)}else if(e.promptFeedback)throw new C(`Function call not available. ${E(e)}`,e)},e}function Le(e){var t,n,o,a;const s=[];if(!((n=(t=e.candidates)===null||t===void 0?void 0:t[0].content)===null||n===void 0)&&n.parts)for(const i of(a=(o=e.candidates)===null||o===void 0?void 0:o[0].content)===null||a===void 0?void 0:a.parts)i.text&&s.push(i.text),i.executableCode&&s.push("\n```"+i.executableCode.language+`
`+i.executableCode.code+"\n```\n"),i.codeExecutionResult&&s.push("\n```\n"+i.codeExecutionResult.output+"\n```\n");return s.length>0?s.join(""):""}function Q(e){var t,n,o,a;const s=[];if(!((n=(t=e.candidates)===null||t===void 0?void 0:t[0].content)===null||n===void 0)&&n.parts)for(const i of(a=(o=e.candidates)===null||o===void 0?void 0:o[0].content)===null||a===void 0?void 0:a.parts)i.functionCall&&s.push(i.functionCall);if(s.length>0)return s}const De=[R.RECITATION,R.SAFETY,R.LANGUAGE];function N(e){return!!e.finishReason&&De.includes(e.finishReason)}function E(e){var t,n,o;let a="";if((!e.candidates||e.candidates.length===0)&&e.promptFeedback)a+="Response was blocked",!((t=e.promptFeedback)===null||t===void 0)&&t.blockReason&&(a+=` due to ${e.promptFeedback.blockReason}`),!((n=e.promptFeedback)===null||n===void 0)&&n.blockReasonMessage&&(a+=`: ${e.promptFeedback.blockReasonMessage}`);else if(!((o=e.candidates)===null||o===void 0)&&o[0]){const s=e.candidates[0];N(s)&&(a+=`Candidate was blocked due to ${s.finishReason}`,s.finishMessage&&(a+=`: ${s.finishMessage}`))}return a}function w(e){return this instanceof w?(this.v=e,this):new w(e)}function Ge(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var o=n.apply(e,t||[]),a,s=[];return a={},i("next"),i("throw"),i("return"),a[Symbol.asyncIterator]=function(){return this},a;function i(c){o[c]&&(a[c]=function(d){return new Promise(function(g,h){s.push([c,d,g,h])>1||r(c,d)})})}function r(c,d){try{l(o[c](d))}catch(g){u(s[0][3],g)}}function l(c){c.value instanceof w?Promise.resolve(c.value.v).then(p,f):u(s[0][2],c)}function p(c){r("next",c)}function f(c){r("throw",c)}function u(c,d){c(d),s.shift(),s.length&&r(s[0][0],s[0][1])}}const z=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function Ue(e){const t=e.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),n=Pe(t),[o,a]=n.tee();return{stream:$e(o),response:ke(a)}}async function ke(e){const t=[],n=e.getReader();for(;;){const{done:o,value:a}=await n.read();if(o)return G(Fe(t));t.push(a)}}function $e(e){return Ge(this,arguments,function*(){const n=e.getReader();for(;;){const{value:o,done:a}=yield w(n.read());if(a)break;yield yield w(G(o))}})}function Pe(e){const t=e.getReader();return new ReadableStream({start(o){let a="";return s();function s(){return t.read().then(({value:i,done:r})=>{if(r){if(a.trim()){o.error(new m("Failed to parse stream"));return}o.close();return}a+=i;let l=a.match(z),p;for(;l;){try{p=JSON.parse(l[1])}catch{o.error(new m(`Error parsing JSON response: "${l[1]}"`));return}o.enqueue(p),a=a.substring(l[0].length),l=a.match(z)}return s()}).catch(i=>{let r=i;throw r.stack=i.stack,r.name==="AbortError"?r=new ce("Request aborted when reading from the stream"):r=new m("Error reading from the stream"),r})}}})}function Fe(e){const t=e[e.length-1],n={promptFeedback:t?.promptFeedback};for(const o of e){if(o.candidates){let a=0;for(const s of o.candidates)if(n.candidates||(n.candidates=[]),n.candidates[a]||(n.candidates[a]={index:a}),n.candidates[a].citationMetadata=s.citationMetadata,n.candidates[a].groundingMetadata=s.groundingMetadata,n.candidates[a].finishReason=s.finishReason,n.candidates[a].finishMessage=s.finishMessage,n.candidates[a].safetyRatings=s.safetyRatings,s.content&&s.content.parts){n.candidates[a].content||(n.candidates[a].content={role:s.content.role||"user",parts:[]});const i={};for(const r of s.content.parts)r.text&&(i.text=r.text),r.functionCall&&(i.functionCall=r.functionCall),r.executableCode&&(i.executableCode=r.executableCode),r.codeExecutionResult&&(i.codeExecutionResult=r.codeExecutionResult),Object.keys(i).length===0&&(i.text=""),n.candidates[a].content.parts.push(i)}a++}o.usageMetadata&&(n.usageMetadata=o.usageMetadata)}return n}async function le(e,t,n,o){const a=await S(t,_.STREAM_GENERATE_CONTENT,e,!0,JSON.stringify(n),o);return Ue(a)}async function ue(e,t,n,o){const s=await(await S(t,_.GENERATE_CONTENT,e,!1,JSON.stringify(n),o)).json();return{response:G(s)}}function de(e){if(e!=null){if(typeof e=="string")return{role:"system",parts:[{text:e}]};if(e.text)return{role:"system",parts:[e]};if(e.parts)return e.role?e:{role:"system",parts:e.parts}}}function A(e){let t=[];if(typeof e=="string")t=[{text:e}];else for(const n of e)typeof n=="string"?t.push({text:n}):t.push(n);return He(t)}function He(e){const t={role:"user",parts:[]},n={role:"function",parts:[]};let o=!1,a=!1;for(const s of e)"functionResponse"in s?(n.parts.push(s),a=!0):(t.parts.push(s),o=!0);if(o&&a)throw new m("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!o&&!a)throw new m("No content is provided for sending chat message.");return o?t:n}function Ke(e,t){var n;let o={model:t?.model,generationConfig:t?.generationConfig,safetySettings:t?.safetySettings,tools:t?.tools,toolConfig:t?.toolConfig,systemInstruction:t?.systemInstruction,cachedContent:(n=t?.cachedContent)===null||n===void 0?void 0:n.name,contents:[]};const a=e.generateContentRequest!=null;if(e.contents){if(a)throw new b("CountTokensRequest must have one of contents or generateContentRequest, not both.");o.contents=e.contents}else if(a)o=Object.assign(Object.assign({},o),e.generateContentRequest);else{const s=A(e);o.contents=[s]}return{generateContentRequest:o}}function Z(e){let t;return e.contents?t=e:t={contents:[A(e)]},e.systemInstruction&&(t.systemInstruction=de(e.systemInstruction)),t}function qe(e){return typeof e=="string"||Array.isArray(e)?{content:A(e)}:e}const ee=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],je={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function Be(e){let t=!1;for(const n of e){const{role:o,parts:a}=n;if(!t&&o!=="user")throw new m(`First content should be with role 'user', got ${o}`);if(!q.includes(o))throw new m(`Each item should include role field. Got ${o} but valid roles are: ${JSON.stringify(q)}`);if(!Array.isArray(a))throw new m("Content should have 'parts' property with an array of Parts");if(a.length===0)throw new m("Each Content should have at least one part");const s={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(const r of a)for(const l of ee)l in r&&(s[l]+=1);const i=je[o];for(const r of ee)if(!i.includes(r)&&s[r]>0)throw new m(`Content with role '${o}' can't contain '${r}' part`);t=!0}}function te(e){var t;if(e.candidates===void 0||e.candidates.length===0)return!1;const n=(t=e.candidates[0])===null||t===void 0?void 0:t.content;if(n===void 0||n.parts===void 0||n.parts.length===0)return!1;for(const o of n.parts)if(o===void 0||Object.keys(o).length===0||o.text!==void 0&&o.text==="")return!1;return!0}const ne="SILENT_ERROR";class Ye{constructor(t,n,o,a={}){this.model=n,this.params=o,this._requestOptions=a,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=t,o?.history&&(Be(o.history),this._history=o.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(t,n={}){var o,a,s,i,r,l;await this._sendPromise;const p=A(t),f={safetySettings:(o=this.params)===null||o===void 0?void 0:o.safetySettings,generationConfig:(a=this.params)===null||a===void 0?void 0:a.generationConfig,tools:(s=this.params)===null||s===void 0?void 0:s.tools,toolConfig:(i=this.params)===null||i===void 0?void 0:i.toolConfig,systemInstruction:(r=this.params)===null||r===void 0?void 0:r.systemInstruction,cachedContent:(l=this.params)===null||l===void 0?void 0:l.cachedContent,contents:[...this._history,p]},u=Object.assign(Object.assign({},this._requestOptions),n);let c;return this._sendPromise=this._sendPromise.then(()=>ue(this._apiKey,this.model,f,u)).then(d=>{var g;if(te(d.response)){this._history.push(p);const h=Object.assign({parts:[],role:"model"},(g=d.response.candidates)===null||g===void 0?void 0:g[0].content);this._history.push(h)}else{const h=E(d.response);h&&console.warn(`sendMessage() was unsuccessful. ${h}. Inspect response object for details.`)}c=d}).catch(d=>{throw this._sendPromise=Promise.resolve(),d}),await this._sendPromise,c}async sendMessageStream(t,n={}){var o,a,s,i,r,l;await this._sendPromise;const p=A(t),f={safetySettings:(o=this.params)===null||o===void 0?void 0:o.safetySettings,generationConfig:(a=this.params)===null||a===void 0?void 0:a.generationConfig,tools:(s=this.params)===null||s===void 0?void 0:s.tools,toolConfig:(i=this.params)===null||i===void 0?void 0:i.toolConfig,systemInstruction:(r=this.params)===null||r===void 0?void 0:r.systemInstruction,cachedContent:(l=this.params)===null||l===void 0?void 0:l.cachedContent,contents:[...this._history,p]},u=Object.assign(Object.assign({},this._requestOptions),n),c=le(this._apiKey,this.model,f,u);return this._sendPromise=this._sendPromise.then(()=>c).catch(d=>{throw new Error(ne)}).then(d=>d.response).then(d=>{if(te(d)){this._history.push(p);const g=Object.assign({},d.candidates[0].content);g.role||(g.role="model"),this._history.push(g)}else{const g=E(d);g&&console.warn(`sendMessageStream() was unsuccessful. ${g}. Inspect response object for details.`)}}).catch(d=>{d.message!==ne&&console.error(d)}),c}}async function Ve(e,t,n,o){return(await S(t,_.COUNT_TOKENS,e,!1,JSON.stringify(n),o)).json()}async function We(e,t,n,o){return(await S(t,_.EMBED_CONTENT,e,!1,JSON.stringify(n),o)).json()}async function Je(e,t,n,o){const a=n.requests.map(i=>Object.assign(Object.assign({},i),{model:t}));return(await S(t,_.BATCH_EMBED_CONTENTS,e,!1,JSON.stringify({requests:a}),o)).json()}class oe{constructor(t,n,o={}){this.apiKey=t,this._requestOptions=o,n.model.includes("/")?this.model=n.model:this.model=`models/${n.model}`,this.generationConfig=n.generationConfig||{},this.safetySettings=n.safetySettings||[],this.tools=n.tools,this.toolConfig=n.toolConfig,this.systemInstruction=de(n.systemInstruction),this.cachedContent=n.cachedContent}async generateContent(t,n={}){var o;const a=Z(t),s=Object.assign(Object.assign({},this._requestOptions),n);return ue(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(o=this.cachedContent)===null||o===void 0?void 0:o.name},a),s)}async generateContentStream(t,n={}){var o;const a=Z(t),s=Object.assign(Object.assign({},this._requestOptions),n);return le(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(o=this.cachedContent)===null||o===void 0?void 0:o.name},a),s)}startChat(t){var n;return new Ye(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(n=this.cachedContent)===null||n===void 0?void 0:n.name},t),this._requestOptions)}async countTokens(t,n={}){const o=Ke(t,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),a=Object.assign(Object.assign({},this._requestOptions),n);return Ve(this.apiKey,this.model,o,a)}async embedContent(t,n={}){const o=qe(t),a=Object.assign(Object.assign({},this._requestOptions),n);return We(this.apiKey,this.model,o,a)}async batchEmbedContents(t,n={}){const o=Object.assign(Object.assign({},this._requestOptions),n);return Je(this.apiKey,this.model,t,o)}}class Xe{constructor(t){this.apiKey=t}getGenerativeModel(t,n){if(!t.model)throw new m("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new oe(this.apiKey,t,n)}getGenerativeModelFromCachedContent(t,n,o){if(!t.name)throw new b("Cached content must contain a `name` field.");if(!t.model)throw new b("Cached content must contain a `model` field.");const a=["model","systemInstruction"];for(const i of a)if(n?.[i]&&t[i]&&n?.[i]!==t[i]){if(i==="model"){const r=n.model.startsWith("models/")?n.model.replace("models/",""):n.model,l=t.model.startsWith("models/")?t.model.replace("models/",""):t.model;if(r===l)continue}throw new b(`Different value for "${i}" specified in modelParams (${n[i]}) and cachedContent (${t[i]})`)}const s=Object.assign(Object.assign({},n),{model:t.model,tools:t.tools,toolConfig:t.toolConfig,systemInstruction:t.systemInstruction,cachedContent:t});return new oe(this.apiKey,s,o)}}const Qe={};class ze{client=null;apiKey=null;constructor(){}ensureClient(){if(this.client)return;let t=this.apiKey;if(typeof globalThis<"u"&&"localStorage"in globalThis)try{t=globalThis.localStorage.getItem("TEMP_GEMINI_KEY")}catch{}t||(t=Qe?.VITE_GEMINI_API_KEY),t&&(this.apiKey=t,this.client=new Xe(t))}refreshApiKey(){this.client=null,this.apiKey=null,this.ensureClient()}isAvailable(){return this.ensureClient(),this.client!==null}async textChat(t){if(this.ensureClient(),!this.client)throw new Error("Gemini API key not configured");const n=t.model||"gemini-1.5-flash",o=this.client.getGenerativeModel({model:n,systemInstruction:t.systemPrompt});t.functionDeclarations&&(o.tools=[{functionDeclarations:t.functionDeclarations}]);const a=t.history?.map(p=>({role:p.role==="user"?"user":"model",parts:[{text:p.content}]}))||[],r=(await o.startChat({history:a}).sendMessage(t.prompt)).response;return{content:r.text(),model:n,tokensUsed:r.usageMetadata?.totalTokenCount}}async generateImage(t){return console.warn("Gemini Image Gen not fully implemented in standard SDK"),{imageUrl:"",model:"imagen-placeholder"}}async codeCompletion(t){if(this.ensureClient(),!this.client)throw new Error("Gemini API key not configured");const n=this.client.getGenerativeModel({model:"gemini-1.5-pro"}),o=`Context: ${t.context||""}
Language: ${t.language||"auto"}

Task: ${t.prompt}`,s=(await n.generateContent(o)).response.text(),i=s.match(/```(?:\w+)?\n([\s\S]*?)```/);return{code:i?i[1]:s,model:"gemini-1.5-pro"}}}const Ze=new ze,et=e=>e?e.length>1e5?{isValid:!1,error:"Prompt too long"}:/system\s*\(/.test(e)||/child_process/.test(e)?{isValid:!1,error:"Potential code injection"}:{isValid:!0,sanitized:e}:{isValid:!1,error:"Empty prompt"},tt="https://api.aimlapi.com/v1";async function nt(e,t){try{const n=await fetch(`${tt}/images/generations`,{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({model:"triposr",image_url:e})});if(!n.ok)throw new Error(`AIML API error: ${n.statusText}`);const o=await n.json(),a=o.model_mesh.url,s=o.model_mesh.file_name,r=await(await fetch(a)).blob();return{url:a,fileName:s,blob:r,format:s.endsWith(".glb")?"glb":"obj",metadata:o}}catch(n){throw console.error("[AIML] Failed:",n),n}}const ot={imageToModel:nt};function at(e){let t=2166136261;for(let n=0;n<e.length;n++)t^=e.charCodeAt(n),t=Math.imul(t,16777619);return(t>>>0).toString(16)}class v{static instance;cacheEnabled=!0;constructor(){}static getInstance(){return v.instance||(v.instance=new v),v.instance}getCacheKey(t){const n=JSON.stringify({model:t.options?.model||"default",type:t.type,prompt:t.prompt,system:t.systemPrompt,history:t.history?.length||0});return`ai_cache:${at(n)}`}async getCachedResponse(t){if(!this.cacheEnabled)return null;try{const n=this.getCacheKey(t);if(typeof globalThis<"u"&&"localStorage"in globalThis){const o=globalThis.localStorage.getItem(n);if(o){const a=JSON.parse(o);if(Date.now()<a.expires)return console.log(`[AICache] HIT: ${n} (${a.data.model})`),a.data;localStorage.removeItem(n)}}}catch(n){console.warn("[AICache] Read failed",n)}return null}async setCachedResponse(t,n){if(this.cacheEnabled&&!(n.content&&n.content.length>5e4))try{const o=this.getCacheKey(t),a={data:n,expires:Date.now()+1440*60*1e3};typeof globalThis<"u"&&"localStorage"in globalThis&&(globalThis.localStorage.setItem(o,JSON.stringify(a)),console.log(`[AICache] SET: ${o}`))}catch(o){console.warn("[AICache] Write failed",o)}}}const ae=v.getInstance();class st{static async getKey(t){const n=new TextEncoder;return crypto.subtle.importKey("raw",n.encode(t),{name:"HMAC",hash:"SHA-256"},!1,["sign","verify"])}static async sign(t,n,o="dev-secret"){const a=n==="local"||n==="ollama"?"GHOST":"CLOUD",s=Date.now(),i=`${a}:${s}:${t}`,r=await this.getKey(o),l=await crypto.subtle.sign("HMAC",r,new TextEncoder().encode(i)),p=Array.from(new Uint8Array(l)).map(f=>f.toString(16).padStart(2,"0")).join("");return`pog_sig_v1:${a}:${s}:${p}`}static async verify(t,n,o="dev-secret"){if(!n.startsWith("pog_sig_v1:"))return!1;const a=n.split(":");if(a.length!==4)return!1;const[s,i,r,l]=a,p=`${i}:${r}:${t}`,f=await this.getKey(o),u=new Uint8Array(l.match(/.{1,2}/g).map(c=>parseInt(c,16)));return crypto.subtle.verify("HMAC",f,u,new TextEncoder().encode(p))}}class U{static instance;constructor(){}static getInstance(){return this.instance||(this.instance=new U),this.instance}async compile(t){console.log("[RSMVCompiler] Translating Neural Graph to RSMV Opcode Mapping...");const n={version:"RS3_LEGACY",opcodes:[],materials:{}};return t.nodes.forEach(o=>{switch(o.type){case"color":n.opcodes.push(`SET_BASE_COLOR_${o.params.hex.replace("#","")}`);break;case"texture":n.opcodes.push(`BIND_TEX_${o.params.id}`);break;default:console.warn("[RSMVCompiler] Unsupported node type for RSMV adherence:",o.type)}}),n}async inject(t){if(!ye.getSceneCache())throw new Error("RSMV: Cannot inject shader without an active scene cache.");console.log("[RSMVCompiler] Adhering shader payload to active RSMV session...")}}const it=U.getInstance(),I={GPT_OSS:"@cf/openai/gpt-oss-120b",GPT_OSS_LITE:"@cf/openai/gpt-oss-20b",LLAMA4_SCOUT:"@cf/meta/llama-4-scout-17b-16e-instruct",GEMMA3_12B:"@cf/google/gemma-3-12b-it",MISTRAL_SMALL_V3:"@cf/mistralai/mistral-small-3.1-24b-instruct",LLAMA_3_3:"@cf/meta/llama-3.3-70b-instruct-fp8-fast",REASONING:"@cf/deepseek-ai/deepseek-r1-distill-qwen-32b",QWQ_32B:"@cf/qwen/qwq-32b",QWEN3_30B:"@cf/qwen/qwen3-30b-a3b-fp8",CODER:"@cf/qwen/qwen2.5-coder-32b-instruct",CODER_LITE:"@cf/qwen/qwen2.5-coder-7b-instruct",DEEPCODER:"@cf/thebloke/deepseek-coder-6.7b-instruct-awq",LLAMA_3_2_3B:"@cf/meta/llama-3.2-3b-instruct",FLUX_DEV:"@cf/black-forest-labs/flux-2-dev",FLUX_SCHNELL:"@cf/black-forest-labs/flux-1-schnell",IMAGE:"@cf/leonardo/lucid-origin",PHOENIX:"@cf/leonardo/phoenix-1.0",SDXL:"@cf/black-forest-labs/flux-1-schnell",LLAMA_3_2_11B_VISION:"@cf/meta/llama-3.2-11b-vision-instruct",STT:"@cf/openai/whisper-large-v3-turbo",STT_FAST:"@cf/openai/whisper-tiny-en",TTS:"@cf/myshell-ai/melotts",AURA_EN:"@cf/deepgram/aura-2-en",AURA_ES:"@cf/deepgram/aura-2-es",NOVA3:"@cf/deepgram/nova-3",LLAMA_GUARD:"@cf/meta/llama-guard-3-8b",SENTIMENT:"@cf/huggingface/distilbert-sst-2-int8",SUMMARIZATION:"@cf/facebook/bart-large-cnn",TRANSLATION:"@cf/meta/m2m100-1.2b",EMBEDDING:"@cf/google/embeddinggemma-300m",EMBEDDING_QWEN:"@cf/qwen/qwen3-embedding-0.6b",RERANKER:"@cf/baai/bge-reranker-base",SQLCODER:"@cf/qwen/qwen2.5-coder-32b-instruct",DEEPSEEK_MATH:"@cf/deepseek-ai/deepseek-r1-distill-qwen-32b",MATHSTRAL:"@cf/mistralai/mathstral-7b-v0.1",FLUX:"@cf/black-forest-labs/flux-1-schnell",AURA:"@cf/deepgram/aura-2-en",LLAVA:"@cf/meta/llama-3.2-11b-vision-instruct",QWEN_TURBO:"@cf/qwen/qwen3-30b-a3b-fp8",TINYLLAMA:"@cf/meta/llama-3.2-3b-instruct",GEMMA2:"@cf/google/gemma-3-12b-it"},rt=[{pattern:/\b(code|function|class|debug|refactor|typescript|javascript|python|rust|go)\b/i,models:["CODER","CODER_LITE","DEEPCODER"],priority:10},{pattern:/\b(sql|query|database|select|insert|join)\b/i,models:["SQLCODER","CODER"],priority:15},{pattern:/\b(math|equation|calculate|solve|formula|integral|derivative)\b/i,models:["DEEPSEEK_MATH","MATHSTRAL","REASONING"],priority:12},{pattern:/\b(think|reason|analyze|explain|complex|logic|orchestrate|plan|architect|decompose)\b/i,models:["REASONING","LLAMA_3_3","GPT_OSS"],priority:25},{pattern:/\b(generate|create|draw|image|picture|art|illustration)\b/i,models:["FLUX_DEV","FLUX","SDXL"],priority:20},{pattern:/\b(transcribe|speech|audio|voice|speak)\b/i,models:["STT","AURA","TTS"],priority:18},{pattern:/\b(describe|see|look|image|photo|picture)\b/i,models:["LLAVA","LLAMA_3_2_11B_VISION"],priority:16},{pattern:/\b(quick|fast|simple|short)\b/i,models:["QWEN_TURBO","TINYLLAMA","GEMMA2"],priority:5}];async function k(e,t){const n=Date.now(),o=await L.route({userId:e.userId||"anonymous",type:e.type,prompt:e.prompt},t);e.modelId||(e.modelId=o.model,e.provider=o.provider);const a=await ae.getCachedResponse(e);if(a)return{...a,cost:0,latency:0,provider:"local"};let s=e.modelId;if(!s&&(e.type==="text"||e.type==="code")){let u={model:"GPT_OSS",priority:0};for(const c of rt)c.pattern.test(e.prompt)&&c.priority>u.priority&&(u={model:c.models[0],priority:c.priority});s=I[u.model]||I.GPT_OSS,console.log(`[ROUTER] Auto-routed to ${u.model} (${s})`)}else s&&I[s]&&(s=I[s]);const i={...e,modelId:s};if(e.prompt.startsWith("{")&&(e.options?.isIntent||e.prompt.includes('"action"')))try{const u=JSON.parse(e.prompt);console.log(`[ROUTER] Intent detected: ${u.action}`);const c=globalThis.POG_NEURAL_REGISTRY||globalThis.limbRegistry;if(!c)throw new Error("No Neural Registry available for intent processing");const d=await c.executeCapability(u.limbId||"orchestrator",u);return{content:JSON.stringify(d.data||d),model:"limb-direct",provider:"local",latency:Date.now()-n}}catch(u){console.warn("[ROUTER] Failed to parse intent prompt as JSON:",u)}const r=et(e.prompt);if(!r.isValid)throw Ee("BLOCKED_AI_PROMPT",{prompt:e.prompt,error:r.error}),new Error(`[SECURITY] ${r.error}`);const l=[];if(i.provider==="gemini")l.push({provider:"gemini",executor:se});else if(i.provider==="cloudflare")l.push({provider:"cloudflare",executor:ie});else{const u=await L.getQuota(i.userId||"anonymous",t);u.cloudflare.tokens>0&&l.push({provider:"cloudflare",executor:ie}),u.gemini.budget>0&&l.push({provider:"gemini",executor:se})}if(e.type==="rsc_material"){const u=await k({...e,type:"text"},t);try{const c=JSON.parse(u.content||"{}"),d=await it.compile(c);return{...u,content:JSON.stringify(d),metadata:{...u.metadata,rsc_pipeline:!0}}}catch{console.warn("[ROUTER] RSC Pipeline parse failure, returning raw AI response")}}let p,f;for(const u of l)try{const c=await u.executor(i,void 0);if(c instanceof ReadableStream)return c;await L.deductUsage(i.userId||"anonymous",{provider:u.provider,tokens:c.tokensUsed||100,cost:c.cost||0},t);const d=await st.sign(c.content||"",u.provider,t.PLATFORM_BACKUP_KEY||"dev-secret");p={...c,provider:u.provider,latency:Date.now()-n,cost:c.cost||0,provenance:d};break}catch(c){console.warn(`[ROUTER] Step ${u.provider} failed:`,c),f=c;continue}if(!p)throw f||new Error("All providers failed");return p instanceof ReadableStream||await ae.setCachedResponse(i,p),p}async function se(e,t){switch(e.type){case"text":case"function_calling":case"code":const n=await Ze.textChat({prompt:e.prompt,history:e.history,model:"gemini-2.0-flash"});return{content:n.content,model:n.model};default:throw new Error("Gemini only supports text/code")}}async function ie(e,t){const n=e.modelId||I.GPT_OSS;switch(e.type){case"text":case"code":case"function_calling":const o=(e.history||[]).map(f=>({role:f.role==="model"?"assistant":"user",content:f.content})),a=await D.textChat({history:o,prompt:e.prompt,systemPrompt:e.systemPrompt,model:n,lora:e.lora});return{content:a.content||a,model:n,tokensUsed:a.tokensUsed};case"image":const s=await D.generateImage({prompt:e.prompt});return{imageUrl:s.imageUrl,model:s.model};case"audio":const i=await D.generateAudio({prompt:e.prompt});return{audioUrl:i.audioUrl,model:i.model};case"image-to-3d":const r=typeof globalThis<"u"&&"localStorage"in globalThis?globalThis.localStorage.getItem("TEMP_AIMLAPI_KEY"):null,l=he.getApiKey("fireworks")||r;if(!l)throw new Error("AI Model Key required (Fireworks or AIML)");const p=await ot.imageToModel(e.prompt,l);return{modelUrl:p.url,model:"triposr",content:`Generated ${p.fileName}`};case"animation":throw new Error("Native Animation Model not bound. Use VideoLimb/AnimationLimb for Sprite Sheet/Rig generation.");default:throw new Error(`Unsupported CF type: ${e.type}`)}}async function ct(e,t,n,o){return k({type:e,prompt:t,options:o,domain:"MEDIA"},n)}const T={route:k,orchestrateMedia:ct};class pe{context;constructor(){this.context={variables:new Map,nodeOutputs:new Map}}async execute(t){console.log(`[WORKFLOW] Executing: ${t.name}`);try{this.context.variables.clear(),this.context.nodeOutputs.clear();const n=this.topologicalSort(t);for(const o of n){const a=t.nodes.find(r=>r.id===o);if(!a)continue;console.log(`[WORKFLOW] Executing node: ${a.id} (${a.type})`);const s=this.getNodeInputs(a,t),i=await this.executeNode(a,s);this.context.nodeOutputs.set(a.id,i)}return{success:!0,outputs:Object.fromEntries(this.context.nodeOutputs)}}catch(n){return console.error("[WORKFLOW] Execution failed:",n),{success:!1,outputs:{},error:String(n)}}}getNodeInputs(t,n){const o={},a=n.connections.filter(s=>s.targetNode===t.id);for(const s of a){const i=this.context.nodeOutputs.get(s.sourceNode);i!==void 0&&(o[s.targetInput]=i[s.sourceOutput]||i)}return o}async executeNode(t,n){switch(_e(t.type),t.type){case"input":case"prompt":return{data:t.parameters.value||t.parameters.text};case"ai_text":return{text:(await T.route({type:"text",prompt:n.prompt||t.parameters.prompt||"",modelId:t.parameters.model},globalThis.env)).content};case"ai_image":return{imageUrl:(await T.route({type:"image",prompt:n.prompt||t.parameters.prompt||"",modelId:t.parameters.model},globalThis.env)).imageUrl};case"ai_code":return{code:(await T.route({type:"code",prompt:n.prompt||t.parameters.prompt||"",modelId:t.parameters.model,options:{language:t.parameters.language}},globalThis.env)).code};case"ai_reasoning":return{solution:(await T.route({type:"text",prompt:`Think step-by-step:

${n.problem||""}`,modelId:t.parameters.model||"REASONING"},globalThis.env)).content};case"file_writer":return{success:(await(await O.getAnchors()).writeLocalFile(n.path||t.parameters.path||"",n.content||t.parameters.content||"")).success};case"transform":try{return{result:new Function("data",t.parameters.code||"return data;")(n.data)}}catch{return{result:n.data}}case"filter":try{return new Function("data",t.parameters.condition||"return true;")(n.data)?{true:n.data}:{false:n.data}}catch{return{false:n.data}}case"variable":return t.parameters.operation==="set"?(this.context.variables.set(t.parameters.name,n.value),{value:n.value}):{value:this.context.variables.get(t.parameters.name)};case"merge":return{merged:{...n.input1,...n.input2}};case"http":try{return{response:await(await fetch(t.parameters.url,{method:t.parameters.method||"GET",headers:{"Content-Type":"application/json"},body:t.parameters.method!=="GET"?JSON.stringify(n.body||{}):void 0})).json()}}catch(y){return{response:{error:String(y)}}}case"discord":try{return await fetch(t.parameters.webhookUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:n.message})}),{success:!0}}catch(y){return{success:!1,error:String(y)}}case"git_commit":const p=await O.getAnchors(),f=t.parameters.message||"Auto-commit from Neural Engine",u=await p.gitOperation("add .");if(!u.success)throw new Error(`Git add failed: ${u.error}`);const c=await p.gitOperation(`commit -m "${f}"`);if(!c.success){if(c.error?.includes("nothing to commit"))return{commitHash:"no-changes"};throw new Error(`Git commit failed: ${c.error}`)}return{commitHash:"latest"};case"deploy":const d=await O.getAnchors(),h=(t.parameters.target||"pages")==="pages"?"npx wrangler pages deploy .":"npx wrangler deploy",$=await d.runTerminalCommand(h);if(!$.success)throw new Error(`Deploy failed: ${$.error}`);return{url:"https://pog-ultimate.pages.dev"};case"cloudflare":const fe=await O.getAnchors(),P=t.parameters.action||"deploy_worker";let M="";P==="deploy_worker"&&(M="npx wrangler deploy"),P==="deploy_pages"&&(M="npx wrangler pages deploy .");const x=await fe.runTerminalCommand(M);return{result:x.success?x.output:x.error};case"loop":return{item:n.items?n.items[0]:null};default:return console.warn(`[WORKFLOW] Unhandled node type: ${t.type}`),{}}}topologicalSort(t){const n=new Set,o=[],a=i=>{if(n.has(i))return;n.add(i);const r=t.connections.filter(l=>l.targetNode===i).map(l=>l.sourceNode);for(const l of r)a(l);o.push(i)},s=t.nodes.filter(i=>!t.connections.some(l=>l.targetNode===i.id));for(const i of s)a(i.id);for(const i of t.nodes)n.has(i.id)||a(i.id);return o}}const lt=new pe,pt=Object.freeze(Object.defineProperty({__proto__:null,WorkflowEngine:pe,workflowEngine:lt},Symbol.toStringTag,{value:"Module"}));export{be as N,pt as a,lt as w};

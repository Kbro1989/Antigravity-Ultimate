(function(){"use strict";var rr=new Uint8Array(1e7);const R={};R.array=function(r){var e=0,a=0,t=[0,1,3,7,15,31,63,127,255];return function(o){for(var v=0;o>0;){var c=8-e;o>=c?(v<<=c,v|=t[c]&r[a++],e=0,o-=c):(v<<=o,v|=(r[a]&t[o]<<8-o-e)>>8-o-e,e+=o,o=0)}return v}},R.simple=function(r){var e=R.header(r),a,t,o=[],v=0;do t=R.decompress(r,e),t!=-1&&(o.push(t),v+=t.byteLength);while(t!=-1);a=new Uint8Array(v),v=0;for(var c=0;c<o.length;++c)t=o[c],a.set(t,v),v+=t.byteLength;return a},R.header=function(r){if(r(24)!=4348520)throw"No magic number found";var e=r(8)-48;if(e<1||e>9)throw"Not a BZIP archive";return e},R.decompress=function(r,e,a){for(var t=20,o=258,v=0,c=1,E=50,m=1e5*9,k="",n=0;n<6;n++)k+=r(8).toString(16);if(k=="177245385090")return-1;if(k!="314159265359")throw"eek not valid bzip data";if(r(32),r(1))throw"unsupported obsolete version";var f=r(24);if(f>m)throw"Initial position larger than buffer size";var i=r(16),z=new Uint8Array(256),j=0;for(n=0;n<16;n++)if(i&1<<15-n){var O=r(16);for(s=0;s<16;s++)O&1<<15-s&&(z[j++]=16*n+s)}var D=r(3);if(D<2||D>6)throw"another error";var K=r(15);if(K==0)throw"meh";for(var p=[],n=0;n<D;n++)p[n]=n;for(var U=new Uint8Array(32768),n=0;n<K;n++){for(var s=0;r(1);s++)if(s>=D)throw"whoops another error";var b=p[s];p.splice(s,1),p.splice(0,0,b),U[n]=b}for(var T=j+2,W=[],s=0;s<D;s++){var B=new Uint8Array(o),Y=new Uint8Array(t+1);i=r(5);for(var n=0;n<T;n++){for(;;){if(i<1||i>t)throw"I gave up a while ago on writing error messages";if(!r(1))break;r(1)?i--:i++}B[n]=i}var M,g;M=g=B[0];for(var n=1;n<T;n++)B[n]>g?g=B[n]:B[n]<M&&(M=B[n]);var w;w=W[s]={},w.permute=new Uint32Array(o),w.limit=new Uint32Array(t+1),w.base=new Uint32Array(t+1),w.minLen=M,w.maxLen=g;for(var h=w.base.subarray(1),q=w.limit.subarray(1),_=0,n=M;n<=g;n++)for(var i=0;i<T;i++)B[i]==n&&(w.permute[_++]=i);for(n=M;n<=g;n++)Y[n]=q[n]=0;for(n=0;n<T;n++)Y[B[n]]++;for(_=i=0,n=M;n<g;n++)_+=Y[n],q[n]=_-1,_<<=1,h[n+1]=_-(i+=Y[n]);q[g]=_+Y[g]-1,h[M]=0}for(var P=new Uint32Array(256),n=0;n<256;n++)p[n]=n;var F,u,T,X;F=u=T=X=0;for(var y=new Uint32Array(m);;){if(!T--){if(T=E-1,X>=K)throw"meow i'm a kitty, that's an error";w=W[U[X++]],h=w.base.subarray(1),q=w.limit.subarray(1)}for(n=w.minLen,s=r(n);;){if(n>w.maxLen)throw"rawr i'm a dinosaur";if(s<=q[n])break;n++,s=s<<1|r(1)}if(s-=h[n],s<0||s>=o)throw"moo i'm a cow";var Z=w.permute[s];if(Z==v||Z==c){F||(F=1,i=0),Z==v?i+=F:i+=2*F,F<<=1;continue}if(F){if(F=0,u+i>=m)throw"Boom.";for(b=z[p[0]],P[b]+=i;i--;)y[u++]=b}if(Z>j)break;if(u>=m)throw"I can't think of anything. Error";n=Z-1,b=p[n],p.splice(n,1),p.splice(0,0,b),b=z[b],P[b]++,y[u++]=b}if(f<0||f>=u)throw"I'm a monkey and I'm throwing something at someone, namely you";for(var s=0,n=0;n<256;n++)O=s+P[n],P[n]=s,s=O;for(var n=0;n<u;n++)b=y[n]&255,y[P[b]]|=n<<8,P[b]++;var C=0,A=0,V=0;u&&(C=y[f],A=C&255,C>>=8,V=-1),u=u;var N,$,H,Q=0;for(a||(a=1/0);u;){for(u--,$=A,C=y[C],A=C&255,C>>=8,V++==3?(N=A,H=$,A=-1):(N=1,H=A);N--;)if(rr[Q++]=H,!--a)return rr;A!=$&&(V=0)}if(Q>rr.length)throw new Error("not enough memory reserved");return rr.slice(0,Q)};var d=Uint8Array,J=Uint16Array,Ar=Int32Array,fr=new d([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),vr=new d([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),dr=new d([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),sr=function(r,e){for(var a=new J(31),t=0;t<31;++t)a[t]=e+=1<<r[t-1];for(var o=new Ar(a[30]),t=1;t<30;++t)for(var v=a[t];v<a[t+1];++v)o[v]=v-a[t]<<5|t;return{b:a,r:o}},lr=sr(fr,2),cr=lr.b,Er=lr.r;cr[28]=258,Er[258]=28;for(var kr=sr(vr,0),pr=kr.b,ar=new J(32768),l=0;l<32768;++l){var x=(l&43690)>>1|(l&21845)<<1;x=(x&52428)>>2|(x&13107)<<2,x=(x&61680)>>4|(x&3855)<<4,ar[l]=((x&65280)>>8|(x&255)<<8)>>1}for(var L=(function(r,e,a){for(var t=r.length,o=0,v=new J(e);o<t;++o)r[o]&&++v[r[o]-1];var c=new J(e);for(o=1;o<e;++o)c[o]=c[o-1]+v[o-1]<<1;var E;if(a){E=new J(1<<e);var m=15-e;for(o=0;o<t;++o)if(r[o])for(var k=o<<4|r[o],n=e-r[o],f=c[r[o]-1]++<<n,i=f|(1<<n)-1;f<=i;++f)E[ar[f]>>m]=k}else for(E=new J(t),o=0;o<t;++o)r[o]&&(E[o]=ar[c[r[o]-1]++]>>15-r[o]);return E}),G=new d(288),l=0;l<144;++l)G[l]=8;for(var l=144;l<256;++l)G[l]=9;for(var l=256;l<280;++l)G[l]=7;for(var l=280;l<288;++l)G[l]=8;for(var wr=new d(32),l=0;l<32;++l)wr[l]=5;var Ur=L(G,9,1),Tr=L(wr,5,1),nr=function(r){for(var e=r[0],a=1;a<r.length;++a)r[a]>e&&(e=r[a]);return e},I=function(r,e,a){var t=e/8|0;return(r[t]|r[t+1]<<8)>>(e&7)&a},tr=function(r,e){var a=e/8|0;return(r[a]|r[a+1]<<8|r[a+2]<<16)>>(e&7)},Br=function(r){return(r+7)/8|0},Ir=function(r,e,a){return(a==null||a>r.length)&&(a=r.length),new d(r.subarray(e,a))},Sr=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],S=function(r,e,a){var t=new Error(e||Sr[r]);if(t.code=r,Error.captureStackTrace&&Error.captureStackTrace(t,S),!a)throw t;return t},ur=function(r,e,a,t){var o=r.length,v=0;if(!o||e.f&&!e.l)return a||new d(0);var c=!a,E=c||e.i!=2,m=e.i;c&&(a=new d(o*3));var k=function(gr){var yr=a.length;if(gr>yr){var mr=new d(Math.max(yr*2,gr));mr.set(a),a=mr}},n=e.f||0,f=e.p||0,i=e.b||0,z=e.l,j=e.d,O=e.m,D=e.n,K=o*8;do{if(!z){n=I(r,f,1);var p=I(r,f+1,3);if(f+=3,p)if(p==1)z=Ur,j=Tr,O=9,D=5;else if(p==2){var B=I(r,f,31)+257,Y=I(r,f+10,15)+4,M=B+I(r,f+5,31)+1;f+=14;for(var g=new d(M),w=new d(19),h=0;h<Y;++h)w[dr[h]]=I(r,f+h*3,7);f+=Y*3;for(var q=nr(w),_=(1<<q)-1,P=L(w,q,1),h=0;h<M;){var F=P[I(r,f,_)];f+=F&15;var U=F>>4;if(U<16)g[h++]=U;else{var u=0,T=0;for(U==16?(T=3+I(r,f,3),f+=2,u=g[h-1]):U==17?(T=3+I(r,f,7),f+=3):U==18&&(T=11+I(r,f,127),f+=7);T--;)g[h++]=u}}var X=g.subarray(0,B),y=g.subarray(B);O=nr(X),D=nr(y),z=L(X,O,1),j=L(y,D,1)}else S(1);else{var U=Br(f)+4,b=r[U-4]|r[U-3]<<8,W=U+b;if(W>o){m&&S(0);break}E&&k(i+b),a.set(r.subarray(U,W),i),e.b=i+=b,e.p=f=W*8,e.f=n;continue}if(f>K){m&&S(0);break}}E&&k(i+131072);for(var Z=(1<<O)-1,s=(1<<D)-1,C=f;;C=f){var u=z[tr(r,f)&Z],A=u>>4;if(f+=u&15,f>K){m&&S(0);break}if(u||S(2),A<256)a[i++]=A;else if(A==256){C=f,z=null;break}else{var V=A-254;if(A>264){var h=A-257,N=fr[h];V=I(r,f,(1<<N)-1)+cr[h],f+=N}var $=j[tr(r,f)&s],H=$>>4;$||S(3),f+=$&15;var y=pr[H];if(H>3){var N=vr[H];y+=tr(r,f)&(1<<N)-1,f+=N}if(f>K){m&&S(0);break}E&&k(i+131072);var Q=i+V;if(i<y){var hr=v-y,Jr=Math.min(y,Q);for(hr+i<0&&S(3);i<Jr;++i)a[i]=t[hr+i]}for(;i<Q;++i)a[i]=a[i-y]}}e.l=z,e.p=C,e.b=i,e.f=n,z&&(n=1,e.m=O,e.d=j,e.n=D)}while(!n);return i!=a.length&&c?Ir(a,0,i):a.subarray(0,i)},zr=new d(0),Dr=function(r){(r[0]!=31||r[1]!=139||r[2]!=8)&&S(6,"invalid gzip data");var e=r[3],a=10;e&4&&(a+=(r[10]|r[11]<<8)+2);for(var t=(e>>3&1)+(e>>4&1);t>0;t-=!r[a++]);return a+(e&2)},Mr=function(r){var e=r.length;return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0};function Fr(r,e){return ur(r,{i:2},e,e)}function Cr(r,e){var a=Dr(r);return a+8>r.length&&S(6,"invalid gzip data"),ur(r.subarray(a,-8),{i:2},new d(Mr(r)),e)}var Or=typeof TextDecoder<"u"&&new TextDecoder,_r=0;try{Or.decode(zr,{stream:!0}),_r=1}catch{}function br(r,e){switch(r.readUInt8(0)){case 0:return Nr(r);case 1:return Rr(r);case 2:return xr(r,e);case 3:return jr();case 90:return Yr(r);default:throw new Error("Unknown compression type ("+r.readUInt8(0).toString()+")")}}var Nr=function(r){var e=r.readUInt32BE(1),a=Buffer.alloc(e);return r.copy(a,0,5),a},Rr=function(r){var e=r.readUInt32BE(1);r.readUInt32BE(5);var a=Buffer.alloc(e+2+1+1);return r.copy(a,4,9),a.writeUInt16BE(16986,0),a.writeUInt8(104,2),a.writeUInt8(56,3),Buffer.from(R.simple(R.array(a)))},xr=function(r,e){try{let a=r.readUint32BE(1),t=r.slice(9,9+a);return Buffer.from(Cr(t))}catch(a){throw new Error("gzip decompress failed, possibly due to missing or wrong xtea key, key: none",{cause:a})}};function jr(r){throw new Error("LZMA decompression not implemented (missing library)")}function Yr(r){return r.readUInt32BE(4),Buffer.from(Fr(r.slice(8)))}self.importScripts("/libs/sql-wasm-workerfs.js");const qr=self.initSqlJs;let or=new Map,ir={};self.addEventListener("message",async r=>{let e=r.data.id,a=r.data.packet;try{switch(a.type){case"blobs":Pr(a.blobs),self.postMessage({id:e});break;case"getfile":let t=await Kr(a.major,a.minor,a.crc);self.postMessage({id:e,packet:t});break;case"putfile":await $r(a.major,a.minor,a.data),self.postMessage({id:e,packet:!0});break;case"getindex":let o=await Zr(a.major);self.postMessage({id:e,packet:o});break;case"save":let v=await Hr(a.major);self.postMessage({id:e,packet:v});break}}catch(t){self.postMessage({id:e,error:t.message})}});function Pr(r){Object.assign(ir,r)}function er(r){if(!or.has(r)){let e=`js5-${r}.jcache`;if(!ir[e])throw new Error(`need file ${e}`);let a=qr({locateFile:v=>v.endsWith(".wasm")?"/libs/sql-wasm-workerfs.wasm":v}).then(v=>new v.Database(ir[e])),t=async(v,c)=>{let m=(await a).exec(v,c);if(m.length==0)throw new Error("entry not found");let k=m[0];for(let n of k.values){let f={};for(let i=0;i<k.columns.length;i++)f[k.columns[i]]=n[i];return f}},o=async(v,c)=>((await a).run(v,c),!0);or.set(r,{dbprom:a,dbget:t,dbrun:o})}return or.get(r)}async function Kr(r,e,a){let{dbget:t}=er(r),o=await t("SELECT DATA,CRC FROM cache WHERE KEY=?",[e]),v=Buffer.from(o.DATA.buffer,o.DATA.byteOffset,o.DATA.byteLength);return br(v)}async function Zr(r){let{dbget:e}=er(r),a=await e("SELECT DATA FROM cache_index",[]),t=Buffer.from(a.DATA.buffer,a.DATA.byteOffset,a.DATA.byteLength);return br(t)}async function $r(r,e,a){let{dbrun:t}=er(r);await t("INSERT INTO cache (KEY, DATA) VALUES (?, ?) ON CONFLICT(KEY) DO UPDATE SET DATA=excluded.DATA",[e,a])}async function Hr(r){let{dbprom:e}=er(r);return(await e).export()}})();

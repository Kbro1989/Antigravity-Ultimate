const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BykCndgd.js","assets/Stage-DBN5_cBU.js","assets/main-BVuYDR_W.js","assets/main-DmuLaqgn.css","assets/three.module-DqfR4SX2.js","assets/constants-CPtoviZ5.js","assets/with-selector-Dj9Nyz7s.js","assets/GLTFLoader-Dr6w83BU.js","assets/index-BqY77Uya.js","assets/modelnodes-PlJRl8Uo.js","assets/enginecache-KDYRmXzf.js"])))=>i.map(i=>d[i]);
import{_ as p,l as v,r as h,j as i}from"./main-BVuYDR_W.js";import{C as S,P as E,S as M,O as D}from"./Stage-DBN5_cBU.js";import{s as L,h as g,G as y,t as C,g as R,u as k,v as A,P as I,w as T,x as b}from"./three.module-DqfR4SX2.js";import{F as N}from"./Float-B7nNvLwF.js";class f{static instance;gltfLoader=null;objLoader=null;stlLoader=null;constructor(){}static getInstance(){return this.instance||(this.instance=new f),this.instance}async ensureLoaders(){if(!this.gltfLoader){const{GLTFLoader:e,OBJLoader:c,STLLoader:o}=await p(async()=>{const{GLTFLoader:r,OBJLoader:t,STLLoader:n}=await import("./index-BykCndgd.js");return{GLTFLoader:r,OBJLoader:t,STLLoader:n}},__vite__mapDeps([0,1,2,3,4,5,6,7]));this.gltfLoader=new e,this.objLoader=new c,this.stlLoader=new o}}async loadModelByUrl(e){if(await this.ensureLoaders(),e.startsWith("rsmv://")||e.startsWith("rsc://")){const{rsmv:o}=await p(async()=>{const{rsmv:n}=await import("./index-BqY77Uya.js");return{rsmv:n}},__vite__mapDeps([8,2,3])),r=parseInt(e.split("://")[1]),t=await o.loadModel(r);return{scene:t.scene,metadata:t.metadata}}if(e.startsWith("map://")){const{rsmv:o}=await p(async()=>{const{rsmv:s}=await import("./index-BqY77Uya.js");return{rsmv:s}},__vite__mapDeps([8,2,3])),[r,t]=e.split("://")[1].split(",").map(s=>parseInt(s)),{RSMapChunk:n}=await p(async()=>{const{RSMapChunk:s}=await import("./modelnodes-PlJRl8Uo.js");return{RSMapChunk:s}},__vite__mapDeps([9,10,2,3,4])),a=o.getSceneCache();if(!a)throw new Error("RSMV Cache not linked. Cannot load map chunk.");const d=n.create(a,r,t);return await d.chunkdata,{scene:d.rootnode,metadata:{x:r,z:t,terrain:!0}}}const c=e.split(".").pop()?.toLowerCase();switch(c){case"glb":case"gltf":const o=await this.gltfLoader.loadAsync(e);return{scene:o.scene,metadata:o.userData,animations:o.animations};case"obj":return{scene:await this.objLoader.loadAsync(e),metadata:{}};case"stl":const t=await this.stlLoader.loadAsync(e),n=new L({color:8947848}),a=new g(t,n),d=new y;return d.add(a),{scene:d,metadata:{}};default:throw new Error(`Unsupported model extension: ${c}`)}}async loadLocalModel(e){await this.ensureLoaders();const c=await v.readLocalFile(e,!0);if(!c.success||!c.content)throw new Error(`Failed to read local model: ${c.error||"Unknown error"}`);const o=atob(c.content),r=new Uint8Array(o.length);for(let a=0;a<o.length;a++)r[a]=o.charCodeAt(a);const t=r.buffer,n=e.split(".").pop()?.toLowerCase();return new Promise((a,d)=>{if(n==="glb"||n==="gltf")this.gltfLoader.parse(t,"",s=>{a({scene:s.scene,metadata:s.userData,animations:s.animations})},d);else if(n==="obj"){const s=new TextDecoder().decode(t),l=this.objLoader.parse(s);a({scene:l,metadata:{}})}else if(n==="stl"){const s=this.stlLoader.parse(t),l=new L({color:8947848}),u=new g(s,l),m=new y;m.add(u),a({scene:m,metadata:{}})}else d(new Error(`Unsupported local model extension: ${n}`))})}async takeSnapshot(e,c=512,o=512){const r=new C({antialias:!0,alpha:!0});r.setSize(c,o);const t=new R;t.add(new k(16777215,.8));const n=new A(16777215,.5);n.position.set(5,10,7.5),t.add(n),t.add(e);const a=new I(45,c/o,.1,1e3),d=new T().setFromObject(e),s=d.getCenter(new b),l=d.getSize(new b),u=Math.max(l.x,l.y,l.z),m=a.fov*(Math.PI/180);let x=Math.abs(u/2/Math.tan(m/2));x*=1.5,a.position.set(s.x,s.y+l.y*.2,s.z+x),a.lookAt(s),r.render(t,a);const j=r.domElement.toDataURL("image/png");return r.dispose(),j}}const _=f.getInstance();function z({modelUrl:w,localPath:e,autoRotate:c=!1,className:o="",onLoad:r,onError:t}){const[n,a]=h.useState(null),[d,s]=h.useState(null);return h.useEffect(()=>{let l=!1;return(async()=>{try{let m;if(e)m=await _.loadLocalModel(e);else if(w)m=await _.loadModelByUrl(w);else return;l||(a(m),r?.(m))}catch(m){l||(s(m.message),t?.(m))}})(),()=>{l=!0}},[w,e,r,t]),d?i.jsxs("div",{className:"flex items-center justify-center w-full h-full text-red-400 font-mono text-xs uppercase p-8 text-center bg-red-500/10 rounded-3xl border border-red-500/20",children:["Error Loading Standard Model:",i.jsx("br",{}),d]}):i.jsxs("div",{className:`w-full h-full relative group ${o}`,children:[i.jsxs(S,{shadows:!0,className:"w-full h-full",children:[i.jsx(E,{makeDefault:!0,position:[0,0,5],fov:45}),i.jsx(h.Suspense,{fallback:null,children:i.jsx(M,{environment:"night",intensity:.6,shadows:{type:"contact",opacity:.4},children:n&&i.jsx(N,{speed:1.5,rotationIntensity:.2,floatIntensity:.5,children:i.jsx("primitive",{object:n.scene,castShadow:!0,receiveShadow:!0})})})}),i.jsx(D,{makeDefault:!0,autoRotate:c,autoRotateSpeed:.3})]}),i.jsxs("div",{className:"absolute top-6 left-6 flex flex-col gap-2 pointer-events-none",children:[i.jsxs("div",{className:"text-[10px] font-black uppercase text-neon-cyan tracking-[0.4em] mb-2 flex items-center gap-2",children:[i.jsx("span",{className:"w-2 h-2 rounded-full bg-neon-cyan shadow-[0_0_8px_var(--neon-cyan)] animate-pulse"}),"RENDER_MODE: STANDARD_GLTF"]}),i.jsx("div",{className:"flex gap-2",children:i.jsxs("span",{className:"glass px-2 py-1 rounded text-[8px] font-mono text-white/40 uppercase",children:["Source: ",e?"Local_Storage":"Remote_Asset"]})})]})]})}export{z as S};
